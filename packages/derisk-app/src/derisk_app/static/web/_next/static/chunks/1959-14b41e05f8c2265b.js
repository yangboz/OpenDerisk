(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1959],{45520:function(e,t,a){"use strict";var l=a(21011),n=a(8080),r=a(92821),s=a(84769),o=a(63464),i=a(42673),c=a(75271),d=a(31226);t.Z=e=>{let{queryAgentURL:t="/api/v1/chat/completions",app_code:a}=e,[u,h]=(0,c.useState)({}),{scene:p}=(0,c.useContext)(l.p),m=(0,c.useCallback)(async e=>{let{data:l,chatId:c,onMessage:u,onClose:m,onDone:f,onError:x,ctrl:g}=e;if(g&&h(g),!(null==l?void 0:l.user_input)&&!(null==l?void 0:l.doc_id)){i.ZP.warning(n.Z.t("no_context_tip"));return}let _={...l,conv_uid:c,app_code:a};try{var v,b;await (0,o.L)("".concat(null!==(v=d.env.API_BASE_URL)&&void 0!==v?v:"").concat(t),{method:"POST",headers:{"Content-Type":"application/json",[s.gp]:null!==(b=(0,r.n5)())&&void 0!==b?b:""},body:JSON.stringify(_),signal:g?g.signal:null,openWhenHidden:!0,async onopen(e){e.ok&&e.headers.get("content-type")===o.a||"application/json"!==e.headers.get("content-type")||e.json().then(e=>{null==u||u(e),null==f||f(),g&&g.abort()})},onclose(){g&&g.abort(),null==m||m()},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;try{t="chat_agent"===p?JSON.parse(t).vis:JSON.parse(t)}catch(e){t.replaceAll("\\n","\n")}"string"==typeof t?"[DONE]"===t?null==f||f():(null==t?void 0:t.startsWith("[ERROR]"))?null==x||x(null==t?void 0:t.replace("[ERROR]","")):null==u||u(t):(null==u||u(t),null==f||f())}})}catch(e){g&&g.abort(),null==x||x("Sorry, We meet some error, please try agin later.",e)}},[t,a,p]);return{chat:m,ctrl:u}}},45449:function(e,t,a){"use strict";var l=a(52676),n=a(21011),r=a(59864),s=a(92821),o=a(72423),i=a(41148),c=a(82187),d=a.n(c),u=a(13250),h=a(75271),p=a(78490);t.Z=(0,h.memo)(function(e){let{bodyClassName:t,minRows:a,maxRows:c,sendClassName:m,cneterBtn:f=!0,isGoPath:x=!1,input:g=""}=e,{setCurrentDialogInfo:_}=(0,h.useContext)(n.p),{t:v}=(0,p.$G)(),b=(0,u.useRouter)(),[j,w]=(0,h.useState)(g),[y,N]=(0,h.useState)(!1),[k,S]=(0,h.useState)(!1);(0,h.useEffect)(()=>{w(g)},[g]);let Z=async()=>{if(x){let[,e]=await (0,r.Vx)((0,r.py)());if(e){let[,t]=await (0,r.Vx)((0,r.sW)({chat_mode:null==e?void 0:e.main_chat_mode,app_code:null==e?void 0:e.main_app,model_name:null==e?void 0:e.main_model}));t&&(null==_||_({chat_scene:t.chat_mode,app_code:e.main_app}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:e.main_app})),localStorage.setItem(s.rU,JSON.stringify({id:t.conv_uid,message:j})),b.push("/chat/?scene=".concat(t.chat_mode,"&id=").concat(t.conv_uid)))}return}let[,e]=await (0,r.Vx)((0,r.sW)({chat_mode:"chat_normal"}));e&&(null==_||_({chat_scene:e.chat_mode,app_code:e.chat_mode}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:e.chat_mode,app_code:e.chat_mode})),localStorage.setItem(s.rU,JSON.stringify({id:e.conv_uid,message:j})),b.push("/chat/?scene=chat_normal&id=".concat(e.conv_uid))),w("")};return(0,l.jsxs)("div",{className:d()("flex flex-1 h-12 p-2 pl-4 ".concat(f?"items-center":""," justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl  border-t border-b border-l border-r ").concat(y?"border-[#0c75fc]":""),t),children:[(0,l.jsx)(o.default.TextArea,{placeholder:v("input_tips"),className:"w-full h-32 resize-none border-0 p-0 focus:shadow-none",value:j,autoSize:{minRows:a,maxRows:c},onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&!k&&(e.preventDefault(),j.trim()&&Z())},onChange:e=>{w(e.target.value)},onFocus:()=>{N(!0)},onBlur:()=>N(!1),onCompositionStart:()=>S(!0),onCompositionEnd:()=>S(!1)}),(0,l.jsx)(i.ZP,{type:"primary",className:d()("flex items-center justify-center w-14 h-8 rounded-lg text-sm  bg-button-gradient border-0",{"opacity-40 cursor-not-allowed":!j.trim()},m),onClick:()=>{j.trim()&&Z()},children:v("sent")})]})})},99275:function(e,t,a){"use strict";var l=a(52676),n=a(39048),r=a(75509),s=a(75271);t.Z=e=>{let{width:t,height:a,scene:o}=e,i=(0,s.useCallback)(()=>{switch(o){case"chat_knowledge":return n.je;case"chat_with_db_execute":return n.zM;case"chat_excel":return n.DL;case"chat_with_db_qa":case"chat_dba":return n.RD;case"chat_dashboard":return n.In;case"chat_agent":return n.si;case"chat_normal":return n.O7;default:return}},[o]);return(0,l.jsx)(r.Z,{className:"w-".concat(t||7," h-").concat(a||7),component:i()})}},68508:function(e,t,a){"use strict";var l=a(96829);let n=(0,l.Z)({scriptUrl:"//at.alicdn.com/t/a/font_4440880_ljyggdw605.js"});t.Z=n},71041:function(e,t,a){"use strict";a.d(t,{TH:function(){return f},ZS:function(){return x}});var l=a(52676),n=a(32347),r=a(40389),s=a(81882),o=a(44610),i=a(48763),c=a(82187),d=a.n(c),u=a(49366),h=a(87402),p=a.n(h);a(75271);var m=a(99275);a(2008);let f=e=>{let{onClick:t,Icon:a="/pictures/card_chat.png",text:n=(0,u.t)("start_chat")}=e;return"string"==typeof a&&(a=(0,l.jsx)(p(),{src:a,alt:a,width:17,height:15})),(0,l.jsxs)("div",{className:"flex items-center gap-1 text-default",onClick:e=>{e.stopPropagation(),t&&t()},children:[a,(0,l.jsx)("span",{children:n})]})},x=e=>{let{menu:t}=e;return(0,l.jsx)(i.Z,{menu:t,getPopupContainer:e=>e.parentNode,placement:"bottomRight",autoAdjustOverflow:!1,children:(0,l.jsx)(n.Z,{className:"p-2 hover:bg-white hover:dark:bg-black rounded-md"})})};t.ZP=e=>{let{RightTop:t,Tags:a,LeftBottom:n,RightBottom:i,onClick:c,rightTopHover:u=!0,logo:h,name:f,description:x,className:g,scene:_,code:v}=e;return"string"==typeof x&&(x=(0,l.jsx)("p",{className:"line-clamp-2 relative bottom-4 text-ellipsis min-h-[42px] text-sm text-[#525964] dark:text-[rgba(255,255,255,0.65)]",children:x})),(0,l.jsx)("div",{className:d()("hover-underline-gradient flex justify-center mt-6 relative group w-1/3 px-2 mb-6",g),children:(0,l.jsxs)("div",{onClick:c,className:"backdrop-filter backdrop-blur-lg cursor-pointer  bg-white bg-opacity-70 border-2 border-white rounded-lg shadow p-4 relative w-full h-full dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",children:[(0,l.jsxs)("div",{className:"flex items-end relative bottom-8 justify-between w-full",children:[(0,l.jsxs)("div",{className:"flex items-end gap-4 w-11/12  flex-1",children:[(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm w-14 h-14 flex items-center p-3",children:_?(0,l.jsx)(m.Z,{scene:_,width:14,height:14}):h&&(0,l.jsx)(p(),{src:h,width:44,height:44,alt:f,className:"w-8 min-w-8 rounded-full max-w-none"})}),(0,l.jsx)("div",{className:"flex-1",children:f.length>6?(0,l.jsx)(r.Z,{title:f,children:(0,l.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:f})}):(0,l.jsx)("span",{className:"line-clamp-1 text-ellipsis font-semibold text-base",style:{maxWidth:"60%"},children:f})})]}),(0,l.jsx)("span",{className:d()("shrink-0",{hidden:u,"group-hover:block":u}),onClick:e=>{e.stopPropagation()},children:t})]}),x,(0,l.jsx)("div",{className:"relative bottom-2",children:a}),(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("div",{children:n}),(0,l.jsx)("div",{children:i})]}),v&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.Z,{className:"my-3"}),(0,l.jsx)(o.Z.Text,{copyable:!0,className:"absolute bottom-1 right-4 text-xs text-gray-500",children:v})]})]})})}},31959:function(e,t,a){"use strict";a.r(t),a.d(t,{ChatContentContext:function(){return ea},default:function(){return el}});var l=a(52676),n=a(21011),r=a(59864),s=a(45520),o=a(2550),i=a(32346),c=a(68554),d=a.n(c),u=a(75271);let h=d()(()=>Promise.all([a.e(8201),a.e(9915),a.e(4130),a.e(4521),a.e(768),a.e(5745),a.e(9066),a.e(3075),a.e(2601),a.e(4426),a.e(5711),a.e(4486),a.e(7707),a.e(7200),a.e(4395),a.e(8223),a.e(6705),a.e(9907),a.e(3046),a.e(4465),a.e(3769),a.e(1633),a.e(2026),a.e(2466),a.e(7258),a.e(4132),a.e(6414),a.e(2102),a.e(7952),a.e(3527),a.e(9159)]).then(a.bind(a,34948)),{loadableGenerated:{webpack:()=>[34948]},ssr:!1});var p=(0,u.memo)((0,u.forwardRef)((e,t)=>{let{}=e,a=(0,u.useRef)(null),[n,r]=(0,u.useState)(!1),[s,c]=(0,u.useState)(!1),[d,p]=(0,u.useState)(!0),[m,f]=(0,u.useState)(!1);(0,u.useImperativeHandle)(t,()=>a.current);let x=()=>{if(!a.current)return;let e=a.current,t=e.scrollTop,l=e.scrollHeight,n=e.clientHeight;p(t<=20),f(t+n>=l-20),t>=74?r(!0):r(!1);let s=l>n;c(s)};return(0,u.useEffect)(()=>{if(a.current){a.current.addEventListener("scroll",x);let e=a.current.scrollHeight>a.current.clientHeight;c(e)}return()=>{a.current&&a.current.removeEventListener("scroll",x)}},[]),(0,l.jsxs)("div",{className:"flex flex-1 overflow-hidden relative",children:[(0,l.jsx)("div",{ref:a,className:"h-full w-full mx-auto overflow-y-auto",children:(0,l.jsx)(h,{})}),s&&(0,l.jsxs)("div",{className:"absolute right-6 bottom-24 flex flex-col gap-2",children:[!d&&(0,l.jsx)("button",{onClick:()=>{a.current&&a.current.scrollTo({top:0,behavior:"smooth"})},className:"w-10 h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow","aria-label":"Scroll to top",children:(0,l.jsx)(o.Z,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)]"})}),!m&&(0,l.jsx)("button",{onClick:()=>{a.current&&a.current.scrollTo({top:a.current.scrollHeight,behavior:"smooth"})},className:"w-10 h-10 bg-white dark:bg-[rgba(255,255,255,0.2)] border border-gray-200 dark:border-[rgba(255,255,255,0.2)] rounded-full flex items-center justify-center shadow-md hover:shadow-lg transition-shadow","aria-label":"Scroll to bottom",children:(0,l.jsx)(i.Z,{className:"text-[#525964] dark:text-[rgba(255,255,255,0.85)]"})})]})]})})),m=a(53977),f=a(71041),x=a(28057),g=a(98493),_=a(94634),v=a(1626),b=a(57107),j=a(87402),w=a.n(j),y=a(13250),N=a(68508),k=e=>{let{apps:t,refresh:a,loading:s,type:o}=e,i=async e=>{let[t]=await (0,r.Vx)("true"===e.is_collected?(0,r.gD)({app_code:e.app_code}):(0,r.mo)({app_code:e.app_code}));t||a()},{setAgent:c,model:d,setCurrentDialogInfo:h}=(0,u.useContext)(n.p),p=(0,y.useRouter)(),m=async e=>{if("native_app"===e.team_mode){let{chat_scene:t=""}=e.team_context,[,a]=await (0,r.Vx)((0,r.sW)({chat_mode:t}));a&&(null==h||h({chat_scene:a.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:a.chat_mode,app_code:e.app_code})),p.push("/chat?scene=".concat(t,"&id=").concat(a.conv_uid).concat(d?"&model=".concat(d):"")))}else{let[,t]=await (0,r.Vx)((0,r.sW)({chat_mode:"chat_agent"}));t&&(null==h||h({chat_scene:t.chat_mode,app_code:e.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:t.chat_mode,app_code:e.app_code})),null==c||c(e.app_code),p.push("/chat/?scene=chat_agent&id=".concat(t.conv_uid).concat(d?"&model=".concat(d):"")))}};return s?(0,l.jsx)(_.Z,{size:"large",className:"flex items-center justify-center h-full",spinning:s}):(0,l.jsx)("div",{className:"flex flex-wrap mt-4 w-full overflow-y-auto ",children:(null==t?void 0:t.length)>0?t.map(e=>{var t;return(0,l.jsx)(f.ZP,{name:e.app_name,description:e.app_describe,onClick:()=>m(e),RightTop:"true"===e.is_collected?(0,l.jsx)(x.Z,{onClick:t=>{t.stopPropagation(),i(e)},style:{height:"21px",cursor:"pointer",color:"#f9c533"}}):(0,l.jsx)(g.Z,{onClick:t=>{t.stopPropagation(),i(e)},style:{height:"21px",cursor:"pointer"}}),LeftBottom:(0,l.jsxs)("div",{className:"flex gap-8 items-center text-gray-500 text-sm",children:[e.owner_name&&(0,l.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,l.jsx)(v.Z,{src:null==e?void 0:e.owner_avatar_url,className:"bg-gradient-to-tr from-[#31afff] to-[#1677ff] cursor-pointer",children:e.owner_name}),(0,l.jsx)("span",{children:e.owner_name})]}),"used"!==o&&(0,l.jsxs)("div",{className:"flex items-start gap-1",children:[(0,l.jsx)(N.Z,{type:"icon-hot",className:"text-lg"}),(0,l.jsx)("span",{className:"text-[#878c93]",children:e.hot_value})]})]}),scene:(null==e?void 0:null===(t=e.team_context)||void 0===t?void 0:t.chat_scene)||"chat_agent"},e.app_code)}):(0,l.jsx)(b.Z,{image:(0,l.jsx)(w(),{src:"/pictures/empty.png",alt:"empty",width:142,height:133,className:"w-[142px] h-[133px]"}),className:"flex justify-center items-center w-full h-full min-h-[200px]"})})},S=a(45449),Z=a(92821),C=a(99113),P=a(39034),R=a(37699),V=a(49366),O=function(){let{setCurrentDialogInfo:e,model:t}=(0,u.useContext)(n.p),a=(0,y.useRouter)(),[s,o]=(0,u.useState)({app_list:[],total_count:0}),[i,c]=(0,u.useState)("recommend"),d=e=>(0,r.Vx)((0,r.yk)({...e,page_no:"1",page_size:"6"})),h=e=>(0,r.Vx)((0,r.mW)({page_no:"1",page_size:"6",...e})),{run:p,loading:f,refresh:x}=(0,C.Z)(async e=>{switch(i){case"recommend":return await h({});case"used":return await d({is_recent_used:"true",need_owner_info:"true",...e&&{app_name:e}});default:return[]}},{manual:!0,onSuccess:e=>{let[t,a]=e;if("recommend"===i)return o({app_list:a,total_count:(null==a?void 0:a.length)||0});o(a||{})},debounceWait:500});(0,u.useEffect)(()=>{p()},[i,p]);let g=[{value:"recommend",label:(0,V.t)("recommend_apps")},{value:"used",label:(0,V.t)("used_apps")}],{data:_}=(0,C.Z)(async()=>{let[,e]=await (0,r.Vx)((0,m.A)({is_hot_question:"true"}));return null!=e?e:[]});return(0,l.jsx)(P.ZP,{theme:{components:{Button:{defaultBorderColor:"white"},Segmented:{itemSelectedBg:"#2867f5",itemSelectedColor:"white"}}},children:(0,l.jsxs)("div",{className:"px-28 py-10 h-full flex flex-col justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)(R.Z,{className:"backdrop-filter h-10 backdrop-blur-lg bg-white bg-opacity-30 border border-white rounded-lg shadow p-1 dark:border-[#6f7f95] dark:bg-[#6f7f95] dark:bg-opacity-60",options:g,value:i,onChange:e=>{c(e)}}),(0,l.jsxs)("span",{className:"flex items-center text-gray-500 gap-1 dark:text-slate-300",children:[(0,l.jsx)("span",{children:(0,V.t)("app_in_mind")}),(0,l.jsxs)("span",{className:"flex items-center cursor-pointer",onClick:()=>{a.push("/")},children:[(0,l.jsx)(w(),{src:"/pictures/explore_active.png",alt:"construct_image",width:24,height:24},"image_explore"),(0,l.jsx)("span",{className:"text-default",children:(0,V.t)("explore")})]}),(0,l.jsx)("span",{children:(0,V.t)("Discover_more")})]})]}),(0,l.jsx)(k,{apps:(null==s?void 0:s.app_list)||[],loading:f,refresh:x,type:i}),_&&_.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"font-medium text-xl my-4",children:(0,V.t)("help")}),(0,l.jsx)("div",{className:"flex justify-start gap-4",children:_.map(n=>(0,l.jsxs)("span",{className:"flex gap-4 items-center backdrop-filter backdrop-blur-lg cursor-pointer bg-white bg-opacity-70 border-0 rounded-lg shadow p-2 relative dark:bg-[#6f7f95] dark:bg-opacity-60",onClick:async()=>{let[,l]=await (0,r.Vx)((0,r.sW)({chat_mode:"chat_knowledge",model:t}));l&&(null==e||e({chat_scene:l.chat_mode,app_code:n.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:l.chat_mode,app_code:n.app_code})),localStorage.setItem(Z.rU,JSON.stringify({id:l.conv_uid,message:n.question})),a.push("/chat/?scene=".concat(l.chat_mode,"&id=").concat(null==l?void 0:l.conv_uid)))},children:[(0,l.jsx)("span",{children:n.question}),(0,l.jsx)(w(),{src:"/icons/send.png",alt:"construct_image",width:20,height:20},"image_explore")]},n.id))})]})]}),(0,l.jsx)("div",{children:(0,l.jsx)(S.Z,{})})]})})},E=a(33303),L=a(86743),I=a(73813),A=a(68257),T=a(30403),W=a(99879),D=a(81485),J=a(40389),M=a(44610),H=a(42673),z=a(874),B=a.n(z),G=a(29052),U=a(78490),q=a(99275);let{Sider:$}=T.default,F={display:"flex",alignItems:"center",justifyContent:"center",width:16,height:48,position:"absolute",top:"50%",transform:"translateY(-50%)",border:"1px solid #d6d8da",borderRadius:8,right:-8},K=e=>{var t,a;let{item:s,refresh:o,historyLoading:i}=e,{t:c}=(0,U.$G)(),d=(0,G.useRouter)(),h=(0,G.useSearchParams)(),p=null!==(t=null==h?void 0:h.get("id"))&&void 0!==t?t:"",m=null!==(a=null==h?void 0:h.get("scene"))&&void 0!==a?a:"",{setCurrentDialogInfo:f}=(0,u.useContext)(n.p),x=(0,u.useMemo)(()=>s.default?s.default&&!p&&!m:s.conv_uid===p&&s.chat_mode===m,[p,m,s]),g=()=>{W.default.confirm({title:c("delete_chat"),content:c("delete_chat_confirm"),centered:!0,onOk:async()=>{let[e]=await (0,r.Vx)((0,r.MX)(s.conv_uid));e||(await (null==o?void 0:o()),s.conv_uid===p&&d.push("/chat"))}})};return(0,l.jsxs)(D.Z,{align:"center",className:"group/item w-full h-12 p-3 rounded-lg  hover:bg-white dark:hover:bg-theme-dark cursor-pointer mb-2 relative ".concat(x?"bg-white dark:bg-theme-dark bg-opacity-100":""),onClick:()=>{i||(s.default||null==f||f({chat_scene:s.chat_mode,app_code:s.app_code}),localStorage.setItem("cur_dialog_info",JSON.stringify({chat_scene:s.chat_mode,app_code:s.app_code})),d.push(s.default?"/chat":"?scene=".concat(s.chat_mode,"&id=").concat(s.conv_uid)))},children:[(0,l.jsx)(J.Z,{title:s.chat_mode,children:(0,l.jsx)("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg mr-3 bg-white",children:s.icon})}),(0,l.jsx)("div",{className:"flex flex-1 line-clamp-1",children:(0,l.jsx)(M.Z.Text,{ellipsis:{tooltip:!0},children:s.label})}),!s.default&&(0,l.jsxs)("div",{className:"flex gap-1 ml-1",children:[(0,l.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation()},children:(0,l.jsx)(E.Z,{style:{fontSize:16},onClick:()=>{let e=B()("".concat(location.origin,"/chat?scene=").concat(s.chat_mode,"&id=").concat(s.conv_uid));H.ZP[e?"success":"error"](e?c("copy_success"):c("copy_failed"))}})}),(0,l.jsx)("div",{className:"group-hover/item:opacity-100 cursor-pointer opacity-0",onClick:e=>{e.stopPropagation(),g()},children:(0,l.jsx)(L.Z,{style:{fontSize:16}})})]}),(0,l.jsx)("div",{className:" w-1 rounded-sm bg-[#0c75fc] absolute top-1/2 left-0 -translate-y-1/2 transition-all duration-500 ease-in-out ".concat(x?"h-5":"w-0 h-0")})]})};var X=e=>{var t;let{dialogueList:a=[],refresh:r,historyLoading:s,listLoading:o,order:i,isCollapsed:c=!1}=e,d=(0,G.useSearchParams)(),h=null!==(t=null==d?void 0:d.get("scene"))&&void 0!==t?t:"",{t:p}=(0,U.$G)(),{mode:m}=(0,u.useContext)(n.p),[f,x]=(0,u.useState)(c||"chat_dashboard"===h),g=(0,u.useMemo)(()=>f?{...F,right:-16,borderRadius:"0px 8px 8px 0",borderLeft:"1px solid #d5e5f6"}:{...F,borderLeft:"1px solid #d6d8da"},[f]),v=(0,u.useMemo)(()=>{let e=a[1]||[];return(null==e?void 0:e.length)>0?e.map(e=>({...e,label:e.user_input||e.select_param,key:e.conv_uid,icon:(0,l.jsx)(q.Z,{scene:e.chat_mode}),default:!1})):[]},[a]);return(0,l.jsx)($,{className:"bg-[#ffffff80]  border-r  border-[#d5e5f6] dark:bg-[#ffffff29] dark:border-[#ffffff66]",theme:m,width:280,collapsible:!0,collapsed:f,collapsedWidth:0,trigger:f?(0,l.jsx)(I.Z,{className:"text-base"}):(0,l.jsx)(A.Z,{className:"text-base"}),zeroWidthTriggerStyle:g,onCollapse:e=>x(e),children:(0,l.jsxs)("div",{className:"flex flex-col h-full w-full bg-transparent px-4 pt-6  ",children:[(0,l.jsx)("div",{className:"w-full text-base font-semibold text-[#1c2533] dark:text-[rgba(255,255,255,0.85)] mb-4 line-clamp-1",children:p("dialog_list")}),(0,l.jsxs)(D.Z,{flex:1,vertical:!0,className:"overflow-y-auto",children:[(0,l.jsx)(K,{item:{label:p("assistant"),key:"default",icon:(0,l.jsx)(w(),{src:"/LOGO_SMALL.png",alt:"default",width:24,height:24,className:"flex-1"}),default:!0},order:i}),(0,l.jsx)(_.Z,{spinning:o,className:"mt-2",children:!!(null==v?void 0:v.length)&&v.map(e=>(0,l.jsx)(K,{item:e,refresh:r,historyLoading:s,order:i},null==e?void 0:e.key))})]})]})})},Y=a(7297);let Q=d()(()=>Promise.all([a.e(8201),a.e(9915),a.e(3075),a.e(2601),a.e(4426),a.e(4395),a.e(8223),a.e(9907),a.e(3046),a.e(3769),a.e(2102),a.e(3778),a.e(2780)]).then(a.bind(a,33555)),{loadableGenerated:{webpack:()=>[33555]},ssr:!1}),ee=d()(()=>Promise.all([a.e(8201),a.e(9915),a.e(4130),a.e(4521),a.e(768),a.e(5745),a.e(9066),a.e(3075),a.e(2601),a.e(4426),a.e(4226),a.e(5711),a.e(4486),a.e(7707),a.e(7200),a.e(4395),a.e(8223),a.e(6705),a.e(9907),a.e(3046),a.e(4465),a.e(3769),a.e(1633),a.e(2026),a.e(2466),a.e(4132),a.e(6414),a.e(2102),a.e(1013),a.e(8415),a.e(3527),a.e(2393)]).then(a.bind(a,59695)),{loadableGenerated:{webpack:()=>[59695]},ssr:!1}),{Content:et}=T.default,ea=(0,u.createContext)({history:[],replyLoading:!1,scrollRef:{current:null},canAbort:!1,chartsData:[],agent:"",currentDialogue:{},appInfo:{},temperatureValue:.5,maxNewTokensValue:1024,resourceValue:{},modelValue:"",setModelValue:()=>{},setResourceValue:()=>{},setTemperatureValue:()=>{},setMaxNewTokensValue:()=>{},setAppInfo:()=>{},setAgent:()=>{},setCanAbort:()=>{},setReplyLoading:()=>{},refreshDialogList:()=>{},refreshHistory:()=>{},refreshAppInfo:()=>{},setHistory:()=>{},handleChat:()=>Promise.resolve()});var el=(0,u.memo)(()=>{var e,t,a,o;let{model:i,currentDialogInfo:c}=(0,u.useContext)(n.p),{isContract:d,setIsContract:h,setIsMenuExpand:m}=(0,u.useContext)(n.p),{chat:f}=(0,s.Z)({app_code:c.app_code||""}),x=(0,G.useSearchParams)(),g=null!==(e=null==x?void 0:x.get("id"))&&void 0!==e?e:"",v=null!==(t=null==x?void 0:x.get("scene"))&&void 0!==t?t:"",b=null!==(a=null==x?void 0:x.get("knowledge_id"))&&void 0!==a?a:"",j=null!==(o=null==x?void 0:x.get("db_name"))&&void 0!==o?o:"",w=(0,u.useRef)(null),y=(0,u.useRef)(1),[N,k]=(0,u.useState)([]),[S]=(0,u.useState)(),[P,R]=(0,u.useState)(!1),[V,E]=(0,u.useState)(!1),[L,I]=(0,u.useState)(""),[A,W]=(0,u.useState)({}),[J,M]=(0,u.useState)(),[H,z]=(0,u.useState)(),[B,U]=(0,u.useState)(),[q,$]=(0,u.useState)("");(0,u.useEffect)(()=>{var e,t,a,l,n,r,s,o;M((null===(e=null==A?void 0:null===(t=A.param_need)||void 0===t?void 0:t.filter(e=>"temperature"===e.type)[0])||void 0===e?void 0:e.value)||.6),z((null===(a=null==A?void 0:null===(l=A.param_need)||void 0===l?void 0:l.filter(e=>"max_new_tokens"===e.type)[0])||void 0===a?void 0:a.value)||4e3),$((null===(n=null==A?void 0:null===(r=A.param_need)||void 0===r?void 0:r.filter(e=>"model"===e.type)[0])||void 0===n?void 0:n.value)||i),U(b||j||(null===(s=null==A?void 0:null===(o=A.param_need)||void 0===o?void 0:o.filter(e=>"resource"===e.type)[0])||void 0===s?void 0:s.bind_value))},[A,j,b,i]),(0,u.useEffect)(()=>{m("chat_dashboard"!==v),g&&v&&h(!1)},[g,v]);let F=(0,u.useMemo)(()=>!g&&!v,[g,v]),{data:K=[],refresh:el,loading:en}=(0,C.Z)(async()=>await (0,r.Vx)((0,r.iP)())),{run:er,refresh:es}=(0,C.Z)(async()=>await (0,r.Vx)((0,r.BN)({...c})),{manual:!0,onSuccess:e=>{let[,t]=e;W(t||{})}}),eo=(0,u.useMemo)(()=>{let[,e]=K;return(null==e?void 0:e.find(e=>e.conv_uid===g))||{}},[g,K]);(0,u.useEffect)(()=>{let e=(0,Z.a_)();c.chat_scene!==v||F||e&&e.message||er()},[g,c,F,er,v]);let{run:ei,loading:ec,refresh:ed}=(0,C.Z)(async()=>await (0,r.Vx)((0,r.$i)(g)),{manual:!0,onSuccess:e=>{let[,t]=e,a=null==t?void 0:t.filter(e=>"view"===e.role);a&&a.length>0&&(y.current=a[a.length-1].order+1),k(t||[])}}),eu=(0,u.useCallback)((e,t)=>new Promise(a=>{let l=(0,Z.a_)(),n=new AbortController;if(R(!0),N&&N.length>0){var r,s;let e=null==N?void 0:N.filter(e=>"view"===e.role),t=null==N?void 0:N.filter(e=>"human"===e.role);y.current=((null===(r=e[e.length-1])||void 0===r?void 0:r.order)||(null===(s=t[t.length-1])||void 0===s?void 0:s.order))+1}let o=[...l&&l.id===g?[]:N,{role:"human",context:e,model_name:(null==t?void 0:t.model_name)||q,order:y.current,time_stamp:0},{role:"view",context:"",model_name:(null==t?void 0:t.model_name)||q,order:y.current,time_stamp:0,thinking:!0}],i=o.length-1;k([...o]),f({data:{chat_mode:v,model_name:q,user_input:e,...t},ctrl:n,chatId:g,onMessage:e=>{E(!0),(null==t?void 0:t.incremental)?(o[i].context+=e,o[i].thinking=!1):(o[i].context=e,o[i].thinking=!1),k([...o])},onDone:()=>{R(!1),E(!1),a()},onClose:()=>{R(!1),E(!1),a()},onError:e=>{R(!1),E(!1),o[i].context=e,o[i].thinking=!1,k([...o]),a()}})}),[g,N,q,f,v]);return(0,Y.Z)(async()=>{if(F)return;let e=(0,Z.a_)();e&&e.id===g||await ei()},[g,v,ei]),(0,u.useEffect)(()=>{F&&(y.current=1,k([]))},[F]),(0,l.jsx)(ea.Provider,{value:{history:N,replyLoading:P,scrollRef:w,canAbort:V,chartsData:S||[],agent:L,currentDialogue:eo,appInfo:A,temperatureValue:J,maxNewTokensValue:H,resourceValue:B,modelValue:q,setModelValue:$,setResourceValue:U,setTemperatureValue:M,setMaxNewTokensValue:z,setAppInfo:W,setAgent:I,setCanAbort:E,setReplyLoading:R,handleChat:eu,refreshDialogList:el,refreshHistory:ed,refreshAppInfo:es,setHistory:k},children:(0,l.jsx)(D.Z,{flex:1,children:(0,l.jsxs)(T.default,{className:"bg-gradient-light bg-cover bg-center dark:bg-gradient-dark",children:[(0,l.jsx)(X,{refresh:el,dialogueList:K,listLoading:en,historyLoading:ec,order:y,isCollapsed:!0}),(0,l.jsx)(T.default,{className:"bg-transparent",children:"chat_dashboard"===v?d?(0,l.jsx)(Q,{}):(0,l.jsx)(ee,{}):F?(0,l.jsx)(et,{children:(0,l.jsx)(O,{})}):(0,l.jsx)(_.Z,{spinning:ec,className:"w-full h-full m-auto",children:(0,l.jsx)(et,{className:"flex flex-col h-screen",children:(0,l.jsx)(p,{ref:w})})})})]})})})})},2008:function(){}}]);