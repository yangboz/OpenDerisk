(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4158],{90726:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/prompt/[type]",function(){return a(16314)}])},76657:function(e,t,a){"use strict";var l=a(14059);t.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(l.C9))&&void 0!==e?e:"")}},46501:function(e,t,a){"use strict";var l=a(52676),s=a(22877),n=a(97858),r=a.n(n),o=a(75271);t.Z=(0,o.memo)(e=>{let{width:t,height:a,model:n}=e,i=(0,o.useMemo)(()=>(0,s.ab)(n||"huggingface"),[n]);return n?(0,l.jsx)(r(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:t||24,height:a||24,src:i,alt:"llm",priority:!0}):null})},16314:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSG:function(){return q}});var l=a(52676),s=a(40330),n=a(16019),r=a(76657),o=a(46501),i=a(51921),c=a(14059),p=a(38714),u=a(63464),d=a(8005),m=a(99426),_=a(33292),h=a(10901),x=a(73810),g=a(53362),f=a(62621),v=a(5783),y=a(49105),j=a(25377),b=a(46068),N=a(83233),w=a(25675),Z=a(63688),S=a(84875),E=a.n(S),C=a(66153),O=a(52373),F=a.n(O),V=a(87007),k=a(75271),I=a(24841);a(69164);var P=a(84581),A=a.n(P),J=a(2433);let R=F()(()=>a.e(3188).then(a.bind(a,93188)),{loadableGenerated:{webpack:()=>[93188]},ssr:!1}),T=new C.Z,L=F()(()=>Promise.all([a.e(8201),a.e(3732),a.e(4130),a.e(4521),a.e(7475),a.e(5745),a.e(9066),a.e(7806),a.e(191),a.e(2962),a.e(5467),a.e(9662),a.e(8862),a.e(6425),a.e(7004),a.e(1502),a.e(2763),a.e(8226),a.e(3769),a.e(7827),a.e(9842),a.e(653),a.e(4186),a.e(5628),a.e(9658),a.e(4593),a.e(5543),a.e(2486),a.e(1201),a.e(6031)]).then(a.bind(a,25331)),{loadableGenerated:{webpack:()=>[25331]},ssr:!1}),G=[{value:"Agent",label:"AGENT"},{value:"Scene",label:"SCENE"},{value:"Normal",label:"NORMAL"},{value:"Evaluate",label:"EVALUATE"}],M=e=>{let{value:t,onChange:a}=e,s=e=>{isNaN(e)||null==a||a(e)};return(0,l.jsxs)("div",{className:"flex items-center gap-8",children:[(0,l.jsx)(x.Z,{className:"w-40",min:0,max:1,step:.1,onChange:s,value:t}),(0,l.jsx)(g.Z,{className:"w-16",min:0,max:1,step:.1,value:t,onChange:s})]})};var q=!0;t.default=()=>{var e;let t=(0,V.useRouter)(),{type:a=""}=t.query,{t:x}=(0,I.$G)(),{modelList:g,model:S,mode:C}=(0,k.useContext)(s.p),O="dark"===C?m.R:_.K,{message:F}=f.Z.useApp(),P=(0,r.Z)(),[q,U]=(0,k.useState)(""),[H,W]=(0,k.useState)([]),[D,K]=(0,k.useState)({}),[X,z]=(0,k.useState)([]),[B,Y]=(0,k.useState)(!1),[$]=v.Z.useForm(),[Q]=v.Z.useForm(),[ee]=v.Z.useForm(),[et,ea]=(0,k.useState)(),el=v.Z.useWatch("prompt_type",$),es=(0,k.useMemo)(()=>g.map(e=>({value:e,label:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(o.Z,{model:e}),(0,l.jsx)("span",{className:"ml-2",children:e})]})})),[g]),en=(0,k.useCallback)(e=>{U(e.text)},[]),{data:er,run:eo,loading:ei}=(0,h.Z)(async e=>await (0,n.pm)(e),{manual:!0}),{run:ec}=(0,h.Z)(async e=>await (0,n.GU)({prompt_type:el,target:null!=e?e:""}),{manual:!0,onSuccess:e=>{if(e){let{data:t}=e.data;U(t.template),W(t.input_variables);try{let e=JSON.parse(t.response_format);K(e||{})}catch(e){K({})}}}}),{run:ep,loading:eu}=(0,h.Z)(async e=>"add"===a?await (0,n.Vx)((0,n.Hy)(e)):await (0,n.Vx)((0,n.Fu)(e)),{manual:!0,onSuccess:()=>{F.success("".concat("add"===a?x("Add"):x("update")).concat(x("success"))),t.replace("/construct/prompt")}}),ed=async()=>{if(B)return;let e=Q.getFieldsValue();if(!Object.values(e).every(e=>!!e)){F.warning(x("Please_complete_the_input_parameters"));return}if(!ee.getFieldValue("user_input")){F.warning(x("Please_fill_in_the_user_input"));return}$.validateFields().then(async t=>{let a={sub_chat_scene:"",model:ee.getFieldValue("model"),chat_scene:t.target,prompt_name:t.prompt_name,prompt_type:t.prompt_type,content:q,response_schema:JSON.stringify(D),input_variables:JSON.stringify(H),prompt_language:ee.getFieldValue("prompt_language"),prompt_desc:"",prompt_code:t.prompt_code,temperature:ee.getFieldValue("temperature"),debug_model:ee.getFieldValue("model"),input_values:{...e},user_input:ee.getFieldValue("user_input")},l=[{role:"view",context:""}],s=l.length-1;try{var n,r;Y(!0),await (0,u.L)("".concat(null!==(n=J.env.API_BASE_URL)&&void 0!==n?n:"","/prompt/template/debug"),{method:"POST",headers:{"Content-Type":"application/json",[c.gp]:null!==(r=(0,i.n5)())&&void 0!==r?r:""},body:JSON.stringify(a),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===u.a)return},onclose(){Y(!1)},onerror(e){throw Error(e)},onmessage:e=>{let t=e.data;if(t){try{t=JSON.parse(t).vis}catch(e){t.replaceAll("\\n","\n")}"[DONE]"===t?Y(!1):(null==t?void 0:t.startsWith("[ERROR]"))?(Y(!1),l[s].context=null==t?void 0:t.replace("[ERROR]","")):(l[s].context=t,z([...l]))}}})}catch(e){Y(!1),l[s].context="Sorry, we meet some error, please try again later",z([...l])}})},{run:em,loading:e_}=(0,h.Z)(async()=>await (0,n.Gn)({llm_out:X[0].context,prompt_type:$.getFieldValue("prompt_type"),chat_scene:$.getFieldValue("target")}),{manual:!0,onSuccess:e=>{var t,a;(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.success)?ea({msg:"验证通过",status:"success"}):ea({msg:null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.err_msg,status:"error"})}});(0,k.useEffect)(()=>{S&&ee.setFieldsValue({model:S})},[ee,S]),(0,k.useEffect)(()=>{el&&eo(el)},[eo,el]);let eh=(0,k.useMemo)(()=>{var e,t;return null==er?void 0:null===(e=er.data)||void 0===e?void 0:null===(t=e.data)||void 0===t?void 0:t.map(e=>({...e,value:e.name,label:e.name}))},[er]);return(0,k.useEffect)(()=>{if("edit"===a){var e;let t=JSON.parse(localStorage.getItem("edit_prompt_data")||"{}");W(JSON.parse(null!==(e=t.input_variables)&&void 0!==e?e:"[]")),U(null==t?void 0:t.content),$.setFieldsValue({prompt_type:t.prompt_type,prompt_name:t.prompt_name,prompt_code:t.prompt_code,target:t.chat_scene}),ee.setFieldsValue({model:t.model,prompt_language:t.prompt_language})}},[ee,$,a]),(0,l.jsxs)("div",{className:"flex flex-col w-full h-full justify-between dark:bg-gradient-dark ".concat(A()["prompt-operate-container"]),children:[(0,l.jsxs)("header",{className:"flex items-center justify-between px-6 py-2 h-14 border-b border-[#edeeef]",children:[(0,l.jsxs)(y.Z,{className:"flex items-center",children:[(0,l.jsx)(p.Z,{className:"text-base cursor-pointer hover:text-[#0c75fc]",onClick:()=>{localStorage.removeItem("edit_prompt_data"),t.replace("/construct/prompt")}}),(0,l.jsxs)("span",{className:"font-medium text-sm",children:["add"===a?x("Add"):x("Edit")," Prompt"]})]}),(0,l.jsx)(y.Z,{children:(0,l.jsx)(j.ZP,{type:"primary",onClick:()=>{$.validateFields().then(async e=>{let t={sub_chat_scene:"",model:ee.getFieldValue("model"),chat_scene:e.target,prompt_name:e.prompt_name,prompt_type:e.prompt_type,content:q,response_schema:JSON.stringify(D),input_variables:JSON.stringify(H),prompt_language:ee.getFieldValue("prompt_language"),prompt_desc:"",user_name:P.nick_name,..."edit"===a&&{prompt_code:e.prompt_code}};await ep(t)})},loading:eu,children:"add"===a?x("save"):x("update")})})]}),(0,l.jsxs)("section",{className:"flex h-full p-4 gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col flex-1 h-full overflow-y-auto pb-8 ",children:[(0,l.jsx)(R,{value:q,onChange:en,renderHTML:e=>T.render(e),view:{html:!1,md:!0,menu:!0}}),X.length>0&&(0,l.jsx)(b.Z,{title:(0,l.jsxs)(y.Z,{children:[(0,l.jsx)("span",{children:"LLM OUT"}),et&&(0,l.jsx)(N.Z,{message:et.msg,type:et.status,showIcon:!0})]}),className:"mt-2",children:(0,l.jsx)("div",{className:" max-h-[400px] overflow-y-auto",children:(0,l.jsx)(L,{children:null==X?void 0:null===(e=X[0])||void 0===e?void 0:e.context.replace(/\\n/gm,"\n")})})})]}),(0,l.jsxs)("div",{className:"flex flex-col w-2/5 pb-8 overflow-y-auto",children:[(0,l.jsx)(b.Z,{className:"mb-4",children:(0,l.jsxs)(v.Z,{form:$,children:[(0,l.jsxs)("div",{className:"flex w-full gap-1 justify-between",children:[(0,l.jsx)(v.Z.Item,{label:"Type",name:"prompt_type",className:"w-2/5",rules:[{required:!0,message:x("select_type")}],children:(0,l.jsx)(w.default,{options:G,placeholder:x("select_type"),allowClear:!0})}),(0,l.jsx)(v.Z.Item,{name:"target",className:"w-3/5",rules:[{required:!0,message:x("select_scene")}],children:(0,l.jsx)(w.default,{loading:ei,placeholder:x("select_scene"),allowClear:!0,showSearch:!0,onChange:async e=>{await ec(e)},children:null==eh?void 0:eh.map(e=>(0,l.jsx)(w.default.Option,{title:e.desc,children:e.label},e.value))})})]}),"edit"===a&&(0,l.jsx)(v.Z.Item,{label:"Code",name:"prompt_code",children:(0,l.jsx)(Z.default,{disabled:!0})}),(0,l.jsx)(v.Z.Item,{label:"Name",name:"prompt_name",className:"m-0",rules:[{required:!0,message:x("Please_input_prompt_name")}],children:(0,l.jsx)(Z.default,{placeholder:x("Please_input_prompt_name")})})]})}),(0,l.jsx)(b.Z,{title:x("input_parameter"),className:"mb-4",children:(0,l.jsx)(v.Z,{form:Q,children:H.length>0&&H.filter(e=>"out_schema"!==e).map(e=>(0,l.jsx)(v.Z.Item,{label:e,name:e,rules:[{message:"".concat(x("Please_Input")).concat(e)}],children:(0,l.jsx)(Z.default,{placeholder:x("Please_Input")})},e))})}),(0,l.jsxs)(b.Z,{title:x("output_structure"),className:"flex flex-col flex-1",children:[(0,l.jsx)(d.ZP,{style:{...O,width:"100%",padding:4},className:E()({"bg-[#fafafa]":"light"===C}),value:D,enableClipboard:!1,displayDataTypes:!1,objectSortKeys:!1}),(0,l.jsx)("div",{className:"flex flex-col mt-4",children:(0,l.jsxs)(v.Z,{form:ee,initialValues:{model:S,temperature:.5,prompt_language:"en"},children:[(0,l.jsx)(v.Z.Item,{label:x("model"),name:"model",children:(0,l.jsx)(w.default,{className:"h-8 rounded-3xl",options:es,allowClear:!0,showSearch:!0})}),(0,l.jsx)(v.Z.Item,{label:x("temperature"),name:"temperature",children:(0,l.jsx)(M,{})}),(0,l.jsx)(v.Z.Item,{label:x("language"),name:"prompt_language",children:(0,l.jsx)(w.default,{options:[{label:x("English"),value:"en"},{label:x("Chinese"),value:"zh"}]})}),(0,l.jsx)(v.Z.Item,{label:x("User_input"),name:"user_input",children:(0,l.jsx)(Z.default,{placeholder:x("Please_Input")})})]})}),(0,l.jsxs)(y.Z,{className:"flex justify-between",children:[(0,l.jsx)(j.ZP,{type:"primary",onClick:ed,loading:B,children:x("LLM_test")}),(0,l.jsx)(j.ZP,{type:"primary",onClick:async()=>{var e;!e_&&(null===(e=X[0])||void 0===e?void 0:e.context)&&await em()},children:x("Output_verification")})]})]})]})]})]})}},84581:function(e){e.exports={"prompt-container":"styles_prompt-container__S6dYE","prompt-operate-container":"styles_prompt-operate-container__cpqq1"}}},function(e){e.O(0,[9557,5230,3688,3129,5675,5783,3894,3810,7365,5284,7312,6068,5459,9774,2888,179],function(){return e(e.s=90726)}),_N_E=e.O()}]);