(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2780],{74266:function(e,o,n){var t={"./simpleWorker":50223,"./simpleWorker.js":50223,"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/base/common/worker/simpleWorker":50223,"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/base/common/worker/simpleWorker.js":50223};function r(e){return Promise.resolve().then(function(){if(!n.o(t,e)){var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return n(t[e])})}r.keys=function(){return Object.keys(t)},r.id=74266,e.exports=r},79410:function(e,o,n){var t={"./editorBaseApi":[54726],"./editorBaseApi.js":[54726],"./editorSimpleWorker":[56216],"./editorSimpleWorker.js":[56216],"./editorWorker":[14541],"./editorWorker.js":[14541],"./editorWorkerHost":[7570],"./editorWorkerHost.js":[7570],"./findSectionHeaders":[26767],"./findSectionHeaders.js":[26767],"./getIconClasses":[25129],"./getIconClasses.js":[25129],"./languageFeatureDebounce":[27825],"./languageFeatureDebounce.js":[27825],"./languageFeatures":[47924],"./languageFeatures.js":[47924],"./languageFeaturesService":[26524],"./languageFeaturesService.js":[26524],"./languageService":[39920],"./languageService.js":[39920],"./languagesAssociations":[15981],"./languagesAssociations.js":[15981],"./languagesRegistry":[27921],"./languagesRegistry.js":[27921],"./markerDecorations":[90231],"./markerDecorations.js":[90231],"./markerDecorationsService":[15761],"./markerDecorationsService.js":[15761],"./model":[42361],"./model.js":[42361],"./modelService":[95451],"./modelService.js":[95451],"./resolverService":[16417],"./resolverService.js":[16417],"./semanticTokensDto":[77263],"./semanticTokensDto.js":[77263],"./semanticTokensProviderStyling":[89094],"./semanticTokensProviderStyling.js":[89094],"./semanticTokensStyling":[51819],"./semanticTokensStyling.js":[51819],"./semanticTokensStylingService":[79837],"./semanticTokensStylingService.js":[79837],"./textModelSync/textModelSync.impl":[48838],"./textModelSync/textModelSync.impl.js":[48838],"./textModelSync/textModelSync.protocol":[45858,5858],"./textModelSync/textModelSync.protocol.js":[45858,5858],"./textResourceConfiguration":[95633],"./textResourceConfiguration.js":[95633],"./treeSitterParserService":[25224],"./treeSitterParserService.js":[25224],"./treeViewsDnd":[10234],"./treeViewsDnd.js":[10234],"./treeViewsDndService":[8743],"./treeViewsDndService.js":[8743],"./unicodeTextModelHighlighter":[69810],"./unicodeTextModelHighlighter.js":[69810],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorBaseApi":[54726],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorBaseApi.js":[54726],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker":[56216],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker.js":[56216],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorker":[14541],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorker.js":[14541],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerHost":[7570],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerHost.js":[7570],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/findSectionHeaders":[26767],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/findSectionHeaders.js":[26767],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses":[25129],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses.js":[25129],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce":[27825],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js":[27825],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatures":[47924],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatures.js":[47924],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeaturesService":[26524],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeaturesService.js":[26524],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageService":[39920],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageService.js":[39920],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations":[15981],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js":[15981],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry":[27921],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry.js":[27921],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorations":[90231],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorations.js":[90231],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService":[15761],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService.js":[15761],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/model":[42361],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/model.js":[42361],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/modelService":[95451],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/modelService.js":[95451],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/resolverService":[16417],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/resolverService.js":[16417],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensDto":[77263],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensDto.js":[77263],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling":[89094],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling.js":[89094],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStyling":[51819],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStyling.js":[51819],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService":[79837],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService.js":[79837],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl":[48838],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl.js":[48838],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol":[45858,5858],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol.js":[45858,5858],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfiguration":[95633],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfiguration.js":[95633],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeSitterParserService":[25224],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeSitterParserService.js":[25224],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDnd":[10234],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDnd.js":[10234],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDndService":[8743],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDndService.js":[8743],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter":[69810],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter.js":[69810]};function r(e){if(!n.o(t,e))return Promise.resolve().then(function(){var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o});var o=t[e],r=o[0];return Promise.all(o.slice(1).map(n.e)).then(function(){return n(r)})}r.keys=function(){return Object.keys(t)},r.id=79410,e.exports=r},19518:function(e,o,n){"use strict";n.d(o,{_:function(){return q},a:function(){return E}});var t=n(52676),r=n(21011),i=n(8080),a=n(30426),l=n(33394),d=n(62601),s=n(12424),c=n(19475),u=n(53832),m=n(40389),f=n(41148),v=n(57107),h=n(32699),g=n(75271);let p=e=>{if(!e)return;let o=e.getContainer(),n=o.getElementsByTagName("canvas")[0];return n};var x=n(35462),k=n(54554);let y=e=>{let{charts:o,scopeOfCharts:n,ruleConfig:t}=e,r={};if(null==o||o.forEach(e=>{if(e.chartKnowledge.toSpec){let o=e.chartKnowledge.toSpec;e.chartKnowledge.toSpec=(e,n)=>({...o(e,n),dataProps:n})}else e.chartKnowledge.toSpec=(e,o)=>({dataProps:o});r[e.chartType]=e.chartKnowledge}),(null==n?void 0:n.exclude)&&n.exclude.forEach(e=>{Object.keys(r).includes(e)&&delete r[e]}),null==n?void 0:n.include){let e=n.include;Object.keys(r).forEach(o=>{e.includes(o)||delete r[o]})}let i={...n,custom:r},a={...t},l=new x.w({ckbCfg:i,ruleCfg:a});return l},b=e=>{var o;let{data:n,dataMetaMap:t,myChartAdvisor:r}=e,i=t?Object.keys(t).map(e=>({name:e,...t[e]})):null,a=new k.Z(n).info(),l=(0,h.size)(a)>2?null==a?void 0:a.filter(e=>"string"!==e.recommendation&&"date"!==e.recommendation||e.distinct&&e.distinct>1):a,d=null==r?void 0:r.adviseWithLog({data:n,dataProps:i,fields:null==l?void 0:l.map(e=>e.name)});return null!==(o=null==d?void 0:d.advices)&&void 0!==o?o:[]};function _(e,o){return o.every(o=>e.includes(o))}function j(e,o){let n=o.find(o=>o.name===e);return(null==n?void 0:n.recommendation)==="date"?o=>new Date(o[e]):e}function w(e){return e.find(e=>{var o;return e.levelOfMeasurements&&(o=e.levelOfMeasurements,["Time","Ordinal"].some(e=>o.includes(e)))})}function S(e){return e.find(e=>e.levelOfMeasurements&&_(e.levelOfMeasurements,["Nominal"]))}let C=e=>{let{data:o,xField:n}=e,t=(0,h.uniq)(o.map(e=>e[n]));return t.length<=1},N=(e,o,n)=>{let{field4Split:t,field4X:r}=n;if((null==t?void 0:t.name)&&(null==r?void 0:r.name)){let n=e[t.name],i=o.filter(e=>t.name&&e[t.name]===n);return C({data:i,xField:r.name})?5:void 0}return(null==r?void 0:r.name)&&C({data:o,xField:r.name})?5:void 0},Z=e=>{let{data:o,chartType:n,xField:t}=e,r=(0,h.cloneDeep)(o);try{if(n.includes("line")&&(null==t?void 0:t.name)&&"date"===t.recommendation)return r.sort((e,o)=>new Date(e[t.name]).getTime()-new Date(o[t.name]).getTime()),r;n.includes("line")&&(null==t?void 0:t.name)&&["float","integer"].includes(t.recommendation)&&r.sort((e,o)=>e[t.name]-o[t.name])}catch(e){console.error(e)}return r},M=function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-";return e.map(e=>{let n={};return Object.keys(e).forEach(t=>{n[t]=e[t]===o?null:e[t]}),n})},P="multi_line_chart",D="multi_measure_line_chart",T=[{chartType:"multi_line_chart",chartKnowledge:{id:P,name:"multi_line_chart",alias:["multi_line_chart"],family:["LineCharts"],def:"multi_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Trend"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:1,fieldConditions:["Time","Ordinal"]},{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:0,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,o)=>{var n,t;let r=w(o),i=S(o),a=null!==(n=null!=r?r:i)&&void 0!==n?n:o[0],l=o.filter(e=>e.name!==(null==a?void 0:a.name)),d=null!==(t=l.filter(e=>e.levelOfMeasurements&&_(e.levelOfMeasurements,["Interval"])))&&void 0!==t?t:[l[0]],s=l.filter(e=>!d.find(o=>o.name===e.name)).find(e=>e.levelOfMeasurements&&_(e.levelOfMeasurements,["Nominal"]));if(!a||!d)return null;let c={type:"view",autoFit:!0,data:Z({data:e,chartType:P,xField:a}),children:[]};return d.forEach(n=>{let t={type:"line",encode:{x:j(a.name,o),y:n.name,size:o=>N(o,e,{field4Split:s,field4X:a})},legend:{size:!1}};s&&(t.encode.color=s.name),c.children.push(t)}),c}},chineseName:"折线图"},{chartType:"multi_measure_column_chart",chartKnowledge:{id:"multi_measure_column_chart",name:"multi_measure_column_chart",alias:["multi_measure_column_chart"],family:["ColumnCharts"],def:"multi_measure_column_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,o)=>{try{let n=null==o?void 0:o.filter(e=>_(e.levelOfMeasurements,["Interval"])),t=S(o),r=w(o),i=null!=t?t:r;if(!i||!n)return null;let a={type:"view",data:e,children:[]};return null==n||n.forEach(e=>{let o={type:"interval",encode:{x:i.name,y:e.name,color:()=>e.name,series:()=>e.name}};a.children.push(o)}),a}catch(e){return console.log(e),null}}},chineseName:"折线图"},{chartType:"multi_measure_line_chart",chartKnowledge:{id:D,name:"multi_measure_line_chart",alias:["multi_measure_line_chart"],family:["LineCharts"],def:"multi_measure_line_chart uses lines with segments to show changes in data in a ordinal dimension",purpose:["Comparison","Distribution"],coord:["Cartesian2D"],category:["Statistic"],shape:["Lines"],dataPres:[{minQty:1,maxQty:"*",fieldConditions:["Interval"]},{minQty:1,maxQty:1,fieldConditions:["Nominal"]}],channel:["Color","Direction","Position"],recRate:"Recommended",toSpec:(e,o)=>{try{var n,t;let r=null!==(t=null!==(n=S(o))&&void 0!==n?n:w(o))&&void 0!==t?t:o[0],i=null==o?void 0:o.filter(e=>e.name!==(null==r?void 0:r.name)&&_(e.levelOfMeasurements,["Interval"]));if(!r||!i)return null;let a={type:"view",data:Z({data:e,chartType:D,xField:r}),children:[]};return null==i||i.forEach(n=>{let t={type:"line",encode:{x:j(r.name,o),y:n.name,color:()=>n.name,series:()=>n.name,size:o=>N(o,e,{field4X:r})},legend:{size:!1}};a.children.push(t)}),a}catch(e){return console.log(e),null}}},chineseName:"折线图"}],E=e=>"response_line_chart"===e?["multi_line_chart","multi_measure_line_chart"]:"response_bar_chart"===e?["multi_measure_column_chart"]:"response_pie_chart"===e?["pie_chart"]:"response_scatter_chart"===e?["scatter_plot"]:"response_area_chart"===e?["area_chart"]:"response_heatmap_chart"===e?["heatmap"]:[],{Option:O}=d.default,q=e=>{let{data:o,chartType:n,scopeOfCharts:x,ruleConfig:k}=e,_=M(o),{mode:j}=(0,g.useContext)(r.p),[w,S]=(0,g.useState)(),[C,N]=(0,g.useState)([]),[P,D]=(0,g.useState)(),E=(0,g.useRef)();(0,g.useEffect)(()=>{S(y({charts:T,scopeOfCharts:{exclude:["area_chart","stacked_area_chart","percent_stacked_area_chart"]},ruleConfig:k}))},[k,x]);let q=e=>{if(!w)return[];let o=function(e){let{advices:o}=e;return o}({advices:e}),t=(0,h.uniq)((0,h.compact)((0,h.concat)(n,e.map(e=>e.type)))),r=t.map(e=>{let n=o.find(o=>o.type===e);if(n)return n;let t=w.dataAnalyzer.execute({data:_});if("data"in t){var r;let o=w.specGenerator.execute({data:t.data,dataProps:t.dataProps,chartTypeRecommendations:[{chartType:e,score:1}]});if("advices"in o)return null===(r=o.advices)||void 0===r?void 0:r[0]}}).filter(e=>null==e?void 0:e.spec);return r};(0,g.useEffect)(()=>{if(_&&w){var e;let o=b({data:_,myChartAdvisor:w}),n=q(o);N(n),D(null===(e=n[0])||void 0===e?void 0:e.type)}},[JSON.stringify(_),w,n]);let H=(0,g.useMemo)(()=>{if((null==C?void 0:C.length)>0){var e,o,n,r;let i=null!=P?P:C[0].type,a=null!==(o=null===(e=null==C?void 0:C.find(e=>e.type===i))||void 0===e?void 0:e.spec)&&void 0!==o?o:void 0;if(a){if(a.data&&["line_chart","step_line_chart"].includes(i)){let e=null==w?void 0:w.dataAnalyzer.execute({data:_});e&&"dataProps"in e&&(a.data=Z({data:a.data,xField:null===(r=e.dataProps)||void 0===r?void 0:r.find(e=>"date"===e.recommendation),chartType:i}))}return"pie_chart"===i&&(null==a?void 0:null===(n=a.encode)||void 0===n?void 0:n.color)&&(a.tooltip={title:{field:a.encode.color}}),(0,t.jsx)(l.k,{options:{...a,autoFit:!0,theme:j,height:300},ref:E},i)}}},[C,j,P]);return P?(0,t.jsxs)("div",{children:[(0,t.jsxs)(s.Z,{justify:"space-between",className:"mb-2",children:[(0,t.jsx)(c.Z,{children:(0,t.jsxs)(u.Z,{children:[(0,t.jsx)("span",{children:i.Z.t("Advices")}),(0,t.jsx)(d.default,{className:"w-52",value:P,placeholder:"Chart Switcher",onChange:e=>D(e),size:"small",children:null==C?void 0:C.map(e=>{let o=i.Z.t(e.type);return(0,t.jsx)(O,{value:e.type,children:(0,t.jsx)(m.Z,{title:o,placement:"right",children:(0,t.jsx)("div",{children:o})})},e.type)})})]})}),(0,t.jsx)(c.Z,{children:(0,t.jsx)(m.Z,{title:i.Z.t("Download"),children:(0,t.jsx)(f.ZP,{onClick:()=>(function(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart",n=document.createElement("a"),t="".concat(o,".png");setTimeout(()=>{let o=function(e){let o=p(e);if(o){let e=o.toDataURL("image/png");return e}}(e);if(o){n.addEventListener("click",()=>{n.download=t,n.href=o});let e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),n.dispatchEvent(e)}},16)})(E.current,i.Z.t(P)),icon:(0,t.jsx)(a.Z,{}),type:"text"})})})]}),(0,t.jsx)("div",{className:"flex",children:H})]}):(0,t.jsx)(v.Z,{image:v.Z.PRESENTED_IMAGE_SIMPLE,description:"暂无合适的可视化视图"})}},78471:function(e,o,n){"use strict";n.d(o,{_z:function(){return h._},ZP:function(){return g},aG:function(){return h.a}});var t=n(52676),r=n(21521),i=n(13053),a=n(13501),l=n(75271),d=n(21011),s=n(33394);function c(e){let{chart:o}=e,{mode:n}=(0,l.useContext)(d.p);return(0,t.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,t.jsxs)("div",{className:"h-full",children:[(0,t.jsx)("div",{className:"mb-2",children:o.chart_name}),(0,t.jsx)("div",{className:"opacity-80 text-sm mb-2",children:o.chart_desc}),(0,t.jsx)("div",{className:"h-[300px]",children:(0,t.jsx)(s.k,{style:{height:"100%"},options:{autoFit:!0,theme:n,type:"interval",data:o.values,encode:{x:"name",y:"value",color:"type"},axis:{x:{labelAutoRotate:!1}}}})})]})})}function u(e){let{chart:o}=e,{mode:n}=(0,l.useContext)(d.p);return(0,t.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,t.jsxs)("div",{className:"h-full",children:[(0,t.jsx)("div",{className:"mb-2",children:o.chart_name}),(0,t.jsx)("div",{className:"opacity-80 text-sm mb-2",children:o.chart_desc}),(0,t.jsx)("div",{className:"h-[300px]",children:(0,t.jsx)(s.k,{style:{height:"100%"},options:{autoFit:!0,theme:n,type:"view",data:o.values,children:[{type:"line",encode:{x:"name",y:"value",color:"type",shape:"smooth"}},{type:"area",encode:{x:"name",y:"value",color:"type",shape:"smooth"},legend:!1,style:{fillOpacity:.15}}],axis:{x:{labelAutoRotate:!1}}}})})]})})}var m=n(6354),f=n(32699);function v(e){var o,n;let{chart:r}=e,i=(0,f.groupBy)(r.values,"type");return(0,t.jsx)("div",{className:"flex-1 min-w-0 p-4 bg-white dark:bg-theme-dark-container rounded",children:(0,t.jsxs)("div",{className:"h-full",children:[(0,t.jsx)("div",{className:"mb-2",children:r.chart_name}),(0,t.jsx)("div",{className:"opacity-80 text-sm mb-2",children:r.chart_desc}),(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)(m.Z,{"aria-label":"basic table",stripe:"odd",hoverRow:!0,borderAxis:"bothBetween",children:[(0,t.jsx)("thead",{children:(0,t.jsx)("tr",{children:Object.keys(i).map(e=>(0,t.jsx)("th",{children:e},e))})}),(0,t.jsx)("tbody",{children:null===(o=Object.values(i))||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.map((e,o)=>{var n;return(0,t.jsx)("tr",{children:null===(n=Object.keys(i))||void 0===n?void 0:n.map(e=>{var n;return(0,t.jsx)("td",{children:(null==i?void 0:null===(n=i[e])||void 0===n?void 0:n[o].value)||""},e)})},o)})})]})})]})})}var h=n(19518),g=function(e){let{chartsData:o}=e,n=(0,l.useMemo)(()=>{if(o){let e=[],n=null==o?void 0:o.filter(e=>"IndicatorValue"===e.chart_type);n.length>0&&e.push({charts:n,type:"IndicatorValue"});let t=null==o?void 0:o.filter(e=>"IndicatorValue"!==e.chart_type),r=t.length,i=0;return[[0],[1],[2],[1,2],[1,3],[2,1,2],[2,1,3],[3,1,3],[3,2,3]][r].forEach(o=>{if(o>0){let n=t.slice(i,i+o);i+=o,e.push({charts:n})}}),e}},[o]);return(0,t.jsx)("div",{className:"flex flex-col gap-3",children:null==n?void 0:n.map((e,o)=>(0,t.jsx)("div",{className:"".concat((null==e?void 0:e.type)!=="IndicatorValue"?"flex gap-3":""),children:e.charts.map(e=>"IndicatorValue"===e.chart_type||"IndicatorValue"===e.type?(0,t.jsx)("div",{className:"flex flex-row gap-3",children:e.values.map(e=>(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(r.Z,{sx:{background:"transparent"},children:(0,t.jsxs)(i.Z,{className:"justify-around",children:[(0,t.jsx)(a.ZP,{gutterBottom:!0,component:"div",children:e.name}),(0,t.jsx)(a.ZP,{children:e.value})]})})},e.name))},e.chart_uid):"LineChart"===e.chart_type||"LineChart"===e.type?(0,t.jsx)(u,{chart:e},e.chart_uid):"BarChart"===e.chart_type||"BarChart"===e.type?(0,t.jsx)(c,{chart:e},e.chart_uid):"Table"===e.chart_type||"TableChartData"===e.type?(0,t.jsx)(v,{chart:e},e.chart_uid):void 0)},"chart_row_".concat(o)))})}},33555:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return T}});var t=n(52676),r=n(32176),i=n(75509),a=n(99113),l=n(72423),d=n(63046),s=n(40389),c=n(62601),u=n(5041),m=n(41148),f=n(29052),v=n(75271),h=n(78471),g=n(88788),p=n(94138),x=function(){return(0,t.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,t.jsx)("path",{d:"M161.05472 919.3472h701.9008a58.71616 58.71616 0 0 0 58.65472-58.65472V180.40832a58.71616 58.71616 0 0 0-58.65472-58.65472H161.09568a58.03008 58.03008 0 0 0-41.4208 17.08032A58.1632 58.1632 0 0 0 102.4 180.30592v680.38656a58.64448 58.64448 0 0 0 58.65472 58.65472z m385.15712-589.568V190.08512h306.95424v660.93056H546.21184V329.7792zM170.83392 190.08512h306.95424v660.93056H170.83392V190.08512z"})})},k=function(){return(0,t.jsx)("svg",{width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 1024 1024",version:"1.1",children:(0,t.jsx)("path",{d:"M171.85792 110.9504a58.65472 58.65472 0 0 0-58.65472 58.65472v701.9008a58.7264 58.7264 0 0 0 58.65472 58.65472h680.28416a58.7264 58.7264 0 0 0 58.65472-58.65472V169.64608a57.98912 57.98912 0 0 0-17.08032-41.41056 58.1632 58.1632 0 0 0-41.472-17.27488H171.85792z m670.60736 750.77632H181.53472V554.77248h660.93056v306.95424z m0-375.38816H181.53472V179.38432h660.93056v306.95424z"})})},y=n(61606),b=n(27806),_=n(73813),j=n(9717),w=n(82187),S=n.n(w),C=n(35202);function N(){return(0,t.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,t.jsx)("path",{d:"M512 64c-247.424 0-448 62.72-448 140.032v112c0 77.312 200.576 139.968 448 139.968s448-62.72 448-140.032v-112C960 126.72 759.424 64 512 64z m0 728c-247.424 0-448-62.72-448-140.032v168.064C64 897.28 264.576 960 512 960s448-62.72 448-140.032v-167.936c0 77.312-200.576 139.968-448 139.968z",fill:"#3699FF"}),(0,t.jsx)("path",{d:"M512 540.032c-247.424 0-448-62.72-448-140.032v168c0 77.312 200.576 140.032 448 140.032s448-62.72 448-140.032V400c0 77.312-200.576 140.032-448 140.032z",fill:"#3699FF",opacity:".32"})]})}function Z(){return(0,t.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:(0,t.jsx)("path",{d:"M39.385 204.83h346.571L252.054 976.74l-23.63 39.383h259.929v-31.506L614.379 204.83H771.91S960.951 220.584 984.581 0.038H236.3S94.52-7.84 39.384 204.83",fill:"#1296db"})})}function M(){return(0,t.jsxs)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",children:[(0,t.jsx)("path",{d:"M149.2 99.7h726.6c27.7 0 50.1 22.4 50.1 50.1V336H99.1V149.8c0-27.6 22.4-50.1 50.1-50.1z",fill:"#1ECD93"}),(0,t.jsx)("path",{d:"M99.1 395h236.2v236.3H99.1zM99.1 690.3h236.2v236.2H149.2c-27.7 0-50.1-22.4-50.1-50.1V690.3zM394.4 395h236.2v236.3H394.4z",fill:"#1ECD93",fillOpacity:".5"}),(0,t.jsx)("path",{d:"M394.4 690.3h236.2v236.3H394.4z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i13.27343a81CqKUWU"}),(0,t.jsx)("path",{d:"M689.7 395h236.2v236.3H689.7z",fill:"#1ECD93",fillOpacity:".5"}),(0,t.jsx)("path",{d:"M689.7 690.3h236.2v186.1c0 27.7-22.4 50.1-50.1 50.1H689.7V690.3z",fill:"#A1E6C9","data-spm-anchor-id":"a313x.search_index.0.i17.27343a81CqKUWU"})]})}let{Search:P}=l.default;function D(e){let{layout:o="LR",editorValue:n,chartData:r,tableData:i,tables:a,handleChange:l}=e,s=(0,v.useMemo)(()=>r?(0,t.jsx)("div",{className:"flex-1 overflow-auto p-2",style:{flexShrink:0,overflow:"hidden"},children:(0,t.jsx)(h.ZP,{chartsData:[r]})}):null,[r]),{columns:c,dataSource:u}=(0,v.useMemo)(()=>{let{columns:e=[],values:o=[]}=null!=i?i:{},n=e.map(e=>({key:e,dataIndex:e,title:e})),t=o.map(o=>o.reduce((o,n,t)=>(o[e[t]]=n,o),{}));return{columns:n,dataSource:t}},[i]),m=(0,v.useMemo)(()=>{let e={},o=null==a?void 0:a.data,n=null==o?void 0:o.children;return null==n||n.forEach(o=>{e[o.title]=o.children.map(e=>({columnName:e.title,columnType:e.type}))}),{getTableList:async e=>e&&e!==(null==o?void 0:o.title)?[]:(null==n?void 0:n.map(e=>e.title))||[],getTableColumns:async o=>e[o]||[],getSchemaList:async()=>(null==o?void 0:o.title)?[null==o?void 0:o.title]:[]}},[a]);return(0,t.jsxs)("div",{className:S()("flex w-full flex-1 h-full gap-2 overflow-hidden",{"flex-col":"TB"===o,"flex-row":"LR"===o}),children:[(0,t.jsx)("div",{className:"flex-1 flex overflow-hidden rounded",children:(0,t.jsx)(p.Z,{value:(null==n?void 0:n.sql)||"",language:"mysql",onChange:l,thoughts:(null==n?void 0:n.thoughts)||"",session:m})}),(0,t.jsxs)("div",{className:"flex-1 h-full overflow-auto bg-white dark:bg-theme-dark-container rounded p-4",children:[(null==i?void 0:i.values.length)?(0,t.jsx)(d.Z,{bordered:!0,scroll:{x:"auto"},rowKey:c[0].key,columns:c,dataSource:u}):(0,t.jsx)("div",{className:"h-full flex justify-center items-center",children:(0,t.jsx)(C.Z,{})}),s]})]})}var T=function(){var e,o,n,l,d;let[h,p]=(0,v.useState)([]),[w,C]=(0,v.useState)(""),[T,E]=(0,v.useState)(),[O,q]=(0,v.useState)(!0),[H,R]=(0,v.useState)(),[F,B]=(0,v.useState)(),[V,z]=(0,v.useState)(),[L,A]=(0,v.useState)(),[I,W]=(0,v.useState)(),[U,Q]=(0,v.useState)(!1),[K,G]=(0,v.useState)("TB"),$=(0,f.useSearchParams)(),J=null==$?void 0:$.get("id"),Y=null==$?void 0:$.get("scene"),{data:X}=(0,a.Z)(async()=>await (0,r.Tk)("/v1/editor/sql/rounds",{con_uid:J}),{onSuccess:e=>{var o,n;let t=null==e?void 0:null===(o=e.data)||void 0===o?void 0:o[(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.length)-1];t&&E(null==t?void 0:t.round)}}),{run:ee,loading:eo}=(0,a.Z)(async()=>{var e,o;let n=null===(e=null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.find(e=>e.round===T))||void 0===e?void 0:e.db_name;return await (0,r.PR)("/api/v1/editor/sql/run",{db_name:n,sql:null==V?void 0:V.sql})},{manual:!0,onSuccess:e=>{var o,n;A({columns:null==e?void 0:null===(o=e.data)||void 0===o?void 0:o.colunms,values:null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.values})}}),{run:en,loading:et}=(0,a.Z)(async()=>{var e,o;let n=null===(e=null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.find(e=>e.round===T))||void 0===e?void 0:e.db_name,t={db_name:n,sql:null==V?void 0:V.sql};return"chat_dashboard"===Y&&(t.chart_type=null==V?void 0:V.showcase),await (0,r.PR)("/api/v1/editor/chart/run",t)},{manual:!0,ready:!!(null==V?void 0:V.sql),onSuccess:e=>{if(null==e?void 0:e.success){var o,n,t,r,i,a,l;A({columns:(null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(n=o.sql_data)||void 0===n?void 0:n.colunms)||[],values:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(r=t.sql_data)||void 0===r?void 0:r.values)||[]}),(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.chart_values)?R({type:null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.chart_type,values:null==e?void 0:null===(l=e.data)||void 0===l?void 0:l.chart_values,title:null==V?void 0:V.title,description:null==V?void 0:V.thoughts}):R(void 0)}}}),{run:er,loading:ei}=(0,a.Z)(async()=>{var e,o,n,t,i;let a=null===(e=null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.find(e=>e.round===T))||void 0===e?void 0:e.db_name;return await (0,r.PR)("/api/v1/sql/editor/submit",{conv_uid:J,db_name:a,conv_round:T,old_sql:null==F?void 0:F.sql,old_speak:null==F?void 0:F.thoughts,new_sql:null==V?void 0:V.sql,new_speak:(null===(n=null==V?void 0:null===(t=V.thoughts)||void 0===t?void 0:t.match(/^\n--(.*)\n\n$/))||void 0===n?void 0:null===(i=n[1])||void 0===i?void 0:i.trim())||(null==V?void 0:V.thoughts)})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&ee()}}),{run:ea,loading:el}=(0,a.Z)(async()=>{var e,o,n,t,i,a;let l=null===(e=null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.find(e=>e.round===T))||void 0===e?void 0:e.db_name;return await (0,r.PR)("/api/v1/chart/editor/submit",{conv_uid:J,chart_title:null==V?void 0:V.title,db_name:l,old_sql:null==F?void 0:null===(n=F[null!=I?I:0])||void 0===n?void 0:n.sql,new_chart_type:null==V?void 0:V.showcase,new_sql:null==V?void 0:V.sql,new_comment:(null===(t=null==V?void 0:null===(i=V.thoughts)||void 0===i?void 0:i.match(/^\n--(.*)\n\n$/))||void 0===t?void 0:null===(a=t[1])||void 0===a?void 0:a.trim())||(null==V?void 0:V.thoughts),gmt_create:new Date().getTime()})},{manual:!0,onSuccess:e=>{(null==e?void 0:e.success)&&en()}}),{data:ed}=(0,a.Z)(async()=>{var e,o;let n=null===(e=null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.find(e=>e.round===T))||void 0===e?void 0:e.db_name;return await (0,r.Tk)("/v1/editor/db/tables",{db_name:n,page_index:1,page_size:200})},{ready:!!(null===(e=null==X?void 0:null===(o=X.data)||void 0===o?void 0:o.find(e=>e.round===T))||void 0===e?void 0:e.db_name),refreshDeps:[null===(n=null==X?void 0:null===(l=X.data)||void 0===l?void 0:l.find(e=>e.round===T))||void 0===n?void 0:n.db_name]}),{run:es}=(0,a.Z)(async e=>await (0,r.Tk)("/v1/editor/sql",{con_uid:J,round:e}),{manual:!0,onSuccess:e=>{let o;try{if(Array.isArray(null==e?void 0:e.data))o=null==e?void 0:e.data,W(0);else if("string"==typeof(null==e?void 0:e.data)){let n=JSON.parse(null==e?void 0:e.data);o=n}else o=null==e?void 0:e.data}catch(e){console.log(e)}finally{B(o),Array.isArray(o)?z(null==o?void 0:o[Number(I||0)]):z(o)}}}),ec=(0,v.useMemo)(()=>{let e=(o,n)=>o.map(o=>{let r=o.title,i=r.indexOf(w),a=r.substring(0,i),l=r.slice(i+w.length),d=e=>{switch(e){case"db":return(0,t.jsx)(N,{});case"table":return(0,t.jsx)(M,{});default:return(0,t.jsx)(Z,{})}},c=i>-1?(0,t.jsx)(s.Z,{title:((null==o?void 0:o.comment)||(null==o?void 0:o.title))+((null==o?void 0:o.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,t.jsxs)("div",{className:"flex items-center",children:[d(o.type),"\xa0\xa0\xa0",a,(0,t.jsx)("span",{className:"text-[#1677ff]",children:w}),l,"\xa0",(null==o?void 0:o.type)&&(0,t.jsx)("div",{className:"text-gray-400",children:null==o?void 0:o.type})]})}):(0,t.jsx)(s.Z,{title:((null==o?void 0:o.comment)||(null==o?void 0:o.title))+((null==o?void 0:o.can_null)==="YES"?"(can null)":"(can't null)"),children:(0,t.jsxs)("div",{className:"flex items-center",children:[d(o.type),"\xa0\xa0\xa0",r,"\xa0",(null==o?void 0:o.type)&&(0,t.jsx)("div",{className:"text-gray-400",children:null==o?void 0:o.type})]})});if(o.children){let t=n?String(n)+"_"+o.key:o.key;return{title:r,showTitle:c,key:t,children:e(o.children,t)}}return{title:r,showTitle:c,key:o.key}});return(null==ed?void 0:ed.data)?(p([null==ed?void 0:ed.data.key]),e([null==ed?void 0:ed.data])):[]},[w,ed]),eu=(0,v.useMemo)(()=>{let e=[],o=(n,t)=>{if(n&&!((null==n?void 0:n.length)<=0))for(let r=0;r<n.length;r++){let i=n[r],{key:a,title:l}=i;e.push({key:a,title:l,parentKey:t}),i.children&&o(i.children,a)}};return ec&&o(ec),e},[ec]),em=(e,o)=>{let n;for(let t=0;t<o.length;t++){let r=o[t];r.children&&(r.children.some(o=>o.key===e)?n=r.key:em(e,r.children)&&(n=em(e,r.children)))}return n};function ef(e){let o;if(!e)return{sql:"",thoughts:""};let n=e&&e.match(/(--.*)?\n?([\s\S]*)/),t="";return n&&n.length>=3&&(t=n[1],o=n[2]),{sql:o,thoughts:t}}return(0,v.useEffect)(()=>{T&&es(T)},[es,T]),(0,v.useEffect)(()=>{F&&"chat_dashboard"===Y&&I&&en()},[I,Y,F,en]),(0,v.useEffect)(()=>{F&&"chat_dashboard"!==Y&&ee()},[Y,F,ee]),(0,t.jsxs)("div",{className:"flex flex-col w-full h-full overflow-hidden",children:[(0,t.jsx)(g.Z,{}),(0,t.jsxs)("div",{className:"relative flex flex-1 p-4 pt-0 overflow-hidden",children:[(0,t.jsxs)("div",{className:"relative flex overflow-hidden mr-4",children:[(0,t.jsx)("div",{className:S()("h-full relative transition-[width] overflow-hidden",{"w-0":U,"w-64":!U}),children:(0,t.jsxs)("div",{className:"relative w-64 h-full overflow-hidden flex flex-col rounded bg-white dark:bg-theme-dark-container p-4",children:[(0,t.jsx)(c.default,{size:"middle",className:"w-full mb-2",value:T,options:null==X?void 0:null===(d=X.data)||void 0===d?void 0:d.map(e=>({label:e.round_name,value:e.round})),onChange:e=>{E(e)}}),(0,t.jsx)(P,{className:"mb-2",placeholder:"Search",onChange:e=>{let{value:o}=e.target;if(null==ed?void 0:ed.data){if(o){let e=eu.map(e=>e.title.indexOf(o)>-1?em(e.key,ec):null).filter((e,o,n)=>e&&n.indexOf(e)===o);p(e)}else p([]);C(o),q(!0)}}}),ec&&ec.length>0&&(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,t.jsx)(u.Z,{onExpand:e=>{p(e),q(!1)},expandedKeys:h,autoExpandParent:O,treeData:ec,fieldNames:{title:"showTitle"}})})]})}),(0,t.jsx)("div",{className:"absolute right-0 top-0 translate-x-full h-full flex items-center justify-center opacity-0 hover:opacity-100 group-hover/side:opacity-100 transition-opacity",children:(0,t.jsx)("div",{className:"bg-white w-4 h-10 flex items-center justify-center dark:bg-theme-dark-container rounded-tr rounded-br z-10 text-xs cursor-pointer shadow-[4px_0_10px_rgba(0,0,0,0.06)] text-opacity-80",onClick:()=>{Q(!U)},children:U?(0,t.jsx)(b.Z,{}):(0,t.jsx)(y.Z,{})})})]}),(0,t.jsxs)("div",{className:"flex flex-col flex-1 max-w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"mb-2 bg-white dark:bg-theme-dark-container p-2 flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(m.ZP,{className:"text-xs rounded-none",size:"small",type:"primary",icon:(0,t.jsx)(_.Z,{}),loading:eo||et,onClick:async()=>{"chat_dashboard"===Y?en():ee()},children:"Run"}),(0,t.jsx)(m.ZP,{className:"text-xs rounded-none",type:"primary",size:"small",loading:ei||el,icon:(0,t.jsx)(j.Z,{}),onClick:async()=>{"chat_dashboard"===Y?await ea():await er()},children:"Save"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.Z,{className:S()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"TB"===K}),component:k,onClick:()=>{G("TB")}}),(0,t.jsx)(i.Z,{className:S()("flex items-center justify-center w-6 h-6 text-lg rounded",{"bg-theme-primary bg-opacity-10":"LR"===K}),component:x,onClick:()=>{G("LR")}})]})]}),Array.isArray(F)?(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,t.jsx)("div",{className:"w-full whitespace-nowrap overflow-x-auto bg-white dark:bg-theme-dark-container mb-2 text-[0px]",children:F.map((e,o)=>(0,t.jsx)(s.Z,{className:"inline-block",title:e.title,children:(0,t.jsx)("div",{className:S()("max-w-[240px] px-3 h-10 text-ellipsis overflow-hidden whitespace-nowrap text-sm leading-10 cursor-pointer font-semibold hover:text-theme-primary transition-colors mr-2 last-of-type:mr-0",{"border-b-2 border-solid border-theme-primary text-theme-primary":I===o}),onClick:()=>{W(o),z(null==F?void 0:F[o])},children:e.title})},e.title))}),(0,t.jsx)("div",{className:"flex flex-1 overflow-hidden",children:F.map((e,o)=>(0,t.jsx)("div",{className:S()("w-full overflow-hidden",{hidden:o!==I,"block flex-1":o===I}),children:(0,t.jsx)(D,{layout:K,editorValue:e,handleChange:e=>{let{sql:o,thoughts:n}=ef(e);z(e=>Object.assign({},e,{sql:o,thoughts:n}))},tableData:L,chartData:H})},e.title))})]}):(0,t.jsx)(D,{layout:K,editorValue:F,handleChange:e=>{let{sql:o,thoughts:n}=ef(e);z(e=>Object.assign({},e,{sql:o,thoughts:n}))},tableData:L,chartData:void 0,tables:ed})]})]})]})}},88788:function(e,o,n){"use strict";n.d(o,{Z:function(){return D}});var t=n(52676),r=n(21011),i=n(10902),a=n(39048),l=n(75509),d=n(44211),s=n(86591),c=n(75271);function u(){let{isContract:e,setIsContract:o,scene:n}=(0,c.useContext)(r.p),i=n&&["chat_with_db_execute","chat_dashboard"].includes(n);return i?(0,t.jsxs)(s.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{o(!e)},children:[(0,t.jsxs)(s.ZP.Button,{value:!1,children:[(0,t.jsx)(l.Z,{component:a.ig,className:"mr-1"}),"Preview"]}),(0,t.jsxs)(s.ZP.Button,{value:!0,children:[(0,t.jsx)(d.Z,{className:"mr-1"}),"Editor"]})]}):null}n(21800);var m=n(59864),f=n(99113),v=n(62601),h=n(78490),g=function(){let{t:e}=(0,h.$G)(),{agent:o,setAgent:n}=(0,c.useContext)(r.p),{data:i=[]}=(0,f.Z)(async()=>{let[,e]=await (0,m.Vx)((0,m.H4)());return null!=e?e:[]});return(0,t.jsx)(v.default,{className:"w-60",value:o,placeholder:e("Select_Plugins"),options:i.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==n||n(e)}})},p=n(81707),x=n(31959),k=n(1483),y=n(15739),b=n(42673),_=n(40389),j=n(54426),w=n(41148),S=function(e){var o;let{convUid:n,chatMode:i,onComplete:a,...l}=e,[d,s]=(0,c.useState)(!1),[u,f]=b.ZP.useMessage(),[v,h]=(0,c.useState)([]),[g,S]=(0,c.useState)(),{model:C}=(0,c.useContext)(r.p),{temperatureValue:N,maxNewTokensValue:Z}=(0,c.useContext)(x.ChatContentContext),M=async e=>{var o;if(!e){b.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(o=e.file.name)&&void 0!==o?o:"")){b.ZP.error("File type must be csv, xlsx or xls");return}h([e.file])},P=async()=>{s(!0);try{let e=new FormData;e.append("doc_file",v[0]),u.open({content:"Uploading ".concat(v[0].name),type:"loading",duration:0});let[o]=await (0,m.Vx)((0,m.qn)({convUid:n,chatMode:i,data:e,model:C,temperatureValue:N,maxNewTokensValue:Z,config:{timeout:36e5,onUploadProgress:e=>{let o=Math.ceil(e.loaded/(e.total||0)*100);S(o)}}}));if(o)return;b.ZP.success("success"),null==a||a()}catch(e){b.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{s(!1),u.destroy()}};return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[f,(0,t.jsx)(_.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,t.jsx)(j.default,{disabled:d,className:"mr-1",beforeUpload:()=>!1,fileList:v,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:M,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,t.jsx)(t.Fragment,{}),...l,children:(0,t.jsx)(w.ZP,{className:"flex justify-center items-center",type:"primary",disabled:d,icon:(0,t.jsx)(k.Z,{}),children:"Select File"})})}),(0,t.jsx)(w.ZP,{type:"primary",loading:d,className:"flex justify-center items-center",disabled:!v.length,icon:(0,t.jsx)(y.Z,{}),onClick:P,children:d?100===g?"Analysis":"Uploading":"Upload"}),!!v.length&&(0,t.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>h([]),children:[(0,t.jsx)(p.Z,{className:"mr-2"}),(0,t.jsx)("span",{children:null===(o=v[0])||void 0===o?void 0:o.name})]})]})})},C=function(e){let{onComplete:o}=e,{currentDialogue:n,scene:i,chatId:a}=(0,c.useContext)(r.p);return"chat_excel"!==i?null:(0,t.jsx)("div",{className:"max-w-md h-full relative",children:n?(0,t.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,t.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,t.jsx)(p.Z,{className:"text-white"})}),(0,t.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:n.select_param})]}):(0,t.jsx)(S,{convUid:a,chatMode:i,onComplete:o})})},N=n(2803),Z=n(92821),M=n(7297),P=function(){let{scene:e,dbParam:o,setDbParam:n}=(0,c.useContext)(r.p),[i,a]=(0,c.useState)([]);(0,M.Z)(async()=>{let[,o]=await (0,m.Vx)((0,m.vD)(e));a(null!=o?o:[])},[e]);let l=(0,c.useMemo)(()=>{var e;return null===(e=i.map)||void 0===e?void 0:e.call(i,e=>({name:e.param,...Z.S$[e.type]}))},[i]);return((0,c.useEffect)(()=>{(null==l?void 0:l.length)&&!o&&n(l[0].name)},[l,n,o]),null==l?void 0:l.length)?(0,t.jsx)(v.default,{value:o,className:"w-36",onChange:e=>{n(e)},children:l.map(e=>(0,t.jsxs)(v.default.Option,{children:[(0,t.jsx)(N.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},D=function(e){let{refreshHistory:o,modelChange:n}=e,{scene:a,refreshDialogList:l}=(0,c.useContext)(r.p);return(0,t.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,t.jsx)(i.Z,{onChange:n}),(0,t.jsx)(P,{}),"chat_excel"===a&&(0,t.jsx)(C,{onComplete:()=>{null==l||l(),null==o||o()}}),"chat_agent"===a&&(0,t.jsx)(g,{}),(0,t.jsx)(u,{})]})}},10902:function(e,o,n){"use strict";n.d(o,{A:function(){return m}});var t=n(52676),r=n(21011),i=n(31819),a=n(62601),l=n(87402),d=n.n(l),s=n(75271),c=n(78490);let u="/models/huggingface.svg";function m(e,o){var n,r;let{width:a,height:l}=o||{};return e?(0,t.jsx)(d(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:a||24,height:l||24,src:(null===(n=i.Hf[e])||void 0===n?void 0:n.icon)||u,alt:"llm"},(null===(r=i.Hf[e])||void 0===r?void 0:r.icon)||u):null}o.Z=function(e){let{onChange:o}=e,{t:n}=(0,c.$G)(),{modelList:l,model:d}=(0,s.useContext)(r.p);return!l||l.length<=0?null:(0,t.jsx)(a.default,{value:d,placeholder:n("choose_model"),className:"w-52",onChange:e=>{null==o||o(e)},children:l.map(e=>{var o;return(0,t.jsx)(a.default.Option,{children:(0,t.jsxs)("div",{className:"flex items-center",children:[m(e),(0,t.jsx)("span",{className:"ml-2",children:(null===(o=i.Hf[e])||void 0===o?void 0:o.label)||e})]})},e)})})}},94138:function(e,o,n){"use strict";let t;n.d(o,{Z:function(){return v}});var r=n(52676),i=n(21011),a=n(92821),l=n(67167),d=n(9181),s=n(82187),c=n.n(s),u=n(8661),m=n(75271);async function f(){window.obMonaco={getWorkerUrl:e=>{switch(e){case"mysql":return location.origin+"/_next/static/ob-workers/mysql.js";case"obmysql":return location.origin+"/_next/static/ob-workers/obmysql.js";case"oboracle":return location.origin+"/_next/static/ob-workers/oracle.js"}return""}};let e=await n.e(7634).then(n.bind(n,27634)),o=e.default;return t||(t=new o).setup(["mysql"]),t}function v(e){let{className:o,value:n,language:t="mysql",onChange:s,thoughts:u,session:v}=e,h=(0,m.useMemo)(()=>"mysql"!==t?n:u&&u.length>0?(0,a._m)("-- ".concat(u," \n").concat(n)):(0,a._m)(n),[n,u]),g=(0,d.Z)(v),p=(0,m.useContext)(i.p);async function x(e){var o,n;let t=await f();t.setModelOptions((null===(o=e.getModel())||void 0===o?void 0:o.id)||"",function(e,o){let{_modelId:n,delimiter:t}=e;return{delimiter:t,async getTableList(e){var n;return(null==o?void 0:null===(n=o())||void 0===n?void 0:n.getTableList(e))||[]},async getTableColumns(e,n){var t;return(null==o?void 0:null===(t=o())||void 0===t?void 0:t.getTableColumns(e))||[]},async getSchemaList(){var e;return(null==o?void 0:null===(e=o())||void 0===e?void 0:e.getSchemaList())||[]}}}({modelId:(null===(n=e.getModel())||void 0===n?void 0:n.id)||"",delimiter:";"},()=>g.current||null))}return(0,r.jsx)(l.ZP,{className:c()(o),onMount:x,value:h,defaultLanguage:t,onChange:s,theme:(null==p?void 0:p.mode)!=="dark"?"github":"githubDark",options:{minimap:{enabled:!1},wordWrap:"on"}})}l._m.config({monaco:u}),u.editor.defineTheme("github",{base:"vs",inherit:!0,rules:[{background:"ffffff",token:""},{foreground:"6a737d",token:"comment"},{foreground:"6a737d",token:"punctuation.definition.comment"},{foreground:"6a737d",token:"string.comment"},{foreground:"005cc5",token:"constant"},{foreground:"005cc5",token:"entity.name.constant"},{foreground:"005cc5",token:"variable.other.constant"},{foreground:"005cc5",token:"variable.language"},{foreground:"6f42c1",token:"entity"},{foreground:"6f42c1",token:"entity.name"},{foreground:"24292e",token:"variable.parameter.function"},{foreground:"22863a",token:"entity.name.tag"},{foreground:"d73a49",token:"keyword"},{foreground:"d73a49",token:"storage"},{foreground:"d73a49",token:"storage.type"},{foreground:"24292e",token:"storage.modifier.package"},{foreground:"24292e",token:"storage.modifier.import"},{foreground:"24292e",token:"storage.type.java"},{foreground:"032f62",token:"string"},{foreground:"032f62",token:"punctuation.definition.string"},{foreground:"032f62",token:"string punctuation.section.embedded source"},{foreground:"005cc5",token:"support"},{foreground:"005cc5",token:"meta.property-name"},{foreground:"e36209",token:"variable"},{foreground:"24292e",token:"variable.other"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"b31d28",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"b31d28",token:"message.error"},{foreground:"24292e",token:"string source"},{foreground:"005cc5",token:"string variable"},{foreground:"032f62",token:"source.regexp"},{foreground:"032f62",token:"string.regexp"},{foreground:"032f62",token:"string.regexp.character-class"},{foreground:"032f62",token:"string.regexp constant.character.escape"},{foreground:"032f62",token:"string.regexp source.ruby.embedded"},{foreground:"032f62",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"22863a",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"005cc5",token:"support.constant"},{foreground:"005cc5",token:"support.variable"},{foreground:"005cc5",token:"meta.module-reference"},{foreground:"735c0f",token:"markup.list"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"22863a",token:"markup.quote"},{foreground:"24292e",fontStyle:"italic",token:"markup.italic"},{foreground:"24292e",fontStyle:"bold",token:"markup.bold"},{foreground:"005cc5",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"22863a",background:"f0fff4",token:"markup.inserted"},{foreground:"22863a",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"22863a",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"e36209",background:"ffebda",token:"markup.changed"},{foreground:"e36209",background:"ffebda",token:"punctuation.definition.changed"},{foreground:"f6f8fa",background:"005cc5",token:"markup.ignored"},{foreground:"f6f8fa",background:"005cc5",token:"markup.untracked"},{foreground:"6f42c1",fontStyle:"bold",token:"meta.diff.range"},{foreground:"005cc5",token:"meta.diff.header"},{foreground:"005cc5",fontStyle:"bold",token:"meta.separator"},{foreground:"005cc5",token:"meta.output"},{foreground:"586069",token:"brackethighlighter.tag"},{foreground:"586069",token:"brackethighlighter.curly"},{foreground:"586069",token:"brackethighlighter.round"},{foreground:"586069",token:"brackethighlighter.square"},{foreground:"586069",token:"brackethighlighter.angle"},{foreground:"586069",token:"brackethighlighter.quote"},{foreground:"b31d28",token:"brackethighlighter.unmatched"},{foreground:"b31d28",token:"sublimelinter.mark.error"},{foreground:"e36209",token:"sublimelinter.mark.warning"},{foreground:"959da5",token:"sublimelinter.gutter-mark"},{foreground:"032f62",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"032f62",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#24292e","editor.background":"#ffffff","editor.selectionBackground":"#c8c8fa","editor.inactiveSelectionBackground":"#fafbfc","editor.lineHighlightBackground":"#fafbfc","editorCursor.foreground":"#24292e","editorWhitespace.foreground":"#959da5","editorIndentGuide.background":"#959da5","editorIndentGuide.activeBackground":"#24292e","editor.selectionHighlightBorder":"#fafbfc"}}),u.editor.defineTheme("githubDark",{base:"vs-dark",inherit:!0,rules:[{background:"24292e",token:""},{foreground:"959da5",token:"comment"},{foreground:"959da5",token:"punctuation.definition.comment"},{foreground:"959da5",token:"string.comment"},{foreground:"c8e1ff",token:"constant"},{foreground:"c8e1ff",token:"entity.name.constant"},{foreground:"c8e1ff",token:"variable.other.constant"},{foreground:"c8e1ff",token:"variable.language"},{foreground:"b392f0",token:"entity"},{foreground:"b392f0",token:"entity.name"},{foreground:"f6f8fa",token:"variable.parameter.function"},{foreground:"7bcc72",token:"entity.name.tag"},{foreground:"ea4a5a",token:"keyword"},{foreground:"ea4a5a",token:"storage"},{foreground:"ea4a5a",token:"storage.type"},{foreground:"f6f8fa",token:"storage.modifier.package"},{foreground:"f6f8fa",token:"storage.modifier.import"},{foreground:"f6f8fa",token:"storage.type.java"},{foreground:"79b8ff",token:"string"},{foreground:"79b8ff",token:"punctuation.definition.string"},{foreground:"79b8ff",token:"string punctuation.section.embedded source"},{foreground:"c8e1ff",token:"support"},{foreground:"c8e1ff",token:"meta.property-name"},{foreground:"fb8532",token:"variable"},{foreground:"f6f8fa",token:"variable.other"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"d73a49",token:"message.error"},{foreground:"f6f8fa",token:"string source"},{foreground:"c8e1ff",token:"string variable"},{foreground:"79b8ff",token:"source.regexp"},{foreground:"79b8ff",token:"string.regexp"},{foreground:"79b8ff",token:"string.regexp.character-class"},{foreground:"79b8ff",token:"string.regexp constant.character.escape"},{foreground:"79b8ff",token:"string.regexp source.ruby.embedded"},{foreground:"79b8ff",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"7bcc72",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"c8e1ff",token:"support.constant"},{foreground:"c8e1ff",token:"support.variable"},{foreground:"c8e1ff",token:"meta.module-reference"},{foreground:"fb8532",token:"markup.list"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"c8e1ff",token:"markup.quote"},{foreground:"f6f8fa",fontStyle:"italic",token:"markup.italic"},{foreground:"f6f8fa",fontStyle:"bold",token:"markup.bold"},{foreground:"c8e1ff",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"176f2c",background:"f0fff4",token:"markup.inserted"},{foreground:"176f2c",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"176f2c",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"b08800",background:"fffdef",token:"markup.changed"},{foreground:"b08800",background:"fffdef",token:"punctuation.definition.changed"},{foreground:"2f363d",background:"959da5",token:"markup.ignored"},{foreground:"2f363d",background:"959da5",token:"markup.untracked"},{foreground:"b392f0",fontStyle:"bold",token:"meta.diff.range"},{foreground:"c8e1ff",token:"meta.diff.header"},{foreground:"0366d6",fontStyle:"bold",token:"meta.separator"},{foreground:"0366d6",token:"meta.output"},{foreground:"ffeef0",token:"brackethighlighter.tag"},{foreground:"ffeef0",token:"brackethighlighter.curly"},{foreground:"ffeef0",token:"brackethighlighter.round"},{foreground:"ffeef0",token:"brackethighlighter.square"},{foreground:"ffeef0",token:"brackethighlighter.angle"},{foreground:"ffeef0",token:"brackethighlighter.quote"},{foreground:"d73a49",token:"brackethighlighter.unmatched"},{foreground:"d73a49",token:"sublimelinter.mark.error"},{foreground:"fb8532",token:"sublimelinter.mark.warning"},{foreground:"6a737d",token:"sublimelinter.gutter-mark"},{foreground:"79b8ff",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"79b8ff",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#f6f8fa","editor.background":"#24292e","editor.selectionBackground":"#4c2889","editor.inactiveSelectionBackground":"#444d56","editor.lineHighlightBackground":"#444d56","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#6a737d","editorIndentGuide.background":"#6a737d","editorIndentGuide.activeBackground":"#f6f8fa","editor.selectionHighlightBorder":"#444d56"}})},35202:function(e,o,n){"use strict";var t=n(52676),r=n(57107),i=n(41148),a=n(82187),l=n.n(a),d=n(78490);o.Z=function(e){let{className:o,error:n,description:a,refresh:s}=e,{t:c}=(0,d.$G)();return(0,t.jsx)(r.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:l()("flex items-center justify-center flex-col h-full w-full",o),description:n?(0,t.jsx)(i.ZP,{type:"primary",onClick:s,children:c("try_again")}):null!=a?a:c("no_data")})}},2803:function(e,o,n){"use strict";var t=n(52676),r=n(87402),i=n.n(r);o.Z=function(e){let{src:o,label:n,width:r,height:a,className:l}=e;return(0,t.jsx)(i(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(l),width:r||44,height:a||44,src:o,alt:n||"db-icon"})}},32176:function(e,o,n){"use strict";n.d(o,{Tk:function(){return c},PR:function(){return u}});var t,r=n(92821),i=n(42673);n(32699);var a=n(64612),l=n(31226);let d=a.default.create({baseURL:null!==(t=l.env.API_BASE_URL)&&void 0!==t?t:""});d.defaults.timeout=1e4,d.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let s={"content-type":"application/json","User-Id":(0,r.n5)()},c=(e,o)=>{if(o){let n=Object.keys(o).filter(e=>void 0!==o[e]&&""!==o[e]).map(e=>"".concat(e,"=").concat(o[e])).join("&");n&&(e+="?".concat(n))}return d.get("/api"+e,{headers:s}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})},u=(e,o)=>d.post(e,o,{headers:s}).then(e=>e).catch(e=>{i.ZP.error(e),Promise.reject(e)})},21800:function(){}}]);