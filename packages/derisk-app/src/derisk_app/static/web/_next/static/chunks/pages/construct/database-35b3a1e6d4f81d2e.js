(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1286],{71223:function(e,a,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/construct/database",function(){return l(39318)}])},17847:function(e,a,l){"use strict";l.d(a,{Z:function(){return p}});var t=l(52676),s=l(25675),r=l(63688),i=l(53362),n=l(77004),d=l(5783),o=l(75271),c=e=>{let{parentName:a,fields:l,form:c}=e,[u,p]=(0,o.useState)(null);(0,o.useEffect)(()=>{let e=c.getFieldValue(a);(null==e?void 0:e.type)&&!u&&p(e.type)},[c,a]);let m=e=>{let l;let o=e.param_type.toLowerCase(),c=[a,e.param_name];return l="str"===o||"string"===o?e.valid_values?(0,t.jsx)(s.default,{children:e.valid_values.map(e=>(0,t.jsx)(s.default.Option,{value:e,children:e},e))}):(0,t.jsx)(r.default,{}):"int"===o||"integer"===o||"number"===o||"float"===o?(0,t.jsx)(i.Z,{className:"w-full"}):"bool"===o||"boolean"===o?(0,t.jsx)(n.Z,{}):(0,t.jsx)(r.default,{}),(0,t.jsx)(d.Z.Item,{label:e.label||e.param_name,name:c,valuePropName:"bool"===o||"boolean"===o?"checked":"value",tooltip:e.description,rules:u&&e.required?[{required:!0,message:"Please input ".concat(e.param_name)}]:[],children:l},e.param_name)};return(0,t.jsxs)("div",{className:"space-y-4 border rounded-md p-4",children:[(0,t.jsx)(d.Z.Item,{label:"Type",name:[a,"type"],children:(0,t.jsx)(s.default,{onChange:e=>{p(e);let t=l[e]||[],s={type:e};t.forEach(e=>{s[e.param_name]=e.default_value}),c.setFieldsValue({[a]:s})},placeholder:"Select a type",children:Object.keys(l).map(e=>(0,t.jsx)(s.default.Option,{value:e,children:e},e))})}),u&&l[u]&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsxs)("h4",{className:"mb-4 text-base font-medium",children:[u," Configuration"]}),(0,t.jsx)("div",{className:"space-y-4",children:l[u].map(e=>m(e))})]})]})};let u=e=>!!Array.isArray(e)&&0!==e.length&&"object"==typeof e[0]&&null!==e[0]&&"key"in e[0]&&"label"in e[0];var p=function(e){let{params:a,form:l}=e;if((0,o.useEffect)(()=>{if(a){let e={};a.forEach(a=>{if(!a.nested_fields){let t=l.getFieldValue(a.param_name);void 0===t&&(e[a.param_name]=a.default_value)}}),l.setFieldsValue(e)}},[a,l]),!a||(null==a?void 0:a.length)<1)return null;let p=e=>{let l={...e};return null==a||a.forEach(e=>{if(e.nested_fields&&l[e.param_name]){let a=l[e.param_name];if(a.type){let t=e.nested_fields[a.type]||[],s={};t.forEach(e=>{void 0!==a[e.param_name]&&(s[e.param_name]=a[e.param_name])}),l[e.param_name]={type:a.type,...s}}}}),l},m=l.submit;return l.submit=()=>{let e=l.getFieldsValue(),a=p(e);l.setFieldsValue(a),m.call(l)},(0,t.jsx)("div",{className:"space-y-4",children:null==a?void 0:a.map(e=>(0,t.jsx)(d.Z.Item,{label:(0,t.jsx)("p",{className:"whitespace-normal overflow-wrap-break-word",children:e.label||e.param_name}),name:e.param_name,initialValue:e.default_value,valuePropName:"bool"===e.param_type.toLowerCase()||"boolean"===e.param_type.toLowerCase()?"checked":"value",tooltip:e.description,rules:e.required?[{required:!0,message:"Please input ".concat(e.label||e.param_name)}]:[],children:function(e){var a,d,o,p;if(e.nested_fields)return(0,t.jsx)(c,{parentName:e.param_name,fields:e.nested_fields,form:l});let m=e.param_type.toLowerCase(),x=null===(a=e.ext_metadata)||void 0===a?void 0:null===(d=a.tags)||void 0===d?void 0:d.includes("fixed"),f=null===(o=e.ext_metadata)||void 0===o?void 0:null===(p=o.tags)||void 0===p?void 0:p.includes("privacy");return"str"===m||"string"===m?e.valid_values?u(e.valid_values)?(0,t.jsx)(s.default,{disabled:x,children:e.valid_values.map(e=>(0,t.jsx)(s.default.Option,{value:e.key,children:e.label},e.key))}):(0,t.jsx)(s.default,{disabled:x,children:e.valid_values.map(e=>(0,t.jsx)(s.default.Option,{value:e,children:e},e))}):f?(0,t.jsx)(r.default.Password,{disabled:x,autoComplete:"new-password",placeholder:"请输入密码"}):(0,t.jsx)(r.default,{disabled:x}):"int"===m||"integer"===m||"number"===m||"float"===m?(0,t.jsx)(i.Z,{className:"w-full",disabled:x}):"bool"===m||"boolean"===m?(0,t.jsx)(n.Z,{disabled:x}):(0,t.jsx)(r.default,{disabled:x})}(e)},e.param_name))})}},99532:function(e,a,l){"use strict";var t=l(52676),s=l(77547);a.Z=function(e){let{visible:a}=e;return a?(0,t.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,t.jsx)(s.Z,{})}):null}},39318:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return I},isFileDb:function(){return A}});var t=l(52676),s=l(16019),r=l(19652),i=l(69208),n=l(69439),d=l(84875),o=l.n(d),c=l(97858),u=l.n(c),p=l(75271),m=(0,p.memo)(function(e){let{icon:a,iconBorder:l=!0,title:s,desc:d,tags:c,children:m,disabled:x,operations:f,className:h,extraContent:b,...v}=e,y=(0,p.useMemo)(()=>a?"string"==typeof a?(0,t.jsx)(u(),{className:o()("w-11 h-11 rounded-full mr-4 object-contain bg-white",{"border border-gray-200":l}),width:48,height:48,src:a,alt:s}):a:null,[a]),j=(0,p.useMemo)(()=>c&&c.length?(0,t.jsx)("div",{className:"flex items-center mt-1 flex-wrap",children:c.map((e,a)=>{var l;return"string"==typeof e?(0,t.jsx)(r.Z,{className:"text-xs",bordered:!1,color:"default",children:e},a):(0,t.jsx)(r.Z,{className:"text-xs",bordered:null!==(l=e.border)&&void 0!==l&&l,color:e.color,children:e.text},a)})}):null,[c]);return(0,t.jsxs)("div",{className:o()("group/card relative flex flex-col w-72 rounded justify-between text-black bg-white shadow-[0_8px_16px_-10px_rgba(100,100,100,.08)] hover:shadow-[0_14px_20px_-10px_rgba(100,100,100,.15)] dark:bg-[#232734] dark:text-white dark:hover:border-white transition-[transfrom_shadow] duration-300 hover:-translate-y-1 min-h-fit",{"grayscale cursor-no-drop":x,"cursor-pointer":!x&&!!v.onClick},h),...v,children:[(0,t.jsxs)("div",{className:"p-4 0",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[y,(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)(i.Z,{title:s,children:(0,t.jsx)("h2",{className:"text-sm font-semibold line-clamp-1 pr-8",children:s})}),j]})]}),d&&(0,t.jsx)(n.Z,{title:d,children:(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-500 font-normal line-clamp-2",children:d})})]}),(0,t.jsxs)("div",{children:[m,f&&!!f.length&&(0,t.jsx)("div",{className:"flex flex-wrap items-center justify-center border-t border-solid border-gray-100 dark:border-theme-dark",children:f.map((e,a)=>(0,t.jsx)(n.Z,{title:e.label,children:(0,t.jsxs)("div",{className:"relative flex flex-1 items-center justify-center h-11 text-gray-400 hover:text-blue-500 transition-colors duration-300 cursor-pointer",onClick:a=>{var l;a.stopPropagation(),null===(l=e.onClick)||void 0===l||l.call(e)},children:[e.children,a<f.length-1&&(0,t.jsx)("div",{className:"w-[1px] h-6 absolute top-2 right-0 bg-gray-100 rounded dark:bg-theme-dark"})]})},"operation-".concat(a)))})]}),(0,t.jsx)("div",{className:"absolute top-2 right-4 ",children:b})]})}),x=l(99532),f=l(83958),h=l(24841),b=l(25675),v=l(5783),y=l(9349),j=l(63688),_=l(25377),g=l(17847);let{Option:w}=b.default,N=v.Z.Item;var Z=function(e){let{onCancel:a,onSuccess:l,dbTypeList:r,editValue:i,choiceDBType:n,getFromRenderData:d,description:o=""}=e,{t:c}=(0,h.$G)(),[u]=v.Z.useForm(),[m,x]=(0,p.useState)(!1),[f,Z]=(0,p.useState)(n),[k,C]=(0,p.useState)(d||null);(0,p.useEffect)(()=>{n&&Z(n)},[n]),(0,p.useEffect)(()=>{i&&d&&(C(d),u.setFieldValue("description",o))},[i,d,o,u]);let P=async e=>{try{x(!0);let{description:a,type:t,...r}=e,n={type:f,params:r,description:a||""};i&&(n.id=i);let[d]=await (0,s.Vx)((0,s.KS)(n));if(d)return;let[o]=await (0,s.Vx)((i?s.mR:s.b_)(n));if(o){y.ZP.error(o.message);return}y.ZP.success(c(i?"update_success":"create_success")),null==l||l()}catch(e){console.error("Failed to submit form:",e),y.ZP.error(c(i?"update_failed":"create_failed"))}finally{x(!1)}};return(0,t.jsxs)(v.Z,{form:u,layout:"vertical",onFinish:P,initialValues:{type:f},children:[(0,t.jsx)(N,{label:c("database_type"),name:"type",rules:[{required:!0,message:c("please_select_database_type")}],children:(0,t.jsx)(b.default,{placeholder:c("select_database_type"),onChange:e=>{Z(e),u.resetFields(["params"]);let a=r.find(a=>a.value===e);(null==a?void 0:a.parameters)&&C(a.parameters)},disabled:!!i,children:r.map(e=>(0,t.jsx)(w,{value:e.value,disabled:e.disabled,children:e.label},e.value))})}),k&&(0,t.jsx)(g.Z,{params:k,form:u}),(0,t.jsx)(N,{label:c("description"),name:"description",children:(0,t.jsx)(j.default.TextArea,{rows:2,placeholder:c("input_description")})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[(0,t.jsx)(_.ZP,{onClick:a,children:c("cancel")}),(0,t.jsx)(_.ZP,{type:"primary",htmlType:"submit",loading:m,children:c("submit")})]})]})},k=function(e){let{open:a,onClose:l,onSuccess:s,dbTypeList:r,editValue:i,choiceDBType:n,getFromRenderData:d,dbNames:o,description:c}=e,{t:u}=(0,h.$G)();return(0,t.jsx)(f.default,{title:u(i?"edit_database":"add_database"),open:a,onCancel:l,footer:null,width:800,destroyOnClose:!0,children:(0,t.jsx)(Z,{onCancel:l,onSuccess:s,dbTypeList:r,editValue:i,choiceDBType:n,getFromRenderData:d,dbNames:o,description:c})})},C=l(51921),P=l(42508),S=l(59849),F=l(56542),T=l(48629),E=l(9158),V=l(85439),D=l(19658),O=l(7806),L=l(46068),$=l(32133);function A(e,a){var l;return null===(l=e.find(e=>e.value===a))||void 0===l?void 0:l.isFileDb}let q=[];var I=function(){let{t:e}=(0,h.$G)(),[a,l]=(0,p.useState)([]),[r,i]=(0,p.useState)([]),[n,d]=(0,p.useState)(!1),[o,c]=(0,p.useState)({open:!1}),[u,b]=(0,p.useState)({open:!1}),[v,j]=(0,p.useState)(!1),g=async()=>{var e;let[,a]=await (0,s.Vx)((0,s.t$)());i(null!==(e=null==a?void 0:a.types)&&void 0!==e?e:[])},w=async()=>{d(!0);let[,e]=await (0,s.Vx)((0,s.Bw)());l(null!=e?e:[]),d(!1)},N=(0,p.useMemo)(()=>{let e=r.map(e=>{let a=null==e?void 0:e.name;return{...C.S$[a],value:a,isFileDb:!0,parameters:e.parameters}}),a=Object.keys(C.S$).filter(a=>!e.some(e=>e.value===a)).map(e=>({...C.S$[e],value:C.S$[e].label,disabled:!0}));return[...e,...a]},[r]),Z=e=>{for(let a=0;a<q.length;a++){let l=q[a];e.params[l.param_name]&&(l.default_value=e.params[l.param_name])}c({open:!0,info:e.id,dbType:e.type,description:e.description})},A=e=>{f.default.confirm({title:"Tips",content:"Do you Want to delete the database connection?",onOk:()=>new Promise((a,l)=>{I(e.id,a,l)})})},I=async(e,a,l)=>{try{let[t]=await (0,s.Vx)((0,s.J5)(e));if(t){y.ZP.error(t.message),l();return}y.ZP.success("success"),w(),a()}catch(e){l()}},M=(0,p.useMemo)(()=>{let e=N.reduce((e,l)=>(e[l.value]=a.filter(e=>(null==e?void 0:e.type.toLowerCase())===l.value.toLowerCase()),e),{});return e},[a,N]);(0,E.Z)(async()=>{await w(),await g()},[]);let G=e=>{let l=a.filter(a=>a.type===e.value);q=null==e?void 0:e.parameters,b({open:!0,dbList:l,name:e.label,type:e.value})},R=async a=>{j(!0);let[,l]=await (0,s.Vx)((0,s.yx)({id:a.id}));l&&y.ZP.success(e("refreshSuccess")),j(!1)},B=e=>{if(!e)return"";let a=e.split(/[/\\]/);return a[a.length-1]};return(0,t.jsxs)("div",{className:"relative min-h-full overflow-y-auto px-6 max-h-[90vh]",children:[(0,t.jsx)(x.Z,{visible:n}),(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsx)("div",{className:"flex items-center gap-4"}),(0,t.jsx)("div",{className:"flex items-center gap-4",children:(0,t.jsx)(_.ZP,{className:"border-none text-white bg-button-gradient",icon:(0,t.jsx)(P.Z,{}),onClick:()=>{console.log(a),console.log(N),c({open:!0,dbTypeData:N})},children:e("Add_Datasource")})})]}),(0,t.jsx)("div",{className:"flex flex-wrap mx-[-8px] gap-2 md:gap-4",children:N.map(e=>{var a,l;return(0,t.jsx)(V.Z,{count:null===(a=M[e.value])||void 0===a?void 0:a.length,className:"min-h-fit",children:(0,t.jsx)(m,{className:"h-full",title:e.label,desc:null!==(l=e.desc)&&void 0!==l?l:"",disabled:e.disabled,icon:e.icon,onClick:()=>{e.disabled||G(e)}})},e.value)})}),(0,t.jsx)(k,{open:o.open,dbTypeList:N,getFromRenderData:q,description:o.description,choiceDBType:o.dbType,editValue:o.info,dbTypeData:o.dbTypeData,dbNames:a.map(e=>e.params.database),onSuccess:()=>{c({open:!1}),w()},onClose:()=>{c({open:!1})}}),(0,t.jsx)(D.Z,{title:u.name,placement:"right",onClose:()=>{b({open:!1})},open:u.open,children:u.type&&M[u.type]&&M[u.type].length?(0,t.jsxs)(O.Z,{spinning:v,children:[(0,t.jsx)(_.ZP,{type:"primary",className:"mb-4 flex items-center",icon:(0,t.jsx)(P.Z,{}),onClick:()=>{c({open:!0,dbType:u.type})},children:"Create"}),M[u.type].map(a=>{var l,s,r,i;return(0,t.jsxs)(L.Z,{title:(null===(l=a.params)||void 0===l?void 0:l.database)||B(null===(s=a.params)||void 0===s?void 0:s.path)||"",extra:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S.Z,{className:"mr-2",style:{color:"gray"},onClick:()=>{R(a)}}),(0,t.jsx)(F.Z,{className:"mr-2",style:{color:"#1b7eff"},onClick:()=>{Z(a)}}),(0,t.jsx)(T.Z,{style:{color:"#ff1b2e"},onClick:()=>{A(a)}})]}),className:"mb-4",children:[(0,t.jsx)(t.Fragment,{children:["host","port","path","user","database","schema"].filter(e=>Object.prototype.hasOwnProperty.call(a.params,e)).map(e=>(0,t.jsxs)("p",{children:[e,": ","path"===e?B(a.params[e]):a.params[e]]},e))}),(0,t.jsxs)("p",{children:[e("description"),": ",a.description]})]},(null===(r=a.params)||void 0===r?void 0:r.database)||(null===(i=a.params)||void 0===i?void 0:i.path)||"")})]}):(0,t.jsx)($.Z,{image:$.Z.PRESENTED_IMAGE_DEFAULT,children:(0,t.jsx)(_.ZP,{type:"primary",className:"flex items-center mx-auto",icon:(0,t.jsx)(P.Z,{}),onClick:()=>{c({open:!0,dbType:u.type})},children:"Create Now"})})})]})}}},function(e){e.O(0,[9557,5230,3688,7806,3129,5675,5783,3894,7004,5284,9658,6068,4887,9774,2888,179],function(){return e(e.s=71223)}),_N_E=e.O()}]);