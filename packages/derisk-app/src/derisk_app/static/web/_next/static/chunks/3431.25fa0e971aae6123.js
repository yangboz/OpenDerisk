"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3431],{37010:function(e,a,s){s.r(a);var t=s(52676),l=s(46501),n=s(25331),r=s(44148),i=s(84875),c=s.n(i),o=s(75271),d=s(21201),u=s(79127);a.default=(0,o.memo)(e=>{let{message:a,index:s}=e,{scene:i}=(0,o.useContext)(d.MobileChatContext),{context:x,model_name:m,role:p,thinking:f}=a,h=(0,o.useMemo)(()=>"view"===p,[p]),v=(0,o.useRef)(null),{value:g}=(0,o.useMemo)(()=>{if("string"!=typeof x)return{relations:[],value:"",cachePluginContext:[]};let[e,a]=x.split("	relations:"),s=a?a.split(","):[],t=[],l=0,n=e.replace(/<derisk-view[^>]*>[^<]*<\/derisk-view>/gi,e=>{try{var a;let s=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),n=JSON.parse(s),r="<custom-view>".concat(l,"</custom-view>");return t.push({...n,result:w(null!==(a=n.result)&&void 0!==a?a:"")}),l++,r}catch(a){return console.log(a.message,a),e}});return{relations:s,cachePluginContext:t,value:n}},[x]),w=e=>e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>");return(0,t.jsxs)("div",{className:c()("flex w-full",{"justify-end":!h}),ref:v,children:[!h&&(0,t.jsx)("div",{className:"flex bg-[#0C75FC]  text-white p-3 rounded-xl rounded-br-none",children:x}),h&&(0,t.jsxs)("div",{className:"flex max-w-full flex-col flex-wrap bg-white dark:bg-[rgba(255,255,255,0.16)] p-3 rounded-xl rounded-bl-none",children:["string"==typeof x&&"chat_agent"===i&&(0,t.jsx)(n.default,{children:null==g?void 0:g.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}),"string"==typeof x&&"chat_agent"!==i&&(0,t.jsx)(n.default,{children:w(g)}),f&&!x&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"flex text-sm text-[#1c2533] dark:text-white",children:"思考中"}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse1"}),(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse2"}),(0,t.jsx)("div",{className:"w-1 h-1 rounded-full mx-1 animate-pulse3"})]})]}),!f&&(0,t.jsx)(r.Z,{className:"my-2"}),(0,t.jsxs)("div",{className:c()("opacity-0 h-0 w-0",{"opacity-100 flex items-center justify-between gap-6 w-auto h-auto":!f}),children:[(0,t.jsx)(u.default,{content:a,index:s,chatDialogRef:v}),"chat_agent"!==i&&(0,t.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,t.jsx)(l.Z,{width:14,height:14,model:m}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:m})]})]})]})]})})},83431:function(e,a,s){s.r(a);var t=s(52676),l=s(75271),n=s(21201),r=s(37010);a.default=(0,l.memo)(()=>{let{history:e}=(0,l.useContext)(n.MobileChatContext),a=(0,l.useMemo)(()=>e.filter(e=>["view","human"].includes(e.role)),[e]);return(0,t.jsx)("div",{className:"flex flex-col gap-4",children:!!a.length&&a.map((e,a)=>(0,t.jsx)(r.default,{message:e,index:a},e.context+a))})})},56266:function(e,a,s){s.r(a);var t=s(52676),l=s(19658),n=s(19652),r=s(63688),i=s(25377),c=s(75271);a.default=e=>{let{open:a,setFeedbackOpen:s,list:o,feedback:d,loading:u}=e,[x,m]=(0,c.useState)([]),[p,f]=(0,c.useState)("");return(0,t.jsx)(l.Z,{title:"你的反馈助我进步",placement:"bottom",open:a,onClose:()=>s(!1),destroyOnClose:!0,height:"auto",children:(0,t.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,t.jsx)("div",{className:"flex w-full flex-wrap gap-2",children:null==o?void 0:o.map(e=>{let a=x.findIndex(a=>a.reason_type===e.reason_type)>-1;return(0,t.jsx)(n.Z,{className:"text-sm text-[#525964] p-1 px-2 rounded-md cursor-pointer ".concat(a?"border-[#0c75fc] text-[#0c75fc]":""),onClick:()=>{m(a=>{let s=a.findIndex(a=>a.reason_type===e.reason_type);return s>-1?[...a.slice(0,s),...a.slice(s+1)]:[...a,e]})},children:e.reason},e.reason_type)})}),(0,t.jsx)(r.default.TextArea,{placeholder:"描述一下具体问题或更优的答案",className:"h-24 resize-none mb-2",value:p,onChange:e=>f(e.target.value.trim())}),(0,t.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,t.jsx)(i.ZP,{className:"w-16 h-8",onClick:()=>{s(!1)},children:"取消"}),(0,t.jsx)(i.ZP,{type:"primary",className:"min-w-16 h-8",onClick:async()=>{let e=x.map(e=>e.reason_type);await (null==d?void 0:d({feedback_type:"unlike",reason_types:e,remark:p}))},loading:u,children:"确认"})]})]})})}},79127:function(e,a,s){s.r(a);var t=s(52676),l=s(16019),n=s(90355),r=s(46083),i=s(4629),c=s(10901),o=s(62621),d=s(44148),u=s(25377),x=s(84875),m=s.n(x),p=s(874),f=s.n(p),h=s(75271),v=s(21201),g=s(56266);a.default=e=>{var a;let{content:s,index:x,chatDialogRef:p}=e,{conv_uid:w,history:j,scene:y}=(0,h.useContext)(v.MobileChatContext),{message:k}=o.Z.useApp(),[N,C]=(0,h.useState)(!1),[b,_]=(0,h.useState)(null==s?void 0:null===(a=s.feedback)||void 0===a?void 0:a.feedback_type),[Z,S]=(0,h.useState)([]),M=async e=>{var a;let s=null==e?void 0:e.replace(/\trelations:.*/g,""),t=f()((null===(a=p.current)||void 0===a?void 0:a.textContent)||s);t?s?k.success("复制成功"):k.warning("内容复制为空"):k.error("复制失败")},{run:A,loading:F}=(0,c.Z)(async e=>await (0,l.Vx)((0,l.zx)({conv_uid:w,message_id:s.order+"",feedback_type:e.feedback_type,reason_types:e.reason_types,remark:e.remark})),{manual:!0,onSuccess:e=>{let[,a]=e;_(null==a?void 0:a.feedback_type),k.success("反馈成功"),C(!1)}}),{run:P}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.Ir)({conv_uid:w,message_id:(null==s?void 0:s.order)+""})),{manual:!0,onSuccess:e=>{let[,a]=e;a&&(_("none"),k.success("操作成功"))}}),{run:V}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.Jr)()),{manual:!0,onSuccess:e=>{let[,a]=e;S(a||[]),a&&C(!0)}}),{run:$,loading:z}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.Ty)({conv_id:w,round_index:0})),{manual:!0,onSuccess:()=>{k.success("操作成功")}});return(0,t.jsxs)("div",{className:"flex items-center text-sm",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.Z,{className:m()("cursor-pointer",{"text-[#0C75FC]":"like"===b}),onClick:async()=>{if("like"===b){await P();return}await A({feedback_type:"like"})}}),(0,t.jsx)(r.Z,{className:m()("cursor-pointer",{"text-[#0C75FC]":"unlike"===b}),onClick:async()=>{if("unlike"===b){await P();return}await V()}}),(0,t.jsx)(g.default,{open:N,setFeedbackOpen:C,list:Z,feedback:A,loading:F})]}),(0,t.jsx)(d.Z,{type:"vertical"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.Z,{className:"cursor-pointer",onClick:()=>M(s.context)}),j.length-1===x&&"chat_agent"===y&&(0,t.jsx)(u.ZP,{loading:z,size:"small",onClick:async()=>{await $()},className:"text-xs",children:"终止话题"})]})]})}}}]);