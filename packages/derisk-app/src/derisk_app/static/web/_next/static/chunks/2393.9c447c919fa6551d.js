(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2393,919],{74266:function(e,o,n){var t={"./simpleWorker":50223,"./simpleWorker.js":50223,"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/base/common/worker/simpleWorker":50223,"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/base/common/worker/simpleWorker.js":50223};function r(e){return Promise.resolve().then(function(){if(!n.o(t,e)){var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}return n(t[e])})}r.keys=function(){return Object.keys(t)},r.id=74266,e.exports=r},79410:function(e,o,n){var t={"./editorBaseApi":[54726],"./editorBaseApi.js":[54726],"./editorSimpleWorker":[56216],"./editorSimpleWorker.js":[56216],"./editorWorker":[14541],"./editorWorker.js":[14541],"./editorWorkerHost":[7570],"./editorWorkerHost.js":[7570],"./findSectionHeaders":[26767],"./findSectionHeaders.js":[26767],"./getIconClasses":[25129],"./getIconClasses.js":[25129],"./languageFeatureDebounce":[27825],"./languageFeatureDebounce.js":[27825],"./languageFeatures":[47924],"./languageFeatures.js":[47924],"./languageFeaturesService":[26524],"./languageFeaturesService.js":[26524],"./languageService":[39920],"./languageService.js":[39920],"./languagesAssociations":[15981],"./languagesAssociations.js":[15981],"./languagesRegistry":[27921],"./languagesRegistry.js":[27921],"./markerDecorations":[90231],"./markerDecorations.js":[90231],"./markerDecorationsService":[15761],"./markerDecorationsService.js":[15761],"./model":[42361],"./model.js":[42361],"./modelService":[95451],"./modelService.js":[95451],"./resolverService":[16417],"./resolverService.js":[16417],"./semanticTokensDto":[77263],"./semanticTokensDto.js":[77263],"./semanticTokensProviderStyling":[89094],"./semanticTokensProviderStyling.js":[89094],"./semanticTokensStyling":[51819],"./semanticTokensStyling.js":[51819],"./semanticTokensStylingService":[79837],"./semanticTokensStylingService.js":[79837],"./textModelSync/textModelSync.impl":[48838],"./textModelSync/textModelSync.impl.js":[48838],"./textModelSync/textModelSync.protocol":[45858,5858],"./textModelSync/textModelSync.protocol.js":[45858,5858],"./textResourceConfiguration":[95633],"./textResourceConfiguration.js":[95633],"./treeSitterParserService":[25224],"./treeSitterParserService.js":[25224],"./treeViewsDnd":[10234],"./treeViewsDnd.js":[10234],"./treeViewsDndService":[8743],"./treeViewsDndService.js":[8743],"./unicodeTextModelHighlighter":[69810],"./unicodeTextModelHighlighter.js":[69810],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorBaseApi":[54726],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorBaseApi.js":[54726],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker":[56216],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorSimpleWorker.js":[56216],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorker":[14541],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorker.js":[14541],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerHost":[7570],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/editorWorkerHost.js":[7570],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/findSectionHeaders":[26767],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/findSectionHeaders.js":[26767],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses":[25129],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/getIconClasses.js":[25129],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce":[27825],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js":[27825],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatures":[47924],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatures.js":[47924],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeaturesService":[26524],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageFeaturesService.js":[26524],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageService":[39920],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languageService.js":[39920],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations":[15981],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesAssociations.js":[15981],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry":[27921],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/languagesRegistry.js":[27921],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorations":[90231],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorations.js":[90231],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService":[15761],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/markerDecorationsService.js":[15761],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/model":[42361],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/model.js":[42361],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/modelService":[95451],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/modelService.js":[95451],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/resolverService":[16417],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/resolverService.js":[16417],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensDto":[77263],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensDto.js":[77263],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling":[89094],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensProviderStyling.js":[89094],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStyling":[51819],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStyling.js":[51819],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService":[79837],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/semanticTokensStylingService.js":[79837],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl":[48838],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.impl.js":[48838],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol":[45858,5858],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textModelSync/textModelSync.protocol.js":[45858,5858],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfiguration":[95633],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/textResourceConfiguration.js":[95633],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeSitterParserService":[25224],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeSitterParserService.js":[25224],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDnd":[10234],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDnd.js":[10234],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDndService":[8743],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/treeViewsDndService.js":[8743],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter":[69810],"node_modules/.pnpm/monaco-editor@0.52.2/node_modules/monaco-editor/esm/vs/editor/common/services/unicodeTextModelHighlighter.js":[69810]};function r(e){if(!n.o(t,e))return Promise.resolve().then(function(){var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o});var o=t[e],r=o[0];return Promise.all(o.slice(1).map(n.e)).then(function(){return n(r)})}r.keys=function(){return Object.keys(t)},r.id=79410,e.exports=r},59695:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return eR}});var t=n(52676),r=n(21011),l=n(59864),s=n(45520),a=n(92821),i=n(7297),d=n(82187),c=n.n(d),u=n(29052),m=n(75271),f=n(78471),g=n(35202),p=n(74881),v=()=>{let{history:e,setHistory:o,chatId:n,model:t,docId:a}=(0,m.useContext)(r.p),{chat:i}=(0,s.Z)({queryAgentURL:"/knowledge/document/summary"}),d=(0,m.useCallback)(async e=>{let[,r]=await (0,l.Vx)((0,l.$i)(n)),s=[...r,{role:"human",context:"",model_name:t,order:0,time_stamp:0},{role:"view",context:"",model_name:t,order:0,time_stamp:0,retry:!0}],d=s.length-1;o([...s]),await i({data:{doc_id:e||a,model_name:t},chatId:n,onMessage:e=>{s[d].context=e,o([...s])}})},[e,t,a,n]);return d},h=n(4093),x=n(64771),k=n(60904),b=n(64298),j=n(42673),y=n(40389),_=n(99879),w=n(874),S=n.n(w),N=n(32699),Z=n(78490),C=n(28974),P=n(72423),M=n(41148),D=n(13250),R=n(39048),E=n(82061);function O(e){let{document:o}=e;switch(o.status){case"RUNNING":return(0,t.jsx)(R.Rp,{});case"FINISHED":default:return(0,t.jsx)(R.s2,{});case"FAILED":return(0,t.jsx)(E.Z,{})}}function T(e){let{documents:o,dbParam:n}=e,r=(0,D.useRouter)(),l=e=>{r.push("/knowledge/chunk/?spaceName=".concat(n,"&id=").concat(e))};return(null==o?void 0:o.length)?(0,t.jsx)("div",{className:"absolute flex overflow-scroll h-12 top-[-35px] w-full z-10",children:o.map(e=>{let o;switch(e.status){case"RUNNING":o="#2db7f5";break;case"FINISHED":default:o="#87d068";break;case"FAILED":o="#f50"}return(0,t.jsx)(y.Z,{title:e.result,children:(0,t.jsxs)(M.ZP,{style:{color:o},onClick:()=>{l(e.id)},className:"shrink flex items-center mr-3",children:[(0,t.jsx)(O,{document:e}),e.doc_name]})},e.id)})}):null}var I=n(85020),F=n(54426);function A(e){let{dbParam:o,setDocId:n}=(0,m.useContext)(r.p),{onUploadFinish:s,handleFinish:a}=e,i=v(),[d,c]=(0,m.useState)(!1),u=async e=>{c(!0);let t=new FormData;t.append("doc_name",e.file.name),t.append("doc_file",e.file),t.append("doc_type","DOCUMENT");let r=await (0,l.Vx)((0,l.iG)(o||"default",t));if(!r[1]){c(!1);return}n(r[1]),s(),c(!1),null==a||a(!0),await i(r[1]),null==a||a(!1)};return(0,t.jsx)(F.default,{customRequest:u,showUploadList:!1,maxCount:1,multiple:!1,className:"absolute z-10 top-2 left-2",accept:".pdf,.ppt,.pptx,.xls,.xlsx,.doc,.docx,.txt,.md",children:(0,t.jsx)(M.ZP,{loading:d,size:"small",shape:"circle",icon:(0,t.jsx)(I.Z,{})})})}var H=n(32176),L=n(99113),U=n(31744),V=n(39034),W=n(32651),q=n(54226),B=n(62601),$=n(20958);let z=e=>{let{data:o,loading:n,submit:r,close:l}=e,{t:s}=(0,Z.$G)(),a=e=>()=>{r(e),l()};return(0,t.jsx)("div",{style:{maxHeight:400,overflow:"auto"},children:(0,t.jsx)(U.Z,{dataSource:null==o?void 0:o.data,loading:n,rowKey:e=>e.prompt_name,renderItem:e=>(0,t.jsx)(U.Z.Item,{onClick:a(e.content),children:(0,t.jsx)(y.Z,{title:e.content,children:(0,t.jsx)(U.Z.Item.Meta,{style:{cursor:"copy"},title:e.prompt_name,description:s("Prompt_Info_Scene")+"：".concat(e.chat_scene,"，")+s("Prompt_Info_Sub_Scene")+"：".concat(e.sub_chat_scene)})})},e.prompt_name)})})};var J=e=>{let{submit:o}=e,{t:n}=(0,Z.$G)(),[r,l]=(0,m.useState)(!1),[s,a]=(0,m.useState)("common"),{data:i,loading:d}=(0,L.Z)(()=>(0,H.PR)("/prompt/list",{prompt_type:s}),{refreshDeps:[s],onError:e=>{j.ZP.error(null==e?void 0:e.message)}});return(0,t.jsx)(V.ZP,{theme:{components:{Popover:{minWidth:250}}},children:(0,t.jsx)(W.Z,{title:(0,t.jsx)(q.Z.Item,{label:"Prompt "+n("Type"),children:(0,t.jsx)(B.default,{style:{width:150},value:s,onChange:e=>{a(e)},options:[{label:n("Public")+" Prompts",value:"common"},{label:n("Private")+" Prompts",value:"private"}]})}),content:(0,t.jsx)(z,{data:i,loading:d,submit:o,close:()=>{l(!1)}}),placement:"topRight",trigger:"click",open:r,onOpenChange:e=>{l(e)},children:(0,t.jsx)(y.Z,{title:n("Click_Select")+" Prompt",children:(0,t.jsx)($.Z,{className:"bottom-[30%]"})})})})},G=function(e){let{children:o,loading:n,onSubmit:s,handleFinish:a,placeholder:i,...d}=e,{dbParam:c,scene:u}=(0,m.useContext)(r.p),[f,g]=(0,m.useState)(""),p=(0,m.useMemo)(()=>"chat_knowledge"===u,[u]),[v,h]=(0,m.useState)([]),x=(0,m.useRef)(0);async function k(){if(!c)return null;let[e,o]=await (0,l.Vx)((0,l._Q)(c,{page:1,page_size:x.current}));h((null==o?void 0:o.data)||[])}(0,m.useEffect)(()=>{p&&k()},[c]);let b=async()=>{x.current+=1,await k()};return(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)(T,{documents:v,dbParam:c}),p&&(0,t.jsx)(A,{handleFinish:a,onUploadFinish:b,className:"absolute z-10 top-2 left-2"}),(0,t.jsx)(P.default.TextArea,{className:"flex-1 ".concat(p?"pl-10":""," pr-10"),size:"large",value:f,autoSize:{minRows:1,maxRows:4},...d,onPressEnter:e=>{if(f.trim()&&13===e.keyCode){if(e.shiftKey){e.preventDefault(),g(e=>e+"\n");return}s(f),setTimeout(()=>{g("")},0)}},onChange:e=>{if("number"==typeof d.maxLength){g(e.target.value.substring(0,d.maxLength));return}g(e.target.value)},placeholder:i}),(0,t.jsx)(M.ZP,{className:"ml-2 flex items-center justify-center absolute right-0 bottom-0",size:"large",type:"text",loading:n,icon:(0,t.jsx)(C.Z,{}),onClick:()=>{s(f)}}),(0,t.jsx)(J,{submit:e=>{g(f+e)}}),o]})},K=n(35215),Q=n(50554),X=(0,m.memo)(function(e){var o;let{content:n}=e,{scene:l}=(0,m.useContext)(r.p),s="view"===n.role;return(0,t.jsx)("div",{className:c()("relative w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":s,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(l)}),children:s?(0,t.jsx)(K.Z,{components:Q.ZP,...Q.dx,children:(0,Q.CE)(null==(o=n.context)?void 0:o.replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>"))}):(0,t.jsx)("div",{className:"",children:n.context})})}),Y=n(7036),ee=n(24573),eo=n(14258),en=n(3642),et=n(22925),er=n(38438),el=n(2590),es=n(56367),ea=n(10902);let ei={todo:{bgClass:"bg-gray-500",icon:(0,t.jsx)(Y.Z,{className:"ml-2"})},runing:{bgClass:"bg-blue-500",icon:(0,t.jsx)(ee.Z,{className:"ml-2"})},failed:{bgClass:"bg-red-500",icon:(0,t.jsx)(eo.Z,{className:"ml-2"})},completed:{bgClass:"bg-green-500",icon:(0,t.jsx)(en.Z,{className:"ml-2"})}};function ed(e){return e.replaceAll("\\n","\n").replace(/<table(\w*=[^>]+)>/gi,"<table $1>").replace(/<tr(\w*=[^>]+)>/gi,"<tr $1>")}var ec=(0,m.memo)(function(e){let{children:o,content:n,isChartChat:l,onLinkClick:s}=e,{scene:a}=(0,m.useContext)(r.p),{context:i,model_name:d,role:u}=n,f="view"===u,{relations:g,value:p,cachePluginContext:v}=(0,m.useMemo)(()=>{if("string"!=typeof i)return{relations:[],value:"",cachePluginContext:[]};let[e,o]=i.split("	relations:"),n=o?o.split(","):[],t=[],r=0,l=e.replace(/<dbgpt-view[^>]*>[^<]*<\/dbgpt-view>/gi,e=>{try{var o;let n=e.replaceAll("\n","\\n").replace(/<[^>]*>|<\/[^>]*>/gm,""),l=JSON.parse(n),s="<custom-view>".concat(r,"</custom-view>");return t.push({...l,result:ed(null!==(o=l.result)&&void 0!==o?o:"")}),r++,s}catch(o){return console.log(o.message,o),e}});return{relations:n,cachePluginContext:t,value:l}},[i]),h=(0,m.useMemo)(()=>({"custom-view"(e){var o;let{children:n}=e,r=+n.toString();if(!v[r])return n;let{name:l,status:s,err_msg:a,result:i}=v[r],{bgClass:d,icon:u}=null!==(o=ei[s])&&void 0!==o?o:{};return(0,t.jsxs)("div",{className:"bg-white dark:bg-[#212121] rounded-lg overflow-hidden my-2 flex flex-col lg:max-w-[80%]",children:[(0,t.jsxs)("div",{className:c()("flex px-4 md:px-6 py-2 items-center text-white text-sm",d),children:[l,u]}),i?(0,t.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:(0,t.jsx)(K.Z,{components:Q.ZP,...Q.dx,children:(0,Q.CE)(null!=i?i:"")})}):(0,t.jsx)("div",{className:"px-4 md:px-6 py-4 text-sm",children:a})]})}}),[i,v]);return f||i?(0,t.jsxs)("div",{className:c()("relative flex flex-wrap w-full p-2 md:p-4 rounded-xl break-words",{"bg-white dark:bg-[#232734]":f,"lg:w-full xl:w-full pl-0":["chat_with_db_execute","chat_dashboard"].includes(a)}),children:[(0,t.jsx)("div",{className:"mr-2 flex flex-shrink-0 items-center justify-center h-7 w-7 rounded-full text-lg sm:mr-4",children:f?(0,ea.A)(d)||(0,t.jsx)(et.Z,{}):(0,t.jsx)(er.Z,{})}),(0,t.jsxs)("div",{className:"flex-1 overflow-hidden items-center text-md leading-8 pb-2",children:[!f&&"string"==typeof i&&i,f&&l&&"object"==typeof i&&(0,t.jsxs)("div",{children:["[".concat(i.template_name,"]: "),(0,t.jsxs)("span",{className:"text-theme-primary cursor-pointer",onClick:s,children:[(0,t.jsx)(el.Z,{className:"mr-1"}),i.template_introduce||"More Details"]})]}),f&&"string"==typeof i&&(0,t.jsx)(K.Z,{components:{...Q.ZP,...h},...Q.dx,children:(0,Q.CE)(ed(p))}),!!(null==g?void 0:g.length)&&(0,t.jsx)("div",{className:"flex flex-wrap mt-2",children:null==g?void 0:g.map((e,o)=>(0,t.jsx)(es.Z,{color:"#108ee9",children:e},e+o))})]}),o]}):(0,t.jsx)("div",{className:"h-12"})}),eu=n(91380),em=n(19423),ef=n(40155),eg=n(75256),ep=n(68224),ev=n(53056),eh=n(52547),ex=n(52832),ek=n(26906),eb=n(71230),ej=n(98639),ey=n(34378),e_=n(97640),ew=n(35677),eS=n(13501),eN=e=>{var o;let{conv_index:n,question:s,knowledge_space:a,select_param:i}=e,{t:d}=(0,Z.$G)(),{chatId:c}=(0,m.useContext)(r.p),[u,f]=(0,m.useState)(""),[g,p]=(0,m.useState)(4),[v,h]=(0,m.useState)(""),x=(0,m.useRef)(null),[_,w]=j.ZP.useMessage(),S=(0,m.useCallback)((e,o)=>{o?(0,l.Vx)((0,l.Eb)(c,n)).then(e=>{var o,n,t,r;let l=null!==(o=e[1])&&void 0!==o?o:{};f(null!==(n=l.ques_type)&&void 0!==n?n:""),p(parseInt(null!==(t=l.score)&&void 0!==t?t:"4")),h(null!==(r=l.messages)&&void 0!==r?r:"")}).catch(e=>{console.log(e)}):(f(""),p(4),h(""))},[c,n]),N=(0,ef.Z)(eg.Z)(e=>{let{theme:o}=e;return{backgroundColor:"dark"===o.palette.mode?"#FBFCFD":"#0E0E10",...o.typography["body-sm"],padding:o.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",borderRadius:4,width:"100%",height:"100%"}});return(0,t.jsxs)(ep.L,{onOpenChange:S,children:[w,(0,t.jsx)(y.Z,{title:d("Rating"),children:(0,t.jsx)(ev.Z,{slots:{root:b.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,t.jsx)(eu.Z,{})})}),(0,t.jsxs)(eh.Z,{children:[(0,t.jsx)(ex.Z,{disabled:!0,sx:{minHeight:0}}),(0,t.jsx)(ek.Z,{sx:{width:"100%",maxWidth:350,display:"grid",gap:3,padding:1},children:(0,t.jsx)("form",{onSubmit:e=>{e.preventDefault(),(0,l.Vx)((0,l.VC)({data:{conv_uid:c,conv_index:n,question:s,knowledge_space:a,score:g,ques_type:u,messages:v}})).then(e=>{_.open({type:"success",content:"save success"})}).catch(e=>{_.open({type:"error",content:"save error"})})},children:(0,t.jsxs)(eb.Z,{container:!0,spacing:.5,columns:13,sx:{flexGrow:1},children:[(0,t.jsx)(eb.Z,{xs:3,children:(0,t.jsx)(N,{children:d("Q_A_Category")})}),(0,t.jsx)(eb.Z,{xs:10,children:(0,t.jsx)(ej.Z,{action:x,value:u,placeholder:"Choose one…",onChange:(e,o)=>f(null!=o?o:""),...u&&{endDecorator:(0,t.jsx)(b.ZP,{size:"sm",variant:"plain",color:"neutral",onMouseDown:e=>{e.stopPropagation()},onClick:()=>{var e;f(""),null===(e=x.current)||void 0===e||e.focusVisible()},children:(0,t.jsx)(em.Z,{})}),indicator:null},sx:{width:"100%"},children:i&&(null===(o=Object.keys(i))||void 0===o?void 0:o.map(e=>(0,t.jsx)(ey.Z,{value:e,children:i[e]},e)))})}),(0,t.jsx)(eb.Z,{xs:3,children:(0,t.jsx)(N,{children:(0,t.jsx)(y.Z,{title:(0,t.jsx)(ek.Z,{children:(0,t.jsx)("div",{children:d("feed_back_desc")})}),variant:"solid",placement:"left",children:d("Q_A_Rating")})})}),(0,t.jsx)(eb.Z,{xs:10,sx:{pl:0,ml:0},children:(0,t.jsx)(e_.Z,{"aria-label":"Custom",step:1,min:0,max:5,valueLabelFormat:function(e){return({0:d("Lowest"),1:d("Missed"),2:d("Lost"),3:d("Incorrect"),4:d("Verbose"),5:d("Best")})[e]},valueLabelDisplay:"on",marks:[{value:0,label:"0"},{value:1,label:"1"},{value:2,label:"2"},{value:3,label:"3"},{value:4,label:"4"},{value:5,label:"5"}],sx:{width:"90%",pt:3,m:2,ml:1},onChange:e=>{var o;return p(null===(o=e.target)||void 0===o?void 0:o.value)},value:g})}),(0,t.jsx)(eb.Z,{xs:13,children:(0,t.jsx)(ew.Z,{placeholder:d("Please_input_the_text"),value:v,onChange:e=>h(e.target.value),minRows:2,maxRows:4,endDecorator:(0,t.jsx)(eS.ZP,{level:"body-xs",sx:{ml:"auto"},children:d("input_count")+v.length+d("input_unit")}),sx:{width:"100%",fontSize:14}})}),(0,t.jsx)(eb.Z,{xs:13,children:(0,t.jsx)(k.Z,{type:"submit",variant:"outlined",sx:{width:"100%",height:"100%"},children:d("submit")})})]})})})]})]})},eZ=n(94138),eC=e=>{var o,n;let{messages:s,onSubmit:d,onFormatContent:f}=e,{dbParam:p,currentDialogue:w,scene:C,model:P,refreshDialogList:M,chatId:D,agent:R,docId:E}=(0,m.useContext)(r.p),{t:O}=(0,Z.$G)(),T=(0,u.useSearchParams)(),I=null!==(o=T&&T.get("select_param"))&&void 0!==o?o:"",F=null!==(n=T&&T.get("spaceNameOriginal"))&&void 0!==n?n:"",[A,H]=(0,m.useState)(!1),[L,U]=(0,m.useState)(!1),[V,W]=(0,m.useState)(s),[q,B]=(0,m.useState)(""),[$,z]=(0,m.useState)(),J=(0,m.useRef)(null),K=(0,m.useMemo)(()=>"chat_dashboard"===C,[C]),Q=v(),Y=(0,m.useMemo)(()=>{switch(C){case"chat_agent":return R;case"chat_excel":return null==w?void 0:w.select_param;case"chat_flow":return I;default:return F||p}},[C,R,w,p,F,I]),ee=async e=>{if(!A&&e.trim()){if("chat_agent"===C&&!R){j.ZP.warning(O("choice_agent_tip"));return}try{H(!0),await d(e,{select_param:null!=Y?Y:""})}finally{H(!1)}}},eo=e=>K&&f&&"string"==typeof e?f(e):e,[en,et]=j.ZP.useMessage(),er=async e=>{let o=K&&f&&"string"==typeof e?f(e):e,n=null==o?void 0:o.replace(/\trelations:.*/g,""),t=S()(n);t?n?en.open({type:"success",content:O("copy_success")}):en.open({type:"warning",content:O("copy_nothing")}):en.open({type:"error",content:O("copy_failed")})},el=async()=>{!A&&E&&(H(!0),await Q(E),H(!1))};return(0,i.Z)(async()=>{let e=(0,a.a_)();e&&e.id===D&&(await ee(e.message),M(),localStorage.removeItem(a.rU))},[D]),(0,m.useEffect)(()=>{let e=s;K&&(e=(0,N.cloneDeep)(s).map(e=>{if((null==e?void 0:e.role)==="view"&&"string"==typeof(null==e?void 0:e.context))try{e.context=JSON.parse(e.context)}catch(o){f&&(e.context=eo(e.context))}return e})),W(e.filter(e=>["view","human"].includes(e.role)))},[K,s,f]),(0,m.useEffect)(()=>{(0,l.Vx)((0,l.Lu)()).then(e=>{var o;z(null!==(o=e[1])&&void 0!==o?o:{})}).catch(e=>{console.log(e)})},[]),(0,m.useEffect)(()=>{setTimeout(()=>{var e;null===(e=J.current)||void 0===e||e.scrollTo(0,J.current.scrollHeight)},50)},[s]),(0,t.jsxs)(t.Fragment,{children:[et,(0,t.jsx)("div",{ref:J,className:"flex flex-1 overflow-y-auto h-full w-full flex-col",children:(0,t.jsx)("div",{className:"flex items-center flex-1 flex-col text-sm leading-6 text-slate-900 dark:text-slate-300 sm:text-base sm:leading-7",children:V.length?V.map((e,o)=>{var n;return"chat_agent"===C?(0,t.jsx)(X,{content:e},o):(0,t.jsx)(ec,{content:e,isChartChat:K,onLinkClick:()=>{U(!0),B(JSON.stringify(null==e?void 0:e.context,null,2))},children:"view"===e.role&&(0,t.jsxs)("div",{className:"flex w-full border-t border-gray-200 dark:border-theme-dark",children:["chat_knowledge"===C&&e.retry?(0,t.jsxs)(k.Z,{onClick:el,slots:{root:b.ZP},slotProps:{root:{variant:"plain",color:"primary"}},children:[(0,t.jsx)(h.Z,{}),"\xa0",(0,t.jsx)("span",{className:"text-sm",children:O("Retry")})]}):null,(0,t.jsxs)("div",{className:"flex w-full flex-row-reverse",children:[(0,t.jsx)(eN,{select_param:$,conv_index:Math.ceil((o+1)/2),question:null===(n=null==V?void 0:V.filter(o=>(null==o?void 0:o.role)==="human"&&(null==o?void 0:o.order)===e.order)[0])||void 0===n?void 0:n.context,knowledge_space:F||p||""}),(0,t.jsx)(y.Z,{title:O("Copy_Btn"),children:(0,t.jsx)(k.Z,{onClick:()=>er(null==e?void 0:e.context),slots:{root:b.ZP},slotProps:{root:{variant:"plain",color:"primary"}},sx:{borderRadius:40},children:(0,t.jsx)(x.Z,{})})})]})]})},o)}):(0,t.jsx)(g.Z,{description:"Start a conversation"})})}),(0,t.jsx)("div",{className:c()("relative sticky bottom-0 bg-theme-light dark:bg-theme-dark after:absolute after:-top-8 after:h-8 after:w-full after:bg-gradient-to-t after:from-theme-light after:to-transparent dark:after:from-theme-dark",{"cursor-not-allowed":"chat_excel"===C&&!(null==w?void 0:w.select_param)}),children:(0,t.jsxs)("div",{className:"flex flex-wrap w-full py-2 sm:pt-6 sm:pb-10 items-center",children:[P&&(0,t.jsx)("div",{className:"mr-2 flex",children:(0,ea.A)(P)}),(0,t.jsx)(G,{loading:A,onSubmit:ee,handleFinish:H})]})}),(0,t.jsx)(_.default,{title:"JSON Editor",open:L,width:"60%",cancelButtonProps:{hidden:!0},onOk:()=>{U(!1)},onCancel:()=>{U(!1)},children:(0,t.jsx)(eZ.Z,{className:"w-full h-[500px]",language:"json",value:q})})]})},eP=n(88788);let eM=e=>{if("string"!=typeof e)return e;if(e.startsWith("```vis-thinking")||e.includes("```vis-thinking")){let o=e.indexOf('{"');if(-1!==o){let n=e.substring(o);try{return JSON.parse(n)}catch(o){let e=n.replace(/```$/g,"").trim();try{return JSON.parse(e)}catch(e){return console.error("Error parsing cleaned JSON:",e),null}}}}try{return"string"==typeof e?JSON.parse(e):e}catch(o){return console.log("Not JSON format or vis-thinking format, returning original content"),e}},eD=e=>{if("string"!=typeof e)return e;if(e.startsWith("```vis-thinking")||e.includes("```vis-thinking")){let o=e.indexOf("```vis-thinking"),n=o+15,t=e.indexOf("```",n);if(-1!==t)return e.substring(o,t+3)}return e};var eR=()=>{var e;let o=(0,u.useSearchParams)(),{scene:n,chatId:d,model:v,agent:h,setModel:x,history:k,setHistory:b}=(0,m.useContext)(r.p),{chat:j}=(0,s.Z)({}),y=null!==(e=o&&o.get("initMessage"))&&void 0!==e?e:"",[_,w]=(0,m.useState)(!1),[S,N]=(0,m.useState)(),Z=async()=>{w(!0);let[,e]=await (0,l.Vx)((0,l.$i)(d));b(null!=e?e:[]),w(!1)},C=e=>{var o;let n=null===(o=e[e.length-1])||void 0===o?void 0:o.context;if(n)try{let e=eM(n),o="object"==typeof e?e:"string"==typeof n?JSON.parse(n):n;N((null==o?void 0:o.template_name)==="report"?null==o?void 0:o.charts:void 0)}catch(e){console.log(e),N([])}};(0,i.Z)(async()=>{let e=(0,a.a_)();e&&e.id===d||await Z()},[y,d]),(0,m.useEffect)(()=>{var e,o;if(!k.length)return;let n=null===(e=null===(o=k.filter(e=>"view"===e.role))||void 0===o?void 0:o.slice(-1))||void 0===e?void 0:e[0];(null==n?void 0:n.model_name)&&x(n.model_name),C(k)},[k.length]),(0,m.useEffect)(()=>()=>{b([])},[]);let P=(0,m.useCallback)((e,o)=>new Promise(t=>{let r=[...k,{role:"human",context:e,model_name:v,order:0,time_stamp:0},{role:"view",context:"",model_name:v,order:0,time_stamp:0}],l=r.length-1;b([...r]),j({data:{...o,chat_mode:n||"chat_normal",model_name:v,user_input:e},chatId:d,onMessage:e=>{(null==o?void 0:o.incremental)?r[l].context+=e:r[l].context=e,b([...r])},onDone:()=>{C(r),t()},onClose:()=>{C(r),t()},onError:e=>{r[l].context=e,b([...r]),t()}})}),[k,j,d,v,h,n]);return(0,t.jsxs)("div",{className:"flex flex-col h-screen w-full overflow-hidden",children:[(0,t.jsx)(p.Z,{visible:_}),(0,t.jsx)("div",{className:"flex-none",children:(0,t.jsx)(eP.Z,{refreshHistory:Z,modelChange:e=>{x(e)}})}),(0,t.jsxs)("div",{className:"flex-auto flex overflow-hidden",children:[!!(null==S?void 0:S.length)&&(0,t.jsx)("div",{className:c()("overflow-auto",{"w-full h-1/2 md:h-full md:w-3/4 pb-4 md:pr-4":"chat_dashboard"===n}),children:(0,t.jsx)(f.ZP,{chartsData:S})}),!(null==S?void 0:S.length)&&"chat_dashboard"===n&&(0,t.jsx)("div",{className:c()("flex items-center justify-center",{"w-full h-1/2 md:h-full md:w-3/4":"chat_dashboard"===n}),children:(0,t.jsx)(g.Z,{})}),(0,t.jsx)("div",{className:c()("flex flex-col overflow-hidden",{"w-full h-1/2 md:h-full md:w-1/4 border-t md:border-t-0 md:border-l dark:border-gray-800":"chat_dashboard"===n,"w-full h-full px-4 lg:px-8":"chat_dashboard"!==n}),children:(0,t.jsx)("div",{className:"h-full overflow-hidden",children:(0,t.jsx)(eC,{messages:k,onSubmit:P,onFormatContent:eD})})})]})]})}},88788:function(e,o,n){"use strict";n.d(o,{Z:function(){return D}});var t=n(52676),r=n(21011),l=n(10902),s=n(39048),a=n(75509),i=n(44211),d=n(86591),c=n(75271);function u(){let{isContract:e,setIsContract:o,scene:n}=(0,c.useContext)(r.p),l=n&&["chat_with_db_execute","chat_dashboard"].includes(n);return l?(0,t.jsxs)(d.ZP.Group,{value:e,defaultValue:!0,buttonStyle:"solid",onChange:()=>{o(!e)},children:[(0,t.jsxs)(d.ZP.Button,{value:!1,children:[(0,t.jsx)(a.Z,{component:s.ig,className:"mr-1"}),"Preview"]}),(0,t.jsxs)(d.ZP.Button,{value:!0,children:[(0,t.jsx)(i.Z,{className:"mr-1"}),"Editor"]})]}):null}n(21800);var m=n(59864),f=n(99113),g=n(62601),p=n(78490),v=function(){let{t:e}=(0,p.$G)(),{agent:o,setAgent:n}=(0,c.useContext)(r.p),{data:l=[]}=(0,f.Z)(async()=>{let[,e]=await (0,m.Vx)((0,m.H4)());return null!=e?e:[]});return(0,t.jsx)(g.default,{className:"w-60",value:o,placeholder:e("Select_Plugins"),options:l.map(e=>({label:e.app_name,value:e.app_code})),allowClear:!0,onChange:e=>{null==n||n(e)}})},h=n(81707),x=n(31959),k=n(1483),b=n(15739),j=n(42673),y=n(40389),_=n(54426),w=n(41148),S=function(e){var o;let{convUid:n,chatMode:l,onComplete:s,...a}=e,[i,d]=(0,c.useState)(!1),[u,f]=j.ZP.useMessage(),[g,p]=(0,c.useState)([]),[v,S]=(0,c.useState)(),{model:N}=(0,c.useContext)(r.p),{temperatureValue:Z,maxNewTokensValue:C}=(0,c.useContext)(x.ChatContentContext),P=async e=>{var o;if(!e){j.ZP.error("Please select the *.(csv|xlsx|xls) file");return}if(!/\.(csv|xlsx|xls)$/.test(null!==(o=e.file.name)&&void 0!==o?o:"")){j.ZP.error("File type must be csv, xlsx or xls");return}p([e.file])},M=async()=>{d(!0);try{let e=new FormData;e.append("doc_file",g[0]),u.open({content:"Uploading ".concat(g[0].name),type:"loading",duration:0});let[o]=await (0,m.Vx)((0,m.qn)({convUid:n,chatMode:l,data:e,model:N,temperatureValue:Z,maxNewTokensValue:C,config:{timeout:36e5,onUploadProgress:e=>{let o=Math.ceil(e.loaded/(e.total||0)*100);S(o)}}}));if(o)return;j.ZP.success("success"),null==s||s()}catch(e){j.ZP.error((null==e?void 0:e.message)||"Upload Error")}finally{d(!1),u.destroy()}};return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[f,(0,t.jsx)(y.Z,{placement:"bottom",title:"File cannot be changed after upload",children:(0,t.jsx)(_.default,{disabled:i,className:"mr-1",beforeUpload:()=>!1,fileList:g,name:"file",accept:".csv,.xlsx,.xls",multiple:!1,onChange:P,showUploadList:{showDownloadIcon:!1,showPreviewIcon:!1,showRemoveIcon:!1},itemRender:()=>(0,t.jsx)(t.Fragment,{}),...a,children:(0,t.jsx)(w.ZP,{className:"flex justify-center items-center",type:"primary",disabled:i,icon:(0,t.jsx)(k.Z,{}),children:"Select File"})})}),(0,t.jsx)(w.ZP,{type:"primary",loading:i,className:"flex justify-center items-center",disabled:!g.length,icon:(0,t.jsx)(b.Z,{}),onClick:M,children:i?100===v?"Analysis":"Uploading":"Upload"}),!!g.length&&(0,t.jsxs)("div",{className:"mt-2 text-gray-500 text-sm flex items-center",onClick:()=>p([]),children:[(0,t.jsx)(h.Z,{className:"mr-2"}),(0,t.jsx)("span",{children:null===(o=g[0])||void 0===o?void 0:o.name})]})]})})},N=function(e){let{onComplete:o}=e,{currentDialogue:n,scene:l,chatId:s}=(0,c.useContext)(r.p);return"chat_excel"!==l?null:(0,t.jsx)("div",{className:"max-w-md h-full relative",children:n?(0,t.jsxs)("div",{className:"flex h-8 overflow-hidden rounded",children:[(0,t.jsx)("div",{className:"flex items-center justify-center px-2 bg-gray-600 text-lg",children:(0,t.jsx)(h.Z,{className:"text-white"})}),(0,t.jsx)("div",{className:"flex items-center justify-center px-3 bg-gray-100 text-xs rounded-tr rounded-br dark:text-gray-800 truncate",children:n.select_param})]}):(0,t.jsx)(S,{convUid:s,chatMode:l,onComplete:o})})},Z=n(2803),C=n(92821),P=n(7297),M=function(){let{scene:e,dbParam:o,setDbParam:n}=(0,c.useContext)(r.p),[l,s]=(0,c.useState)([]);(0,P.Z)(async()=>{let[,o]=await (0,m.Vx)((0,m.vD)(e));s(null!=o?o:[])},[e]);let a=(0,c.useMemo)(()=>{var e;return null===(e=l.map)||void 0===e?void 0:e.call(l,e=>({name:e.param,...C.S$[e.type]}))},[l]);return((0,c.useEffect)(()=>{(null==a?void 0:a.length)&&!o&&n(a[0].name)},[a,n,o]),null==a?void 0:a.length)?(0,t.jsx)(g.default,{value:o,className:"w-36",onChange:e=>{n(e)},children:a.map(e=>(0,t.jsxs)(g.default.Option,{children:[(0,t.jsx)(Z.Z,{width:24,height:24,src:e.icon,label:e.label,className:"w-[1.5em] h-[1.5em] mr-1 inline-block mt-[-4px]"}),e.name]},e.name))}):null},D=function(e){let{refreshHistory:o,modelChange:n}=e,{scene:s,refreshDialogList:a}=(0,c.useContext)(r.p);return(0,t.jsxs)("div",{className:"w-full py-2 px-4 md:px-4 flex flex-wrap items-center justify-center gap-1 md:gap-4",children:[(0,t.jsx)(l.Z,{onChange:n}),(0,t.jsx)(M,{}),"chat_excel"===s&&(0,t.jsx)(N,{onComplete:()=>{null==a||a(),null==o||o()}}),"chat_agent"===s&&(0,t.jsx)(v,{}),(0,t.jsx)(u,{})]})}},10902:function(e,o,n){"use strict";n.d(o,{A:function(){return m}});var t=n(52676),r=n(21011),l=n(31819),s=n(62601),a=n(87402),i=n.n(a),d=n(75271),c=n(78490);let u="/models/huggingface.svg";function m(e,o){var n,r;let{width:s,height:a}=o||{};return e?(0,t.jsx)(i(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:s||24,height:a||24,src:(null===(n=l.Hf[e])||void 0===n?void 0:n.icon)||u,alt:"llm"},(null===(r=l.Hf[e])||void 0===r?void 0:r.icon)||u):null}o.Z=function(e){let{onChange:o}=e,{t:n}=(0,c.$G)(),{modelList:a,model:i}=(0,d.useContext)(r.p);return!a||a.length<=0?null:(0,t.jsx)(s.default,{value:i,placeholder:n("choose_model"),className:"w-52",onChange:e=>{null==o||o(e)},children:a.map(e=>{var o;return(0,t.jsx)(s.default.Option,{children:(0,t.jsxs)("div",{className:"flex items-center",children:[m(e),(0,t.jsx)("span",{className:"ml-2",children:(null===(o=l.Hf[e])||void 0===o?void 0:o.label)||e})]})},e)})})}},94138:function(e,o,n){"use strict";let t;n.d(o,{Z:function(){return g}});var r=n(52676),l=n(21011),s=n(92821),a=n(67167),i=n(9181),d=n(82187),c=n.n(d),u=n(8661),m=n(75271);async function f(){window.obMonaco={getWorkerUrl:e=>{switch(e){case"mysql":return location.origin+"/_next/static/ob-workers/mysql.js";case"obmysql":return location.origin+"/_next/static/ob-workers/obmysql.js";case"oboracle":return location.origin+"/_next/static/ob-workers/oracle.js"}return""}};let e=await n.e(7634).then(n.bind(n,27634)),o=e.default;return t||(t=new o).setup(["mysql"]),t}function g(e){let{className:o,value:n,language:t="mysql",onChange:d,thoughts:u,session:g}=e,p=(0,m.useMemo)(()=>"mysql"!==t?n:u&&u.length>0?(0,s._m)("-- ".concat(u," \n").concat(n)):(0,s._m)(n),[n,u]),v=(0,i.Z)(g),h=(0,m.useContext)(l.p);async function x(e){var o,n;let t=await f();t.setModelOptions((null===(o=e.getModel())||void 0===o?void 0:o.id)||"",function(e,o){let{_modelId:n,delimiter:t}=e;return{delimiter:t,async getTableList(e){var n;return(null==o?void 0:null===(n=o())||void 0===n?void 0:n.getTableList(e))||[]},async getTableColumns(e,n){var t;return(null==o?void 0:null===(t=o())||void 0===t?void 0:t.getTableColumns(e))||[]},async getSchemaList(){var e;return(null==o?void 0:null===(e=o())||void 0===e?void 0:e.getSchemaList())||[]}}}({modelId:(null===(n=e.getModel())||void 0===n?void 0:n.id)||"",delimiter:";"},()=>v.current||null))}return(0,r.jsx)(a.ZP,{className:c()(o),onMount:x,value:p,defaultLanguage:t,onChange:d,theme:(null==h?void 0:h.mode)!=="dark"?"github":"githubDark",options:{minimap:{enabled:!1},wordWrap:"on"}})}a._m.config({monaco:u}),u.editor.defineTheme("github",{base:"vs",inherit:!0,rules:[{background:"ffffff",token:""},{foreground:"6a737d",token:"comment"},{foreground:"6a737d",token:"punctuation.definition.comment"},{foreground:"6a737d",token:"string.comment"},{foreground:"005cc5",token:"constant"},{foreground:"005cc5",token:"entity.name.constant"},{foreground:"005cc5",token:"variable.other.constant"},{foreground:"005cc5",token:"variable.language"},{foreground:"6f42c1",token:"entity"},{foreground:"6f42c1",token:"entity.name"},{foreground:"24292e",token:"variable.parameter.function"},{foreground:"22863a",token:"entity.name.tag"},{foreground:"d73a49",token:"keyword"},{foreground:"d73a49",token:"storage"},{foreground:"d73a49",token:"storage.type"},{foreground:"24292e",token:"storage.modifier.package"},{foreground:"24292e",token:"storage.modifier.import"},{foreground:"24292e",token:"storage.type.java"},{foreground:"032f62",token:"string"},{foreground:"032f62",token:"punctuation.definition.string"},{foreground:"032f62",token:"string punctuation.section.embedded source"},{foreground:"005cc5",token:"support"},{foreground:"005cc5",token:"meta.property-name"},{foreground:"e36209",token:"variable"},{foreground:"24292e",token:"variable.other"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"b31d28",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"b31d28",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"b31d28",token:"message.error"},{foreground:"24292e",token:"string source"},{foreground:"005cc5",token:"string variable"},{foreground:"032f62",token:"source.regexp"},{foreground:"032f62",token:"string.regexp"},{foreground:"032f62",token:"string.regexp.character-class"},{foreground:"032f62",token:"string.regexp constant.character.escape"},{foreground:"032f62",token:"string.regexp source.ruby.embedded"},{foreground:"032f62",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"22863a",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"005cc5",token:"support.constant"},{foreground:"005cc5",token:"support.variable"},{foreground:"005cc5",token:"meta.module-reference"},{foreground:"735c0f",token:"markup.list"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading"},{foreground:"005cc5",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"22863a",token:"markup.quote"},{foreground:"24292e",fontStyle:"italic",token:"markup.italic"},{foreground:"24292e",fontStyle:"bold",token:"markup.bold"},{foreground:"005cc5",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"22863a",background:"f0fff4",token:"markup.inserted"},{foreground:"22863a",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"22863a",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"e36209",background:"ffebda",token:"markup.changed"},{foreground:"e36209",background:"ffebda",token:"punctuation.definition.changed"},{foreground:"f6f8fa",background:"005cc5",token:"markup.ignored"},{foreground:"f6f8fa",background:"005cc5",token:"markup.untracked"},{foreground:"6f42c1",fontStyle:"bold",token:"meta.diff.range"},{foreground:"005cc5",token:"meta.diff.header"},{foreground:"005cc5",fontStyle:"bold",token:"meta.separator"},{foreground:"005cc5",token:"meta.output"},{foreground:"586069",token:"brackethighlighter.tag"},{foreground:"586069",token:"brackethighlighter.curly"},{foreground:"586069",token:"brackethighlighter.round"},{foreground:"586069",token:"brackethighlighter.square"},{foreground:"586069",token:"brackethighlighter.angle"},{foreground:"586069",token:"brackethighlighter.quote"},{foreground:"b31d28",token:"brackethighlighter.unmatched"},{foreground:"b31d28",token:"sublimelinter.mark.error"},{foreground:"e36209",token:"sublimelinter.mark.warning"},{foreground:"959da5",token:"sublimelinter.gutter-mark"},{foreground:"032f62",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"032f62",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#24292e","editor.background":"#ffffff","editor.selectionBackground":"#c8c8fa","editor.inactiveSelectionBackground":"#fafbfc","editor.lineHighlightBackground":"#fafbfc","editorCursor.foreground":"#24292e","editorWhitespace.foreground":"#959da5","editorIndentGuide.background":"#959da5","editorIndentGuide.activeBackground":"#24292e","editor.selectionHighlightBorder":"#fafbfc"}}),u.editor.defineTheme("githubDark",{base:"vs-dark",inherit:!0,rules:[{background:"24292e",token:""},{foreground:"959da5",token:"comment"},{foreground:"959da5",token:"punctuation.definition.comment"},{foreground:"959da5",token:"string.comment"},{foreground:"c8e1ff",token:"constant"},{foreground:"c8e1ff",token:"entity.name.constant"},{foreground:"c8e1ff",token:"variable.other.constant"},{foreground:"c8e1ff",token:"variable.language"},{foreground:"b392f0",token:"entity"},{foreground:"b392f0",token:"entity.name"},{foreground:"f6f8fa",token:"variable.parameter.function"},{foreground:"7bcc72",token:"entity.name.tag"},{foreground:"ea4a5a",token:"keyword"},{foreground:"ea4a5a",token:"storage"},{foreground:"ea4a5a",token:"storage.type"},{foreground:"f6f8fa",token:"storage.modifier.package"},{foreground:"f6f8fa",token:"storage.modifier.import"},{foreground:"f6f8fa",token:"storage.type.java"},{foreground:"79b8ff",token:"string"},{foreground:"79b8ff",token:"punctuation.definition.string"},{foreground:"79b8ff",token:"string punctuation.section.embedded source"},{foreground:"c8e1ff",token:"support"},{foreground:"c8e1ff",token:"meta.property-name"},{foreground:"fb8532",token:"variable"},{foreground:"f6f8fa",token:"variable.other"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.broken"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.deprecated"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"invalid.illegal"},{foreground:"fafbfc",background:"d73a49",fontStyle:"italic underline",token:"carriage-return"},{foreground:"d73a49",fontStyle:"bold italic underline",token:"invalid.unimplemented"},{foreground:"d73a49",token:"message.error"},{foreground:"f6f8fa",token:"string source"},{foreground:"c8e1ff",token:"string variable"},{foreground:"79b8ff",token:"source.regexp"},{foreground:"79b8ff",token:"string.regexp"},{foreground:"79b8ff",token:"string.regexp.character-class"},{foreground:"79b8ff",token:"string.regexp constant.character.escape"},{foreground:"79b8ff",token:"string.regexp source.ruby.embedded"},{foreground:"79b8ff",token:"string.regexp string.regexp.arbitrary-repitition"},{foreground:"7bcc72",fontStyle:"bold",token:"string.regexp constant.character.escape"},{foreground:"c8e1ff",token:"support.constant"},{foreground:"c8e1ff",token:"support.variable"},{foreground:"c8e1ff",token:"meta.module-reference"},{foreground:"fb8532",token:"markup.list"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading"},{foreground:"0366d6",fontStyle:"bold",token:"markup.heading entity.name"},{foreground:"c8e1ff",token:"markup.quote"},{foreground:"f6f8fa",fontStyle:"italic",token:"markup.italic"},{foreground:"f6f8fa",fontStyle:"bold",token:"markup.bold"},{foreground:"c8e1ff",token:"markup.raw"},{foreground:"b31d28",background:"ffeef0",token:"markup.deleted"},{foreground:"b31d28",background:"ffeef0",token:"meta.diff.header.from-file"},{foreground:"b31d28",background:"ffeef0",token:"punctuation.definition.deleted"},{foreground:"176f2c",background:"f0fff4",token:"markup.inserted"},{foreground:"176f2c",background:"f0fff4",token:"meta.diff.header.to-file"},{foreground:"176f2c",background:"f0fff4",token:"punctuation.definition.inserted"},{foreground:"b08800",background:"fffdef",token:"markup.changed"},{foreground:"b08800",background:"fffdef",token:"punctuation.definition.changed"},{foreground:"2f363d",background:"959da5",token:"markup.ignored"},{foreground:"2f363d",background:"959da5",token:"markup.untracked"},{foreground:"b392f0",fontStyle:"bold",token:"meta.diff.range"},{foreground:"c8e1ff",token:"meta.diff.header"},{foreground:"0366d6",fontStyle:"bold",token:"meta.separator"},{foreground:"0366d6",token:"meta.output"},{foreground:"ffeef0",token:"brackethighlighter.tag"},{foreground:"ffeef0",token:"brackethighlighter.curly"},{foreground:"ffeef0",token:"brackethighlighter.round"},{foreground:"ffeef0",token:"brackethighlighter.square"},{foreground:"ffeef0",token:"brackethighlighter.angle"},{foreground:"ffeef0",token:"brackethighlighter.quote"},{foreground:"d73a49",token:"brackethighlighter.unmatched"},{foreground:"d73a49",token:"sublimelinter.mark.error"},{foreground:"fb8532",token:"sublimelinter.mark.warning"},{foreground:"6a737d",token:"sublimelinter.gutter-mark"},{foreground:"79b8ff",fontStyle:"underline",token:"constant.other.reference.link"},{foreground:"79b8ff",fontStyle:"underline",token:"string.other.link"}],colors:{"editor.foreground":"#f6f8fa","editor.background":"#24292e","editor.selectionBackground":"#4c2889","editor.inactiveSelectionBackground":"#444d56","editor.lineHighlightBackground":"#444d56","editorCursor.foreground":"#ffffff","editorWhitespace.foreground":"#6a737d","editorIndentGuide.background":"#6a737d","editorIndentGuide.activeBackground":"#f6f8fa","editor.selectionHighlightBorder":"#444d56"}})},35202:function(e,o,n){"use strict";var t=n(52676),r=n(57107),l=n(41148),s=n(82187),a=n.n(s),i=n(78490);o.Z=function(e){let{className:o,error:n,description:s,refresh:d}=e,{t:c}=(0,i.$G)();return(0,t.jsx)(r.Z,{image:"/empty.png",imageStyle:{width:320,height:196,margin:"0 auto",maxWidth:"100%",maxHeight:"100%"},className:a()("flex items-center justify-center flex-col h-full w-full",o),description:n?(0,t.jsx)(l.ZP,{type:"primary",onClick:d,children:c("try_again")}):null!=s?s:c("no_data")})}},2803:function(e,o,n){"use strict";var t=n(52676),r=n(87402),l=n.n(r);o.Z=function(e){let{src:o,label:n,width:r,height:s,className:a}=e;return(0,t.jsx)(l(),{className:"w-11 h-11 rounded-full mr-4 border border-gray-200 object-contain bg-white ".concat(a),width:r||44,height:s||44,src:o,alt:n||"db-icon"})}},74881:function(e,o,n){"use strict";var t=n(52676),r=n(24573);o.Z=function(e){let{visible:o}=e;return o?(0,t.jsx)("div",{className:"absolute w-full h-full top-0 left-0 flex justify-center items-center z-10 bg-white dark:bg-black bg-opacity-50 dark:bg-opacity-50 backdrop-blur-sm text-3xl animate-fade animate-duration-200",children:(0,t.jsx)(r.Z,{})}):null}},40797:function(e,o,n){"use strict";var t=n(84769);o.Z=()=>{var e;return JSON.parse(null!==(e=localStorage.getItem(t.C9))&&void 0!==e?e:"")}},10332:function(e,o,n){"use strict";var t=n(52676),r=n(31819),l=n(87402),s=n.n(l),a=n(75271);o.Z=(0,a.memo)(e=>{let{width:o,height:n,model:l}=e,i=(0,a.useMemo)(()=>(0,r.ab)(l||"huggingface"),[l]);return l?(0,t.jsx)(s(),{className:"rounded-full border border-gray-200 object-contain bg-white inline-block",width:o||24,height:n||24,src:i,alt:"llm",priority:!0}):null})},67665:function(e,o,n){"use strict";n.r(o);var t=n(52676),r=n(99275),l=n(81899),s=n(56697),a=n(44610),i=n(874),d=n.n(i),c=n(75271),u=n(919);o.default=(0,c.memo)(()=>{var e;let{appInfo:o}=(0,c.useContext)(u.MobileChatContext),{message:n}=s.Z.useApp(),[i,m]=(0,c.useState)(0);if(!(null==o?void 0:o.app_code))return null;let f=async()=>{let e=d()("dingtalk://dingtalkclient/page/link?url=".concat(encodeURIComponent(location.href),"&pc_slide=true"));n[e?"success":"error"](e?"复制成功":"复制失败")};return i>6&&n.info(JSON.stringify(window.navigator.userAgent),2,()=>{m(0)}),(0,t.jsxs)("header",{className:"flex w-full items-center justify-between bg-[rgba(255,255,255,0.9)] border dark:bg-black dark:border-[rgba(255,255,255,0.6)] rounded-xl mx-auto px-4 py-2 mb-4 sticky top-4 z-50 mt-4 shadow-md",children:[(0,t.jsxs)("div",{className:"flex gap-2 items-center",onClick:()=>m(i+1),children:[(0,t.jsx)(r.Z,{scene:(null==o?void 0:null===(e=o.team_context)||void 0===e?void 0:e.chat_scene)||"chat_agent",width:8,height:8}),(0,t.jsxs)("div",{className:"flex flex-col ml-2",children:[(0,t.jsx)(a.Z.Text,{className:"text-md font-bold line-clamp-2",children:null==o?void 0:o.app_name}),(0,t.jsx)(a.Z.Text,{className:"text-sm line-clamp-2",children:null==o?void 0:o.app_describe})]})]}),(0,t.jsx)("div",{onClick:f,className:"flex items-center justify-center w-10 h-10 bg-[#ffffff99] dark:bg-[rgba(255,255,255,0.2)] border border-white dark:border-[rgba(255,255,255,0.2)] rounded-[50%] cursor-pointer",children:(0,t.jsx)(l.Z,{className:"text-lg"})})]})})},76357:function(e,o,n){"use strict";n.r(o);var t=n(52676),r=n(59864),l=n(92821),s=n(84769),a=n(84774),i=n(4093),d=n(24573),c=n(77635),u=n(28974),m=n(63464),f=n(99113),g=n(56367),p=n(32651),v=n(94634),h=n(72423),x=n(41148),k=n(82187),b=n.n(k),j=n(29052),y=n(75271),_=n(919),w=n(68120),S=n(58521),N=n(59741),Z=n(31226);let C=["magenta","orange","geekblue","purple","cyan","green"];o.default=()=>{var e,o;let n=(0,j.useSearchParams)(),k=null!==(o=null==n?void 0:n.get("ques"))&&void 0!==o?o:"",{history:P,model:M,scene:D,temperature:R,resource:E,conv_uid:O,appInfo:T,scrollViewRef:I,order:F,userInput:A,ctrl:H,canAbort:L,canNewChat:U,setHistory:V,setCanNewChat:W,setCarAbort:q,setUserInput:B}=(0,y.useContext)(_.MobileChatContext),[$,z]=(0,y.useState)(!1),[J,G]=(0,y.useState)(!1),K=async e=>{var o,n,t;B(""),H.current=new AbortController;let r={chat_mode:D,model_name:M,user_input:e||A,conv_uid:O,temperature:R,app_code:null==T?void 0:T.app_code,...E&&{select_param:JSON.stringify(E)}};if(P&&P.length>0){let e=null==P?void 0:P.filter(e=>"view"===e.role);F.current=e[e.length-1].order+1}let a=[{role:"human",context:e||A,model_name:M,order:F.current,time_stamp:0},{role:"view",context:"",model_name:M,order:F.current,time_stamp:0,thinking:!0}],i=a.length-1;V([...P,...a]),W(!1);try{await (0,m.L)("".concat(null!==(o=Z.env.API_BASE_URL)&&void 0!==o?o:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[s.gp]:null!==(n=(0,l.n5)())&&void 0!==n?n:""},signal:H.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===m.a)return},onclose(){var e;null===(e=H.current)||void 0===e||e.abort(),W(!0),q(!1)},onerror(e){throw Error(e)},onmessage:e=>{let o=e.data;try{o=JSON.parse(o).vis}catch(e){o.replaceAll("\\n","\n")}"[DONE]"===o?(W(!0),q(!1)):(null==o?void 0:o.startsWith("[ERROR]"))?(a[i].context=null==o?void 0:o.replace("[ERROR]",""),a[i].thinking=!1,V([...P,...a]),W(!0),q(!1)):(q(!0),a[i].context=o,a[i].thinking=!1,V([...P,...a]))}})}catch(e){null===(t=H.current)||void 0===t||t.abort(),a[i].context="Sorry, we meet some error, please try again later.",a[i].thinking=!1,V([...a]),W(!0),q(!1)}},Q=async()=>{A.trim()&&U&&await K()};(0,y.useEffect)(()=>{var e,o;null===(e=I.current)||void 0===e||e.scrollTo({top:null===(o=I.current)||void 0===o?void 0:o.scrollHeight,behavior:"auto"})},[P,I]);let X=(0,y.useMemo)(()=>{if(!T)return[];let{param_need:e=[]}=T;return null==e?void 0:e.map(e=>e.type)},[T]),Y=(0,y.useMemo)(()=>{var e;return 0===P.length&&T&&!!(null==T?void 0:null===(e=T.recommend_questions)||void 0===e?void 0:e.length)},[P,T]),{run:ee,loading:eo}=(0,f.Z)(async()=>await (0,r.Vx)((0,r.zR)(O)),{manual:!0,onSuccess:()=>{V([])}});return(0,y.useEffect)(()=>{k&&M&&O&&T&&K(k)},[T,O,M,k]),(0,t.jsxs)("div",{className:"flex flex-col",children:[Y&&(0,t.jsx)("ul",{children:null==T?void 0:null===(e=T.recommend_questions)||void 0===e?void 0:e.map((e,o)=>(0,t.jsx)("li",{className:"mb-3",children:(0,t.jsx)(g.Z,{color:C[o],className:"p-2 rounded-xl",onClick:async()=>{K(e.question)},children:e.question})},e.id))}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,t.jsxs)("div",{className:"flex gap-2 mb-1 w-full overflow-x-auto",children:[(null==X?void 0:X.includes("model"))&&(0,t.jsx)(w.default,{}),(null==X?void 0:X.includes("resource"))&&(0,t.jsx)(S.default,{}),(null==X?void 0:X.includes("temperature"))&&(0,t.jsx)(N.default,{})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,t.jsx)(p.Z,{content:"暂停回复",trigger:["hover"],children:(0,t.jsx)(a.Z,{className:b()("p-2 cursor-pointer",{"text-[#0c75fc]":L,"text-gray-400":!L}),onClick:()=>{var e;L&&(null===(e=H.current)||void 0===e||e.abort(),setTimeout(()=>{q(!1),W(!0)},100))}})}),(0,t.jsx)(p.Z,{content:"再来一次",trigger:["hover"],children:(0,t.jsx)(i.Z,{className:b()("p-2 cursor-pointer",{"text-gray-400":!P.length||!U}),onClick:()=>{var e,o;if(!U||0===P.length)return;let n=null===(e=null===(o=P.filter(e=>"human"===e.role))||void 0===o?void 0:o.slice(-1))||void 0===e?void 0:e[0];K((null==n?void 0:n.context)||"")}})}),eo?(0,t.jsx)(v.Z,{spinning:eo,indicator:(0,t.jsx)(d.Z,{style:{fontSize:18},spin:!0}),className:"p-2"}):(0,t.jsx)(p.Z,{content:"清除历史",trigger:["hover"],children:(0,t.jsx)(c.Z,{className:b()("p-2 cursor-pointer",{"text-gray-400":!P.length||!U}),onClick:()=>{U&&ee()}})})]})]}),(0,t.jsxs)("div",{className:b()("flex py-2 px-3 items-center justify-between bg-white dark:bg-[#242733] dark:border-[#6f7f95] rounded-xl border",{"border-[#0c75fc] dark:border-[rgba(12,117,252,0.8)]":$}),children:[(0,t.jsx)(h.default.TextArea,{placeholder:"可以问我任何问题",className:"w-full resize-none border-0 p-0 focus:shadow-none",value:A,autoSize:{minRows:1},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey){if(J){e.preventDefault();return}A.trim()&&(e.preventDefault(),Q())}},onChange:e=>{B(e.target.value)},onFocus:()=>{z(!0)},onBlur:()=>z(!1),onCompositionStartCapture:()=>{G(!0)},onCompositionEndCapture:()=>{setTimeout(()=>{G(!1)},0)}}),(0,t.jsx)(x.ZP,{type:"primary",className:b()("flex items-center justify-center rounded-lg bg-button-gradient border-0 ml-2",{"opacity-40 cursor-not-allowed":!A.trim()||!U}),onClick:Q,children:U?(0,t.jsx)(u.Z,{}):(0,t.jsx)(v.Z,{indicator:(0,t.jsx)(d.Z,{className:"text-white"})})})]})]})}},68120:function(e,o,n){"use strict";n.r(o);var t=n(52676),r=n(21011),l=n(10332),s=n(5196),a=n(48763),i=n(32651),d=n(75271),c=n(919);o.default=()=>{let{modelList:e}=(0,d.useContext)(r.p),{model:o,setModel:n}=(0,d.useContext)(c.MobileChatContext),u=(0,d.useMemo)(()=>e.length>0?e.map(e=>({label:(0,t.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{n(e)},children:[(0,t.jsx)(l.Z,{width:14,height:14,model:e}),(0,t.jsx)("span",{className:"text-xs",children:e})]}),key:e})):[],[e,n]);return(0,t.jsx)(a.Z,{menu:{items:u},placement:"top",trigger:["click"],children:(0,t.jsx)(i.Z,{content:o,children:(0,t.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,t.jsx)(l.Z,{width:16,height:16,model:o}),(0,t.jsx)("span",{className:"text-xs font-medium line-clamp-1",style:{maxWidth:96},children:o}),(0,t.jsx)(s.Z,{rotate:90})]})})})}},67282:function(e,o,n){"use strict";n.r(o);var t=n(52676),r=n(87402),l=n.n(r),s=n(75271);o.default=(0,s.memo)(e=>{let{width:o,height:n,src:r,label:s}=e;return(0,t.jsx)(l(),{width:o||14,height:n||14,src:r,alt:s||"db-icon",priority:!0})})},58521:function(e,o,n){"use strict";n.r(o);var t=n(52676),r=n(59864),l=n(31959),s=n(92821),a=n(24573),i=n(5196),d=n(80998),c=n(99113),u=n(94634),m=n(54426),f=n(48763),g=n(75271),p=n(919),v=n(67282);o.default=()=>{let{appInfo:e,resourceList:o,scene:n,model:h,conv_uid:x,getChatHistoryRun:k,setResource:b,resource:j}=(0,g.useContext)(p.MobileChatContext),{temperatureValue:y,maxNewTokensValue:_}=(0,g.useContext)(l.ChatContentContext),[w,S]=(0,g.useState)(null),N=(0,g.useMemo)(()=>{var o,n,t;return null===(o=null==e?void 0:null===(n=e.param_need)||void 0===n?void 0:n.filter(e=>"resource"===e.type))||void 0===o?void 0:null===(t=o[0])||void 0===t?void 0:t.value},[e]),Z=(0,g.useMemo)(()=>o&&o.length>0?o.map(e=>({label:(0,t.jsxs)("div",{className:"flex items-center gap-2",onClick:()=>{S(e),b(e.space_id||e.param)},children:[(0,t.jsx)(v.default,{width:14,height:14,src:s.S$[e.type].icon,label:s.S$[e.type].label}),(0,t.jsx)("span",{className:"text-xs",children:e.param})]}),key:e.space_id||e.param})):[],[o,b]),{run:C,loading:P}=(0,c.Z)(async e=>{let[,o]=await (0,r.Vx)((0,r.qn)({convUid:x,chatMode:n,data:e,model:h,temperatureValue:y,maxNewTokensValue:_,config:{timeout:36e5}}));return b(o),o},{manual:!0,onSuccess:async()=>{await k()}}),M=async e=>{let o=new FormData;o.append("doc_file",null==e?void 0:e.file),await C(o)},D=(0,g.useMemo)(()=>P?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(u.Z,{size:"small",indicator:(0,t.jsx)(a.Z,{spin:!0})}),(0,t.jsx)("span",{className:"text-xs",children:"上传中"})]}):j?(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("span",{className:"text-xs",children:j.file_name}),(0,t.jsx)(i.Z,{rotate:90})]}):(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(d.Z,{className:"text-base"}),(0,t.jsx)("span",{className:"text-xs",children:"上传文件"})]}),[P,j]);return(0,t.jsx)(t.Fragment,{children:(()=>{switch(N){case"excel_file":case"text_file":case"image_file":return(0,t.jsx)("div",{className:"flex items-center justify-center gap-1 border rounded-xl bg-white dark:bg-black px-2 flex-shrink-0",children:(0,t.jsx)(m.default,{name:"file",accept:".xlsx,.xls",maxCount:1,showUploadList:!1,beforeUpload:()=>!1,onChange:M,className:"flex h-full w-full items-center justify-center",children:D})});case"database":case"knowledge":case"plugin":case"awel_flow":var e,n,r,l,a;if(!(null==o?void 0:o.length))return null;return(0,t.jsx)(f.Z,{menu:{items:Z},placement:"top",trigger:["click"],children:(0,t.jsxs)("div",{className:"flex items-center gap-1 border rounded-xl bg-white dark:bg-black p-2 flex-shrink-0",children:[(0,t.jsx)(v.default,{width:14,height:14,src:null===(e=s.S$[(null==w?void 0:w.type)||(null==o?void 0:null===(n=o[0])||void 0===n?void 0:n.type)])||void 0===e?void 0:e.icon,label:null===(r=s.S$[(null==w?void 0:w.type)||(null==o?void 0:null===(l=o[0])||void 0===l?void 0:l.type)])||void 0===r?void 0:r.label}),(0,t.jsx)("span",{className:"text-xs font-medium",children:(null==w?void 0:w.param)||(null==o?void 0:null===(a=o[0])||void 0===a?void 0:a.param)}),(0,t.jsx)(i.Z,{rotate:90})]})})}})()})}},59741:function(e,o,n){"use strict";n.r(o);var t=n(52676),r=n(68508),l=n(48763),s=n(14486),a=n(75271),i=n(919);o.default=()=>{let{temperature:e,setTemperature:o}=(0,a.useContext)(i.MobileChatContext),n=e=>{isNaN(e)||o(e)};return(0,t.jsx)(l.Z,{trigger:["click"],dropdownRender:()=>(0,t.jsx)("div",{className:"flex h-28 bg-white dark:bg-[rgba(255,255,255,0.5)] items-center justify-center rounded-xl py-3",children:(0,t.jsx)(s.Z,{defaultValue:.5,max:1,min:0,step:.1,vertical:!0,onChange:n,value:e})}),placement:"top",children:(0,t.jsxs)("div",{className:"flex items-center justify-between border rounded-xl bg-white dark:bg-black w-14 p-2 flex-shrink-0",children:[(0,t.jsx)(r.Z,{type:"icon-icons-temperature",className:"text-sm"}),(0,t.jsx)("span",{className:"text-xs font-medium",children:e})]})})}},919:function(e,o,n){"use strict";n.r(o),n.d(o,{MobileChatContext:function(){return b}});var t=n(52676),r=n(21011),l=n(59864),s=n(40797),a=n(92821),i=n(84769),d=n(63464),c=n(99113),u=n(94634),m=n(68554),f=n.n(m),g=n(29052),p=n(75271),v=n(67665),h=n(76357),x=n(31226);let k=f()(()=>Promise.all([n.e(8201),n.e(9915),n.e(4130),n.e(4521),n.e(768),n.e(5745),n.e(9066),n.e(2601),n.e(5711),n.e(7707),n.e(4395),n.e(8223),n.e(6705),n.e(9907),n.e(3046),n.e(4465),n.e(3769),n.e(1633),n.e(2026),n.e(2466),n.e(4132),n.e(6414),n.e(2501),n.e(3527),n.e(4822)]).then(n.bind(n,24822)),{loadableGenerated:{webpack:()=>[24822]},ssr:!1}),b=(0,p.createContext)({model:"",temperature:.5,resource:null,setModel:()=>{},setTemperature:()=>{},setResource:()=>{},scene:"",history:[],setHistory:()=>{},scrollViewRef:{current:null},appInfo:{},conv_uid:"",resourceList:[],order:{current:1},handleChat:()=>Promise.resolve(),canAbort:!1,setCarAbort:()=>{},canNewChat:!1,setCanNewChat:()=>{},ctrl:{current:void 0},userInput:"",setUserInput:()=>{},getChatHistoryRun:()=>{}});o.default=()=>{var e,o;let n=(0,g.useSearchParams)(),m=null!==(e=null==n?void 0:n.get("chat_scene"))&&void 0!==e?e:"",f=null!==(o=null==n?void 0:n.get("app_code"))&&void 0!==o?o:"",{modelList:j}=(0,p.useContext)(r.p),[y,_]=(0,p.useState)([]),[w,S]=(0,p.useState)(""),[N,Z]=(0,p.useState)(.5),[C,P]=(0,p.useState)(null),M=(0,p.useRef)(null),[D,R]=(0,p.useState)(""),[E,O]=(0,p.useState)(!1),[T,I]=(0,p.useState)(!0),F=(0,p.useRef)(),A=(0,p.useRef)(1),H=(0,s.Z)(),L=(0,p.useMemo)(()=>"".concat(null==H?void 0:H.user_no,"_").concat(f),[f,H]),{run:U,loading:V}=(0,c.Z)(async()=>await (0,l.Vx)((0,l.$i)("".concat(null==H?void 0:H.user_no,"_").concat(f))),{manual:!0,onSuccess:e=>{let[,o]=e,n=null==o?void 0:o.filter(e=>"view"===e.role);n&&n.length>0&&(A.current=n[n.length-1].order+1),_(o||[])}}),{data:W,run:q,loading:B}=(0,c.Z)(async e=>{let[,o]=await (0,l.Vx)((0,l.BN)(e));return null!=o?o:{}},{manual:!0}),{run:$,data:z,loading:J}=(0,c.Z)(async()=>{var e,o;let[,n]=await (0,l.Vx)((0,l.vD)(m));return P((null==n?void 0:null===(e=n[0])||void 0===e?void 0:e.space_id)||(null==n?void 0:null===(o=n[0])||void 0===o?void 0:o.param)),null!=n?n:[]},{manual:!0}),{run:G,loading:K}=(0,c.Z)(async()=>{let[,e]=await (0,l.Vx)((0,l.iP)());return null!=e?e:[]},{manual:!0,onSuccess:e=>{var o;let n=null===(o=null==e?void 0:e.filter(e=>e.conv_uid===L))||void 0===o?void 0:o[0];(null==n?void 0:n.select_param)&&P(JSON.parse(null==n?void 0:n.select_param))}});(0,p.useEffect)(()=>{m&&f&&j.length&&q({chat_scene:m,app_code:f})},[f,m,q,j]),(0,p.useEffect)(()=>{f&&U()},[f]),(0,p.useEffect)(()=>{if(j.length>0){var e,o,n;let t=null===(e=null==W?void 0:null===(o=W.param_need)||void 0===o?void 0:o.filter(e=>"model"===e.type))||void 0===e?void 0:null===(n=e[0])||void 0===n?void 0:n.value;S(t||j[0])}},[j,W]),(0,p.useEffect)(()=>{var e,o,n;let t=null===(e=null==W?void 0:null===(o=W.param_need)||void 0===o?void 0:o.filter(e=>"temperature"===e.type))||void 0===e?void 0:null===(n=e[0])||void 0===n?void 0:n.value;Z(t||.5)},[W]),(0,p.useEffect)(()=>{if(m&&(null==W?void 0:W.app_code)){var e,o,n,t,r,l;let s=null===(e=null==W?void 0:null===(o=W.param_need)||void 0===o?void 0:o.filter(e=>"resource"===e.type))||void 0===e?void 0:null===(n=e[0])||void 0===n?void 0:n.value,a=null===(t=null==W?void 0:null===(r=W.param_need)||void 0===r?void 0:r.filter(e=>"resource"===e.type))||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.bind_value;a&&P(a),["database","knowledge","plugin","awel_flow"].includes(s)&&!a&&$()}},[W,m,$]);let Q=async e=>{var o,n,t;R(""),F.current=new AbortController;let r={chat_mode:m,model_name:w,user_input:e||D,conv_uid:L,temperature:N,app_code:null==W?void 0:W.app_code,...C&&{select_param:C}};if(y&&y.length>0){let e=null==y?void 0:y.filter(e=>"view"===e.role);A.current=e[e.length-1].order+1}let l=[{role:"human",context:e||D,model_name:w,order:A.current,time_stamp:0},{role:"view",context:"",model_name:w,order:A.current,time_stamp:0,thinking:!0}],s=l.length-1;_([...y,...l]),I(!1);try{await (0,d.L)("".concat(null!==(o=x.env.API_BASE_URL)&&void 0!==o?o:"","/api/v1/chat/completions"),{method:"POST",headers:{"Content-Type":"application/json",[i.gp]:null!==(n=(0,a.n5)())&&void 0!==n?n:""},signal:F.current.signal,body:JSON.stringify(r),openWhenHidden:!0,async onopen(e){if(e.ok&&e.headers.get("content-type")===d.a)return},onclose(){var e;null===(e=F.current)||void 0===e||e.abort(),I(!0),O(!1)},onerror(e){throw Error(e)},onmessage:e=>{let o=e.data;try{o=JSON.parse(o).vis}catch(e){o.replaceAll("\\n","\n")}"[DONE]"===o?(I(!0),O(!1)):(null==o?void 0:o.startsWith("[ERROR]"))?(l[s].context=null==o?void 0:o.replace("[ERROR]",""),l[s].thinking=!1,_([...y,...l]),I(!0),O(!1)):(O(!0),l[s].context=o,l[s].thinking=!1,_([...y,...l]))}})}catch(e){null===(t=F.current)||void 0===t||t.abort(),l[s].context="Sorry, we meet some error, please try again later.",l[s].thinking=!1,_([...l]),I(!0),O(!1)}};return(0,p.useEffect)(()=>{m&&"chat_agent"!==m&&G()},[m,G]),(0,t.jsx)(b.Provider,{value:{model:w,resource:C,setModel:S,setTemperature:Z,setResource:P,temperature:N,appInfo:W,conv_uid:L,scene:m,history:y,scrollViewRef:M,setHistory:_,resourceList:z,order:A,handleChat:Q,setCanNewChat:I,ctrl:F,canAbort:E,setCarAbort:O,canNewChat:T,userInput:D,setUserInput:R,getChatHistoryRun:U},children:(0,t.jsx)(u.Z,{size:"large",className:"flex h-screen w-screen justify-center items-center max-h-screen",spinning:V||B||J||K,children:(0,t.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-light dark:bg-gradient-dark p-4 pt-0",children:[(0,t.jsxs)("div",{ref:M,className:"flex flex-col flex-1 overflow-y-auto mb-3",children:[(0,t.jsx)(v.default,{}),(0,t.jsx)(k,{})]}),(null==W?void 0:W.app_code)&&(0,t.jsx)(h.default,{})]})})})}},32176:function(e,o,n){"use strict";n.d(o,{Tk:function(){return c},PR:function(){return u}});var t,r=n(92821),l=n(42673);n(32699);var s=n(64612),a=n(31226);let i=s.default.create({baseURL:null!==(t=a.env.API_BASE_URL)&&void 0!==t?t:""});i.defaults.timeout=1e4,i.interceptors.response.use(e=>e.data,e=>Promise.reject(e));let d={"content-type":"application/json","User-Id":(0,r.n5)()},c=(e,o)=>{if(o){let n=Object.keys(o).filter(e=>void 0!==o[e]&&""!==o[e]).map(e=>"".concat(e,"=").concat(o[e])).join("&");n&&(e+="?".concat(n))}return i.get("/api"+e,{headers:d}).then(e=>e).catch(e=>{l.ZP.error(e),Promise.reject(e)})},u=(e,o)=>i.post(e,o,{headers:d}).then(e=>e).catch(e=>{l.ZP.error(e),Promise.reject(e)})},21800:function(){}}]);